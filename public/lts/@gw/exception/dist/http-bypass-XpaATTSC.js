"use strict";var T=Object.defineProperty;var B=(e,t,s)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var a=(e,t,s)=>B(e,typeof t!="symbol"?t+"":t,s);const M=require("./exception-B9XS0hPY.js");class R{constructor(){a(this,"startTime");this.startTime=performance.now()}getTimestamp(){return(performance.now()-this.startTime)*1e3}}class S{constructor(){a(this,"startTime");this.startTime=process.hrtime.bigint()}getTimestamp(){const s=process.hrtime.bigint()-this.startTime;return Number(s/BigInt(1e3))}}let o;if(typeof performance<"u"&&typeof performance.now=="function")o=new R;else if(typeof process<"u"&&typeof process.hrtime=="function")o=new S;else throw new Error("Unsupported environment");function m(){return o.getTimestamp()}class I{constructor(t,s,c){a(this,"contractManager");this.contractManager=new M.ContractManager("TRACE",t,s,c),this.contractManager.registerPublisher({pcode:"FRE",name:"前端运行环境"})}record(t){let s={pcode:"FRE",topic:"debug",data:{...t,time:m()},traceId:t.traceId};this.contractManager.publish(s)}subscribe(t,s,c){this.contractManager.subscribe({pcode:"FRE",scode:t,allow:!1,smp:{code:s},handler:c})}unsubscribe(t,s){this.contractManager.unsubscribe({pcode:"FRE",scode:t,allow:!1,smp:{code:s},handler:()=>{}})}}const h=new I(10,10,30);function d(e){return h.record(e)}let f=!1,i;function E(e,t){f=e,t?i=t:i=void 0}function q(e){return e&&i?!i.some(t=>e.startsWith(t)):f}function v(e,t=100,s=100){return new Promise((p,b)=>{e.length===0&&p({msg:"数据为空"});let u=0,r=0,l=setInterval(()=>{if(u<t){try{e[r].handler(e[r].topic,e[r].msg,"bypass"),d({code:"FC_SEND",data:"发送",traceId:""})}catch(y){clearInterval(l),b(y)}u++,r<e.length-1?r++:r=0}else clearInterval(l),p({msg:"数据发送完成"})},s)})}let g=!1,n;function H(e,t){g=e,t?n=t:n=void 0}function w(e){return e&&n&&n.length>0?!n.some(t=>e.startsWith(t)):g}function F(e,t){w(t.url)&&(t.cmd="bypass",t.baseURL="https://localhost:6001",t.url=`/api/http/bypass/provider?url=${encodeURIComponent(t.url)}&code=${e}`)}exports.TRecorder=h;exports.checkHttpRequestBypass=F;exports.getHttpBypassSwitch=w;exports.getMqttBypassSwitch=q;exports.getTimestamp=m;exports.sendMqttData=v;exports.setHttpBypassSwitch=H;exports.setMqttBypassSwitch=E;exports.tR=d;
