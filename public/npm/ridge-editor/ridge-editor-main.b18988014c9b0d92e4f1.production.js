(globalThis.webpackChunkridge_editor=globalThis.webpackChunkridge_editor||[]).push([[336],{816:e=>{e.exports={externals:[{module:"react",root:"React",dist:"react@18.2.0/umd/react.production.min.js"},{module:"react-dom",dependencies:["react"],root:"ReactDOM",dist:"react-dom@18.2.0/umd/react-dom.production.min.js"},{module:"vue",root:"Vue",dist:"vue/dist/vue.min.js"},{module:"ridgejs",root:"RidgeCore"},{module:"debug",root:"createDebug"},{module:"ridgejs-editor",root:"RidgeEditor"}]}},1268:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%271em%27 height=%271em%27 viewBox=%270 0 24 24%27%3E%3Cpath fill=%27%23e86868%27 d=%27M11.953 2C6.465 2 2 6.486 2 12s4.486 10 10 10s10-4.486 10-10S17.493 2 11.953 2M13 17h-2v-2h2zm0-4h-2V7h2z%27/%3E%3C/svg%3E"},2025:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,".movable-panel {\n  position: absolute;\n  background: var(--semi-color-bg-0);\n  border: 1px solid var(--semi-color-border);\n  padding: 4px;\n  border-radius: 8px;\n  z-index: 300;\n}\n.movable-panel.is-minimized {\n  width: 35px;\n  height: 35px;\n  overflow: hidden;\n}\n.movable-panel.is-minimized .title-bar .icon-handle {\n  display: none;\n}\n.movable-panel.is-minimized .title-bar .icon-mininize {\n  right: 0px;\n  top: 0px;\n}\n.movable-panel .panel-actions {\n  position: absolute;\n  z-index: 10;\n  right: 28px;\n  top: 6px;\n}\n.movable-panel .semi-spin {\n  width: 100%;\n  height: 100%;\n}\n.movable-panel .title-bar {\n  position: relative;\n  height: 1px;\n  z-index: 1;\n  height: 32px;\n}\n.movable-panel .title-bar .title-text {\n  position: absolute;\n  left: 33px;\n  top: 5px;\n}\n.movable-panel .title-bar .toggle-search {\n  z-index: 101;\n  background-color: var(--semi-color-bg-2);\n}\n.movable-panel .title-bar .toggle-search .semi-input-suffix {\n  cursor: pointer;\n}\n.movable-panel .title-bar .icon-handle {\n  position: absolute;\n  top: 7px;\n  left: 7px;\n  cursor: move;\n  color: var(--semi-color-text-0);\n}\n.movable-panel .title-bar .icon-mininize {\n  right: 3px;\n  position: absolute;\n  font-size: 16px;\n  top: 3px;\n}\n.movable-panel .title-bar .icon-search {\n  position: absolute;\n  top: 2px;\n  right: 5px;\n}\n.movable-panel .title-bar .icon-close {\n  position: absolute;\n  top: 2px;\n  right: 5px;\n}\n.movable-panel .panel-content {\n  height: calc(100% - 32px);\n}\n.movable-panel .semi-tabs-top {\n  height: 100%;\n}\n.movable-panel .semi-tabs-top.on-title .semi-tabs-bar {\n  position: absolute;\n  top: -30px;\n  left: 36px;\n  right: 40px;\n  z-index: 9;\n}\n.movable-panel .semi-tabs-top .semi-tabs-bar .semi-tabs-tab {\n  padding: 3px 5px;\n}\n.movable-panel .semi-tabs-top .semi-tabs-bar .semi-tabs-tab.semi-tabs-tab-active {\n  padding: 3px 5px;\n}\n.movable-panel .semi-tabs-top .semi-tabs-content {\n  height: calc(100% - 24px);\n}\n.movable-panel .semi-tabs-top .semi-tabs-content .semi-tabs-pane {\n  height: 100%;\n}\n.movable-panel .semi-tabs-top .semi-tabs-content .semi-tabs-pane .semi-tabs-pane-motion-overlay {\n  height: 100%;\n}\n.movable-panel .semi-tabs-top.on-title .semi-tabs-content {\n  height: 100%;\n}\n.movable-panel .semi-tabs-left {\n  height: 100%;\n}\n.movable-panel.open-search .semi-tabs.on-title .semi-tabs-bar {\n  display: none;\n}\n",""]);const a=r},2139:(e,t,n)=>{"use strict";n.r(t),n.d(t,{basename:()=>g,camelCase:()=>s.a,dirname:()=>h,ensureLeading:()=>m,extname:()=>u,formateDate:()=>p,nanoid:()=>d,trim:()=>a.a});var i=n(9742),o=n(9677),s=n.n(o),r=n(107),a=n.n(r),l=n(3464),c=n.n(l);const d=(0,i.d_)("1234567890abcdefghijklmnopqrstuvwxyz",10),p=(e,t)=>{const n=e||(new Date).getTime();return c()(n).format(t||"YYYY-MM-DD HH:mm:ss")},h=e=>e.substring(0,e.lastIndexOf("/")),m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/";return e.startsWith(t)?e:t+e},g=(e,t)=>{const n=e.substring(e.lastIndexOf("/")+1);return t?n.substring(0,n.lastIndexOf(t)):n},u=e=>e.split(".").pop().toLowerCase()},2206:function(e){const t={};"object"==typeof e.exports?e.exports=t:"object"==typeof this&&(this.tarball=t),t.TarReader=class{constructor(){this.fileInfo=[]}readFile(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=e=>{this.buffer=e.target.result,this.fileInfo=[],this._readFileInfo(),t(this.fileInfo)},i.readAsArrayBuffer(e)}))}readArrayBuffer(e){return this.buffer=e,this.fileInfo=[],this._readFileInfo(),this.fileInfo}_readFileInfo(){this.fileInfo=[];let e=0,t=0,n="",i=null;for(;e<this.buffer.byteLength-512&&(n=this._readFileName(e),0!=n.length);)i=this._readFileType(e),t=this._readFileSize(e),this.fileInfo.push({name:n,type:i,size:t,header_offset:e}),e+=512+512*Math.trunc(t/512),t%512&&(e+=512)}getFileInfo(){return this.fileInfo}_readString(e,t){const n=new Uint8Array(this.buffer,e,t),i=n.indexOf(0);return(new TextDecoder).decode(n.slice(0,i))}_readFileName(e){return this._readString(e,100)}_readFileType(e){const t=new Uint8Array(this.buffer,e+156,1),n=String.fromCharCode(t[0]);return"0"==n?"file":"5"==n?"directory":n}_readFileSize(e){const t=new Uint8Array(this.buffer,e+124,12);let n="";for(let e=0;e<11;e++)n+=String.fromCharCode(t[e]);return parseInt(n,8)}_readFileBlob(e,t,n){const i=new Uint8Array(this.buffer,e,t);return new Blob([i],{type:n})}_readFileBinary(e,t){return new Uint8Array(this.buffer,e,t)}_readTextFile(e,t){const n=new Uint8Array(this.buffer,e,t);return(new TextDecoder).decode(n)}getTextFile(e){const t=this.fileInfo.find((t=>t.name==e));if(t)return this._readTextFile(t.header_offset+512,t.size)}getFileBlob(e,t){const n=this.fileInfo.find((t=>t.name==e));if(n)return this._readFileBlob(n.header_offset+512,n.size,t)}getFileBinary(e){const t=this.fileInfo.find((t=>t.name==e));if(t)return this._readFileBinary(t.header_offset+512,t.size)}},t.TarWriter=class{constructor(){this.fileData=[]}addTextFile(e,t,n){const i=(new TextEncoder).encode(t);this.fileData.push({name:e,array:i,type:"file",size:i.length,dataType:"array",opts:n})}addFileArrayBuffer(e,t,n){const i=new Uint8Array(t);this.fileData.push({name:e,array:i,type:"file",size:i.length,dataType:"array",opts:n})}addFile(e,t,n){this.fileData.push({name:e,file:t,size:t.size,type:"file",dataType:"file",opts:n})}addFolder(e,t){this.fileData.push({name:e,type:"directory",size:0,dataType:"none",opts:t})}_createBuffer(){let e=0;for(let t=0;t<this.fileData.length;t++){const n=this.fileData[t].size;e+=512+512*Math.trunc(n/512),n%512&&(e+=512)}let t=10240*Math.trunc(e/10240);e%10240&&(t+=10240),this.buffer=new ArrayBuffer(t)}async download(e){const t=await this.writeBlob(),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}async writeBlob(e){return new Blob([await this.write(e)],{type:"application/x-tar"})}write(e){return new Promise(((t,n)=>{this._createBuffer();let i=0,o=0;const s=()=>{if(o++,e&&e(o/this.fileData.length*100),o===this.fileData.length){const e=new Uint8Array(this.buffer);t(e)}};for(let e=0;e<this.fileData.length;e++){const t=this.fileData[e];this._writeFileName(t.name,i),this._writeFileType(t.type,i),this._writeFileSize(t.size,i),this._fillHeader(i,t.opts,t.type),this._writeChecksum(i);const n=new Uint8Array(this.buffer,i+512,t.size);if("array"===t.dataType){for(let e=0;e<t.size;e++)n[e]=t.array[e];s()}else if("file"===t.dataType){const e=new FileReader;e.onload=function(e){const t=e;return function(e){const n=e.target.result,i=new Uint8Array(n);for(let e=0;e<i.length;e++)t[e]=i[e];s()}}(n),e.readAsArrayBuffer(t.file)}else"directory"===t.type&&s();i+=512+512*Math.trunc(t.size/512),t.size%512&&(i+=512)}}))}_writeString(e,t,n){const i=new Uint8Array(this.buffer,t,n),o=new TextEncoder;if(o.encodeInto)for(let t=o.encodeInto(e,i).written;t<n;t++)i[t]=0;else{const t=o.encode(e);for(let e=0;e<n;e++)i[e]=e<t.length?t[e]:0}}_writeFileName(e,t){this._writeString(e,t,100)}_writeFileType(e,t){let n="0";"file"===e?n="0":"directory"===e&&(n="5"),new Uint8Array(this.buffer,t+156,1)[0]=n.charCodeAt(0)}_writeFileSize(e,t){let n=e.toString(8);n=this._leftPad(n,11),this._writeString(n,t+124,12)}_leftPad(e,t){let n=e+"";for(;n.length<t;)n="0"+n;return n}_writeFileMode(e,t){this._writeString(this._leftPad(e,7),t+100,8)}_writeFileUid(e,t){this._writeString(this._leftPad(e,7),t+108,8)}_writeFileGid(e,t){this._writeString(this._leftPad(e,7),t+116,8)}_writeFileMtime(e,t){this._writeString(this._leftPad(e,11),t+136,12)}_writeFileUser(e,t){this._writeString(e,t+265,32)}_writeFileGroup(e,t){this._writeString(e,t+297,32)}_writeChecksum(e){this._writeString("        ",e+148,8);const t=new Uint8Array(this.buffer,e,512);let n=0;for(let e=0;e<512;e++)n+=t[e];this._writeString(n.toString(8),e+148,8)}_getOpt(e,t,n){return null!=e&&null!=e[t]?e[t]:n}_fillHeader(e,t,n){const i=this._getOpt(t,"uid",1e3),o=this._getOpt(t,"gid",1e3),s=this._getOpt(t,"mode","file"===n?"664":"775"),r=this._getOpt(t,"mtime",Date.now()),a=this._getOpt(t,"user","tarballjs"),l=this._getOpt(t,"group","tarballjs");this._writeFileMode(s,e),this._writeFileUid(i.toString(8),e),this._writeFileGid(o.toString(8),e),this._writeFileMtime(Math.trunc(r/1e3).toString(8),e),this._writeString("ustar",e+257,6),this._writeString("00",e+263,2),this._writeFileUser(a,e),this._writeFileGroup(l,e)}}},2824:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,".file-actions {\n  display: flex;\n  justify-content: space-between;\n  border-bottom: 1px solid var(--semi-color-border);\n  padding: 8px;\n}\n.file-actions i.bi {\n  font-size: 16px;\n  color: var(--semi-color-text-0);\n}\n.file-actions i.bi.bi-plus-lg {\n  font-size: 20px;\n}\n.file-actions .action-btn-appConfig {\n  width: 58px;\n  height: 24px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.file-actions .action-btn-appConfig .semi-icon svg {\n  width: 18px;\n  height: 18px;\n}\n.file-actions .align-right {\n  gap: 5px;\n  flex: 1;\n  display: flex;\n  justify-content: flex-end;\n}\n.tree-loading {\n  height: calc(100% - 26px);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n}\n.file-tree {\n  height: calc(100% - 2px);\n  overflow: auto;\n}\n.file-tree .icon-image {\n  width: 18px;\n  height: 18px;\n  margin-right: 8px;\n  object-fit: contain;\n}\n.file-tree i.bi {\n  color: var(--semi-color-text-1);\n  font-size: 16px;\n}\n.file-tree .semi-tree-option-label svg {\n  color: var(--semi-color-text-1);\n  font-size: 18px;\n}\n.file-tree .semi-tree-option-label i.bi {\n  margin-right: 6px;\n}\n.file-tree .tree-label {\n  display: flex;\n  align-items: center;\n  line-height: 28px;\n}\n.file-tree .tree-label.opened .label-content {\n  color: var(--semi-color-success);\n  font-weight: bold;\n}\n.file-tree .tree-label i.bi {\n  color: var(--semi-color-text-1);\n  font-size: 18px;\n}\n.file-tree .tree-label i.bi.bi-three-dots-vertical {\n  margin-right: 0;\n  font-size: 20px;\n}\n.file-tree .tree-label .label-content {\n  flex: 1;\n  line-height: 22px;\n}\n.file-tree .tree-label .more-button {\n  visibility: hidden;\n  margin-right: 5px;\n}\n.file-tree .tree-label:hover .more-button {\n  visibility: inherit;\n}\n.app-files-dropdown svg {\n  width: 1.2em;\n  height: 1.2em;\n}\n",""]);const a=r},4881:(e,t,n)=>{const i=n(4003),o=n(124)("ridge:nedb");e.exports=class{constructor(e){this.filename=e,this.store=new i({filename:e,timestampData:!0,autoload:!0}),this.store.persistence.setAutocompactionInterval(144e5)}async compactDatafile(){await this.store.persistence.compactDatafile()}async insert(e){return o("insert",e),new Promise(((t,n)=>{this.store.insert(e,(function(e,i){e?n(e):t(i)}))}))}async update(e,t,n){return o("update",e,t),new Promise(((i,o)=>{let s=e;"string"==typeof e&&(s={_id:e}),this.store.update(s,t,n||{},(function(e,t){e?o(e):i(t)}))}))}async patch(e,t){return o("patch",e,t),"string"==typeof e?this.update({_id:e},{$set:t}):this.update(e,{$set:t})}async clean(){return o("clean"),this.filename,new Promise(((e,t)=>{this.store.remove({},{multi:!0},(function(n,i){n?t(n):e(i)}))}))}async remove(e){if(o("remove",e),"object"==typeof e){if(!Array.isArray(e))return this.doRemove(e);for(const t of e)await this.remove(t)}else if("string"==typeof e)return this.doRemove({_id:e})}async doRemove(e,t){return new Promise(((n,i)=>{this.store.remove(e,t||{multi:!0},(function(e,t){e?i(e):n(t)}))}))}async findOne(e){if("string"==typeof e)return new Promise(((t,n)=>{this.store.findOne({_id:e},(function(e,i){e?n(e):t(i)}))}));{const t=await this.find(e);return t.length>0?t[0]:null}}async find(e){let{sort:t,projection:n,skip:i=0,limit:s=-1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o("db find",e,n),new Promise(((r,a)=>{let l=this.store.find(e);n&&(l=l.projection(n)),t&&(l=l.sort(t)),i&&(l=l.skip(i)),s>0&&(l=l.limit(s)),o("cursor exec",e,n),l.exec((function(e,t){o("cursor exec result ",e,t),e?a(e):(o("found",t),r(t))}))}))}async count(e){return o("count",e),new Promise(((t,n)=>{this.store.count(e,(function(e,i){e?n(e):t(i)}))}))}async exist(e){return o("exist",e),(await this.find(e,{limit:1})).length>0}async distinct(e,t){o("distinct",e,t);const n=await this.find(t);return Array.from(new Set(n.filter((t=>t[e])).map((t=>t[e]))))}}},4967:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s),a=n(4417),l=n.n(a),c=new URL(n(1268),n.b),d=r()(o()),p=l()(c);d.push([e.id,`html, body {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    margin: 0;\n}\n\n:focus-visible {\n  outline: none;\n}\n\n.ridge-composite {\n    position: relative;\n    .ridge-runtime-hidden {\n        display: none;\n    }\n    &.is-edit {\n        .ridge-runtime-hidden {\n            display: initial;\n        }\n    }\n}\n\n.ridge-composite > .ridge-element {\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n.ridge-portalled {\n    display: none;\n}\n\n.ridge-is-full {\n    width: 100%;\n    height: 100%;\n}\n\n.ridge-is-hidden {\n    display: none;\n}\n\n.ridge-element:has(.ridge-overlay) {\n  position: relative;\n}\n.ridge-overlay {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n}\n\n.ridge-webstart-error {\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    padding: 20px;\n    background-color: rgba(255, 0, 0, 0.726);\n    color: white;\n    font-family: Arial, sans-serif;\n    font-size: 18px;\n    border-radius: 8px;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n    z-index: 9999;\n    text-align: center;\n    max-width: 80%;\n    animation: fadeIn 0.3s ease-out;\n}\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n    }\n    to {\n        opacity: 1;\n    }\n}\n\n.status-Loading {\n    background: linear-gradient(90deg,#2e32380d 25%,#2e323817 44%,#2e32380d 88%);\n    background-size: 400% 100%;\n    animation: skeleton-loading 3s ease infinite;\n    animation-fill-mode: forwards;\n}\n\n\n.status-not-found, .status-render-error, .status-Circular, .status-Page-not-found {\n    position: relative;\n    font-size: 9px;\n    background-color: rgba(253, 185, 165, .3);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-position: center;\n    overflow: hidden;\n}\n\n.status-not-found::before, .status-Circular::before, .status-Page-not-found::before {  \n    content: "内容未找到";  \n    position: absolute;  \n    padding-left: 26px;\n    left: 50%;\n    top: 50%;  \n    transform: translate(-50%, -50%);\n    font-size: 14px;  \n    z-index: -1;  \n    background-size: 22px;\n    background-repeat: no-repeat;\n    background-image: url(${p});\n    pointer-events: none; /* 防止背景文字影响鼠标事件 */  \n}  \n\n.status-Circular::before {\n    content: "循环渲染异常"; \n}\n.status-Page-not-found::before {\n    content: "页面未找到";  \n}\n\n.ridge-composite:not(.is-edit) .is-store {\n    display: none;\n}\n@keyframes skeleton-loading {\n    0% {\n        background-position: 100% 50%\n    }\n\n    to {\n        background-position: 0 50%\n    }\n}`,""]);const h=d},5222:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,'.moveable-control {\n  width: 8px!important;\n  height: 8px!important;\n  border: 1px solid var(--semi-color-primary)!important;\n  box-sizing: border-box;\n  border-radius: 0!important;\n  background: #fff!important;\n  margin-top: -4px!important;\n  margin-left: -4px!important;\n  z-index: 10;\n}\n.moveable-control-box {\n  z-index: 100!important;\n}\n\n.moveable-line {\n  background: var(--semi-color-primary)!important;\n}\n\n.workspace-movable .moveable-control {\n  width: 18px!important;\n  height: 18px!important;\n  opacity: 0;\n}\n\n.workspace-movable .moveable-line {\n  opacity: 0;\n}\n\n.rCSwd26qe .moveable-line.moveable-vertical.moveable-bold {\n  width: 0.5px!important;\n  background-color: var(--semi-color-warning)!important;\n}\n.rCSwd26qe .moveable-line.moveable-horizontal.moveable-bold {\n  height: 1px!important;\n  background-color: var(--semi-color-warning)!important;\n}\n\n/*\n.rCSwd26qe {\n\tposition: absolute;\n\twidth: 1px;\n\theight: 1px;\n\tleft: 0;\n\ttop: 0;\n    z-index: 3000;\n    --moveable-color: #4af;\n    --zoom: 1;\n    --zoompx: 1px;\n    will-change: transform;\n}\n.rCSwd26qe .moveable-control-box {\n    z-index: 0;\n}\n.rCSwd26qe .moveable-line, .rCSwd26qe .moveable-control {\n    position: absolute;\n\tleft: 0;\n    top: 0;\n    will-change: transform;\n}\n.rCSwd26qe .moveable-control {\n\twidth: 14px;\n\theight: 14px;\n\tborder-radius: 50%;\n\tborder: 2px solid #fff;\n\tbox-sizing: border-box;\n    background: #4af;\n    background: var(--moveable-color);\n\tmargin-top: -7px;\n    margin-left: -7px;\n    border: 2px solid #fff;\n    z-index: 10;\n}\n.rCSwd26qe .moveable-padding {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 100px;\n    height: 100px;\n    transform-origin: 0 0;\n}\n.rCSwd26qe .moveable-line {\n\twidth: 1px;\n    height: 1px;\n    background: #4af;\n    background: var(--moveable-color);\n\ttransform-origin: 0px 50%;\n}\n.rCSwd26qe .moveable-line.moveable-edge {\n    z-index: 1;\n    background: transparent;\n}\n.rCSwd26qe .moveable-line.moveable-dashed {\n    box-sizing: border-box;\n    background: transparent;\n}\n.rCSwd26qe .moveable-line.moveable-dashed.moveable-horizontal {\n    border-top: 1px dashed #4af;\n    border-top-color: #4af;\n    border-top-color: var(--moveable-color);\n}\n.rCSwd26qe .moveable-line.moveable-dashed.moveable-vertical {\n    border-left: 1px dashed #4af;\n    border-left-color: #4af;\n    border-left-color: var(--moveable-color);\n}\n.rCSwd26qe .moveable-line.moveable-vertical {\n    transform: translateX(-50%);\n}\n.rCSwd26qe .moveable-line.moveable-horizontal {\n    transform: translateY(-50%);\n}\n.rCSwd26qe .moveable-line.moveable-vertical.moveable-bold {\n    width: 2px;\n}\n.rCSwd26qe .moveable-line.moveable-horizontal.moveable-bold {\n    height: 2px;\n}\n\n.rCSwd26qe .moveable-control.moveable-origin {\n\tborder-color: #f55;\n\tbackground: #fff;\n\twidth: 12px;\n\theight: 12px;\n\tmargin-top: -6px;\n    margin-left: -6px;\n\tpointer-events: none;\n}\n\n.rCSwd26qe .moveable-direction[data-rotation="0"],  .moveable-view-control-rotation0 {\n\tcursor:ns-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(0deg);transform-origin: 16px 16px"></path></svg>\') 16 16, ns-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="15"],  .moveable-view-control-rotation15 {\n\tcursor:ns-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(15deg);transform-origin: 16px 16px"></path></svg>\') 16 16, ns-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="30"],  .moveable-view-control-rotation30 {\n\tcursor:nesw-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(30deg);transform-origin: 16px 16px"></path></svg>\') 16 16, nesw-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="45"],  .moveable-view-control-rotation45 {\n\tcursor:nesw-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(45deg);transform-origin: 16px 16px"></path></svg>\') 16 16, nesw-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="60"],  .moveable-view-control-rotation60 {\n\tcursor:nesw-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(60deg);transform-origin: 16px 16px"></path></svg>\') 16 16, nesw-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="75"],  .moveable-view-control-rotation75 {\n\tcursor:ew-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(75deg);transform-origin: 16px 16px"></path></svg>\') 16 16, ew-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="90"],  .moveable-view-control-rotation90 {\n\tcursor:ew-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(90deg);transform-origin: 16px 16px"></path></svg>\') 16 16, ew-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="105"],  .moveable-view-control-rotation105 {\n\tcursor:ew-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(105deg);transform-origin: 16px 16px"></path></svg>\') 16 16, ew-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="120"],  .moveable-view-control-rotation120 {\n\tcursor:nwse-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(120deg);transform-origin: 16px 16px"></path></svg>\') 16 16, nwse-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="135"],  .moveable-view-control-rotation135 {\n\tcursor:nwse-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(135deg);transform-origin: 16px 16px"></path></svg>\') 16 16, nwse-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="150"],  .moveable-view-control-rotation150 {\n\tcursor:nwse-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(150deg);transform-origin: 16px 16px"></path></svg>\') 16 16, nwse-resize;\n}\n\n\n.rCSwd26qe .moveable-direction[data-rotation="165"],  .moveable-view-control-rotation165 {\n\tcursor:ns-resize;cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(165deg);transform-origin: 16px 16px"></path></svg>\') 16 16, ns-resize;\n}\n\n.rCSwd26qe .moveable-group {\n    z-index: -1;\n}\n.rCSwd26qe .moveable-area {\n    position: absolute;\n}\n.rCSwd26qe .moveable-area-pieces {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: none;\n}\n.rCSwd26qe .moveable-area.moveable-avoid, .rCSwd26qe .moveable-area.moveable-pass {\n    pointer-events: none;\n}\n.rCSwd26qe .moveable-area.moveable-avoid+.moveable-area-pieces {\n    display: block;\n}\n.rCSwd26qe .moveable-area-piece {\n    position: absolute;\n}\n\n\n.rCSwd26qe {\n    --bounds-color: #d66;\n}\n.rCSwd26qe .moveable-guideline {\n    pointer-events: none;\n    z-index: 2;\n}\n.rCSwd26qe .moveable-guideline.moveable-bounds {\n    background: #d66;\n    background: var(--bounds-color);\n}\n.rCSwd26qe .moveable-guideline-group {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n.rCSwd26qe .moveable-guideline-group .moveable-size-value {\n    position: absolute;\n    color: #f55;\n    font-size: 12px;\n    font-weight: bold;\n}\n.rCSwd26qe .moveable-guideline-group.moveable-horizontal .moveable-size-value {\n    transform-origin: 50% 100%;\n    transform: translateX(-50%);\n    left: 50%;\n    bottom: 5px;\n}\n.rCSwd26qe .moveable-guideline-group.moveable-vertical .moveable-size-value {\n    transform-origin: 0% 50%;\n    top: 50%;\n    transform: translateY(-50%);\n    left: 5px;\n}\n.rCSwd26qe .moveable-guideline.moveable-gap {\n    background: #f55;\n}\n.rCSwd26qe .moveable-size-value.moveable-gap {\n    color: #f55;\n}\n\n.rCSwd26qe .moveable-edge.moveable-edgeDraggable.moveable-line {\n    cursor: move;\n}\n.rCSwd26qe .moveable-rotation {\n    position: absolute;\n    height: 40px;\n    width: 1px;\n    transform-origin: 50% 100%;\n    height: calc(40px * var(--zoom));\n    top: auto;\n    left: 0;\n    bottom: 100%;\n    will-change: transform;\n}\n\n*/',""]);const a=r},5886:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,'/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */\n/* Document\n   ========================================================================== */\n/**\n * 1. Correct the line height in all browsers.\n * 2. Prevent adjustments of font size after orientation changes in iOS.\n */\nhtml {\n  line-height: 1.15;\n  /* 1 */\n  -webkit-text-size-adjust: 100%;\n  /* 2 */\n}\n/* Sections\n\t ========================================================================== */\n/**\n   * Remove the margin in all browsers.\n   */\nbody {\n  margin: 0;\n}\n/**\n   * Render the `main` element consistently in IE.\n   */\nmain {\n  display: block;\n}\n/**\n   * Correct the font size and margin on `h1` elements within `section` and\n   * `article` contexts in Chrome, Firefox, and Safari.\n   */\nh1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n/* Grouping content\n\t ========================================================================== */\n/**\n   * 1. Add the correct box sizing in Firefox.\n   * 2. Show the overflow in Edge and IE.\n   */\nhr {\n  box-sizing: content-box;\n  /* 1 */\n  height: 0;\n  /* 1 */\n  overflow: visible;\n  /* 2 */\n}\n/**\n   * 1. Correct the inheritance and scaling of font size in all browsers.\n   * 2. Correct the odd `em` font sizing in all browsers.\n   */\npre {\n  font-family: monospace, monospace;\n  /* 1 */\n  font-size: 1em;\n  /* 2 */\n}\n/* Text-level semantics\n\t ========================================================================== */\n/**\n   * Remove the gray background on active links in IE 10.\n   */\na {\n  background-color: transparent;\n}\n/**\n   * 1. Remove the bottom border in Chrome 57-\n   * 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari.\n   */\nabbr[title] {\n  border-bottom: none;\n  /* 1 */\n  text-decoration: underline;\n  /* 2 */\n  text-decoration: underline dotted;\n  /* 2 */\n}\n/**\n   * Add the correct font weight in Chrome, Edge, and Safari.\n   */\nb,\nstrong {\n  font-weight: bolder;\n}\n/**\n   * 1. Correct the inheritance and scaling of font size in all browsers.\n   * 2. Correct the odd `em` font sizing in all browsers.\n   */\ncode,\nkbd,\nsamp {\n  font-family: monospace, monospace;\n  /* 1 */\n  font-size: 1em;\n  /* 2 */\n}\n/**\n   * Add the correct font size in all browsers.\n   */\nsmall {\n  font-size: 80%;\n}\n/**\n   * Prevent `sub` and `sup` elements from affecting the line height in\n   * all browsers.\n   */\nsub,\nsup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\nsub {\n  bottom: -0.25em;\n}\nsup {\n  top: -0.5em;\n}\n/* Embedded content\n\t ========================================================================== */\n/**\n   * Remove the border on images inside links in IE 10.\n   */\nimg {\n  border-style: none;\n}\n/* Forms\n\t ========================================================================== */\n/**\n   * 1. Change the font styles in all browsers.\n   * 2. Remove the margin in Firefox and Safari.\n   */\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  font-family: inherit;\n  /* 1 */\n  font-size: 100%;\n  /* 1 */\n  line-height: 1.15;\n  /* 1 */\n  margin: 0;\n  /* 2 */\n}\n/**\n   * Show the overflow in IE.\n   * 1. Show the overflow in Edge.\n   */\nbutton,\ninput {\n  /* 1 */\n  overflow: visible;\n}\n/**\n   * Remove the inheritance of text transform in Edge, Firefox, and IE.\n   * 1. Remove the inheritance of text transform in Firefox.\n   */\nbutton,\nselect {\n  /* 1 */\n  text-transform: none;\n}\n/**\n   * Correct the inability to style clickable types in iOS and Safari.\n   */\nbutton,\n[type="button"],\n[type="reset"],\n[type="submit"] {\n  -webkit-appearance: button;\n}\n/**\n   * Remove the inner border and padding in Firefox.\n   */\nbutton::-moz-focus-inner,\n[type="button"]::-moz-focus-inner,\n[type="reset"]::-moz-focus-inner,\n[type="submit"]::-moz-focus-inner {\n  border-style: none;\n  padding: 0;\n}\n/**\n   * Restore the focus styles unset by the previous rule.\n   */\nbutton:-moz-focusring,\n[type="button"]:-moz-focusring,\n[type="reset"]:-moz-focusring,\n[type="submit"]:-moz-focusring {\n  outline: 1px dotted ButtonText;\n}\n/**\n   * Correct the padding in Firefox.\n   */\nfieldset {\n  padding: 0.35em 0.75em 0.625em;\n}\n/**\n   * 1. Correct the text wrapping in Edge and IE.\n   * 2. Correct the color inheritance from `fieldset` elements in IE.\n   * 3. Remove the padding so developers are not caught out when they zero out\n   *    `fieldset` elements in all browsers.\n   */\nlegend {\n  box-sizing: border-box;\n  /* 1 */\n  color: inherit;\n  /* 2 */\n  display: table;\n  /* 1 */\n  max-width: 100%;\n  /* 1 */\n  padding: 0;\n  /* 3 */\n  white-space: normal;\n  /* 1 */\n}\n/**\n   * Add the correct vertical alignment in Chrome, Firefox, and Opera.\n   */\nprogress {\n  vertical-align: baseline;\n}\n/**\n   * Remove the default vertical scrollbar in IE 10+.\n   */\ntextarea {\n  overflow: auto;\n}\n/**\n   * 1. Add the correct box sizing in IE 10.\n   * 2. Remove the padding in IE 10.\n   */\n[type="checkbox"],\n[type="radio"] {\n  box-sizing: border-box;\n  /* 1 */\n  padding: 0;\n  /* 2 */\n}\n/**\n   * Correct the cursor style of increment and decrement buttons in Chrome.\n   */\n[type="number"]::-webkit-inner-spin-button,\n[type="number"]::-webkit-outer-spin-button {\n  height: auto;\n}\n/**\n   * 1. Correct the odd appearance in Chrome and Safari.\n   * 2. Correct the outline style in Safari.\n   */\n[type="search"] {\n  -webkit-appearance: textfield;\n  /* 1 */\n  outline-offset: -2px;\n  /* 2 */\n}\n/**\n   * Remove the inner padding in Chrome and Safari on macOS.\n   */\n[type="search"]::-webkit-search-decoration {\n  -webkit-appearance: none;\n}\n/**\n   * 1. Correct the inability to style clickable types in iOS and Safari.\n   * 2. Change font properties to `inherit` in Safari.\n   */\n::-webkit-file-upload-button {\n  -webkit-appearance: button;\n  /* 1 */\n  font: inherit;\n  /* 2 */\n}\n/* Interactive\n\t ========================================================================== */\n/*\n   * Add the correct display in Edge, IE 10+, and Firefox.\n   */\ndetails {\n  display: block;\n}\n/*\n   * Add the correct display in all browsers.\n   */\nsummary {\n  display: list-item;\n}\n/* Misc\n\t ========================================================================== */\n/**\n   * Add the correct display in IE 10+.\n   */\ntemplate {\n  display: none;\n}\n/**\n   * Add the correct display in IE 10.\n   */\n[hidden] {\n  display: none;\n}\n',""]);const a=r},5988:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,"html,\nbody {\n  overflow: hidden;\n  overflow-y: hidden!important;\n  user-select: none;\n  background-color: var(--semi-color-bg-0) !important;\n  width: 100%;\n  height: 100%;\n}\n#root {\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n}\n:focus-visible {\n  outline: none;\n}\n::-webkit-scrollbar,\n::-webkit-scrollbar-thumb {\n  width: 12px;\n  height: 12px;\n  border-radius: 20px;\n  background-clip: padding-box;\n  border: 2px solid transparent;\n  color: var(--semi-color-fill-2);\n}\n::-webkit-scrollbar-thumb:hover {\n  color: var(--semi-color-fill-2);\n}\n::-webkit-scrollbar-thumb:active {\n  color: var(--semi-color-fill-2);\n}\n::-webkit-scrollbar-thumb {\n  box-shadow: inset 0 0 0 10px;\n}\n::-webkit-scrollbar-corner {\n  display: none;\n}\n.editor-root {\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n  height: 100%;\n}\n.editor-root .root-nav > .semi-tabs-bar {\n  width: 56px;\n  background-color: var(--semi-color-fill-0);\n}\n.editor-root .root-nav > .semi-tabs-bar .semi-icon svg {\n  width: 20px;\n  height: 20px;\n}\n.editor-root .root-nav > .semi-tabs-bar .semi-tabs-tab-button.semi-tabs-tab {\n  padding-left: 8px;\n  height: 46px;\n  padding-top: 10px;\n  margin-bottom: 1px;\n}\n.editor-root .root-nav > .semi-tabs-bar .semi-tabs-tab-button.semi-tabs-tab .semi-icon {\n  margin-left: 8px;\n}\n.editor-root .root-nav > .semi-tabs-bar > .semi-tabs-bar-extra {\n  padding: 10px 0;\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  justify-content: flex-end;\n  align-items: center;\n}\n.editor-root .root-nav > .semi-tabs-bar > .semi-tabs-bar-extra .semi-button svg {\n  width: 20px;\n  height: 20px;\n  color: var(--semi-color-text-2);\n}\n.editor-root .root-nav > .semi-tabs-content {\n  flex: 1;\n  overflow: hidden;\n}\n.editor-root .root-nav > .semi-tabs-content.semi-tabs-content-left {\n  padding-right: 0;\n}\n.editor-root .root-nav > .semi-tabs-content > .semi-tabs-pane {\n  height: 100%;\n}\n.editor-root .root-nav > .semi-tabs-content > .semi-tabs-pane .semi-tabs-pane-motion-overlay {\n  height: 100%;\n}\n.editor-root .left-resizer {\n  width: 6px;\n  cursor: e-resize;\n  border-right: 1px solid var(--semi-color-border);\n}\n.editor-root > .editor-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n.editor-root > .editor-content > .workspace-panel {\n  flex: 1;\n  display: flex;\n  flex-direction: row;\n}\n.editor-root > .editor-content > .workspace-panel .workspace {\n  flex: 1;\n}\n.editor-root > .editor-content > .workspace-panel .config-panel {\n  width: 320px;\n  padding: 4px;\n  border-left: 1px solid var(--semi-color-border);\n}\n.preview-root {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  height: 100%;\n}\n.preview-root > .preview-container {\n  flex: 1;\n}\n.workspace {\n  flex: 1;\n  position: relative;\n  background: var(--semi-color-fill-0);\n  overflow: auto;\n}\n.workspace.preview {\n  overflow: auto;\n}\n.workspace .viewport-container {\n  position: absolute;\n  left: 0;\n  top: 0;\n  background-color: var(--semi-color-bg-0);\n}\n.workspace .viewport-container.preview-full {\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n}\n.workspace .user-panel {\n  background-color: var(--semi-color-bg-0);\n  position: fixed;\n  left: 5px;\n  background: var(--semi-color-bg-0);\n  border: 1px solid var(--semi-color-border);\n  border-radius: 8px;\n}\n.workspace .no-open-file {\n  position: absolute;\n  width: 875px;\n  height: 500px;\n  left: 50%;\n  top: 50%;\n  margin-left: -435px;\n  margin-top: -250px;\n}\n.workspace.show-container .ridge-container {\n  background-color: rgba(var(--semi-light-blue-5), 0.02);\n}\n.workspace.show-container .ridge-droppable {\n  background-color: #97d5ff30;\n}\n.workspace .ridge-element-edit:has(.ridge-element-edit:hover) {\n  outline: none;\n}\n.workspace .ridge-element-edit.selected:hover {\n  outline: none;\n}\n.workspace .ridge-element-edit:hover {\n  outline: 1px dashed var(--semi-color-secondary);\n  outline-offset: 2px;\n}\n.workspace .ridge-element-edit:hover:has(.drop-shadow) {\n  outline: none;\n  outline-offset: 2px;\n}\n.status-drag-over {\n  z-index: 0;\n  background-color: var(--semi-color-primary-light-default);\n  border: 2px dashed var(--semi-color-primary);\n}\nslot {\n  position: relative;\n}\n.code-editor-container .cm-editor .cm-scroller .cm-line {\n  font-family: Menlo,Monaco,Consolas,Courier New,monospace;\n}\n.pop-code-editor-container {\n  width: 420px;\n  margin: 5px 0;\n  height: 240px;\n  overflow: auto;\n  position: relative;\n  background: var(--semi-color-bg-0);\n  border: 1px solid var(--semi-color-border);\n}\n.tree-label {\n  display: flex;\n  margin-left: 5px;\n}\n.tree-label .label-content {\n  flex: 1;\n  height: 24px;\n}\n.tree-label .label-action {\n  display: none;\n}\n.tree-label:hover .label-action {\n  display: initial;\n}\n.tree-label:hover .hover-show {\n  visibility: initial;\n}\n.tree-label .hover-show {\n  visibility: hidden;\n}\n.editor-loading {\n  position: absolute;\n  z-index: 10001;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background-color: var(--semi-color-bg-3);\n}\n.editor-loading .semi-spin {\n  width: 300px;\n}\n.drag-target-hint {\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: rgba(var(--semi-blue-2), 0.2);\n  color: var(--semi-color-primary-hover);\n  border: 2px dashed var(--semi-color-primary-hover);\n  font-size: 1.2em;\n  z-index: 1002;\n  border-radius: 5px;\n  animation: borderPulse 1s ease-in-out infinite;\n}\n/* 脉冲动画关键帧 */\n@keyframes borderPulse {\n  0%,\n  100% {\n    border: 2px dashed var(--semi-color-primary-hover);\n  }\n  50% {\n    border: 2px dashed var(--semi-color-info-light-active);\n  }\n}\n.code-edit-sheet .code-editor-container {\n  border: 1px solid var(--semi-color-border);\n  overflow: auto;\n  width: 100%;\n  height: calc(100% - 60px);\n}\n.code-edit-sheet .no-open-script-file {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  background-color: var(--semi-color-bg-3);\n  align-items: center;\n}\n.code-edit-sheet .semi-tabs .semi-tabs-content {\n  padding: 0;\n}\n.code-edit-sheet .semi-spin {\n  width: 100%;\n  height: 100%;\n}\n.code-edit-sheet .semi-spin .semi-spin-children {\n  width: 100%;\n  height: 100%;\n}\n.code-edit-sheet .semi-sidesheet-header {\n  padding: 6px 18px;\n}\n.code-edit-sheet .semi-sidesheet-header .semi-sidesheet-title {\n  font-size: 16px;\n}\n.code-edit-sheet .semi-sidesheet-body {\n  padding: 0 16px;\n}\n.code-edit-sheet .semi-sidesheet-footer {\n  padding: 6px 18px;\n}\n",""]);const a=r},6628:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,"/**sketch拾取*/\n.sketch-picker {\n  border-radius: 5px;\n  box-shadow: none!important;\n  padding: 0!important;\n}\n/*输入边距Pop*/\n.input-padding-pop {\n  background-color: var(--semi-color-bg-0);\n  height: 100px;\n  width: 280px;\n}\n/*输入边距*/\n.input-padding {\n  position: relative;\n  top: 30px;\n  left: 10px;\n  margin: 0 40px 15px 25px;\n  border: 1px solid #ece;\n  height: 40px;\n  width: 200px;\n}\n.input-padding.position-border .order-0 {\n  left: 50%;\n  margin-left: -35px;\n  top: -12px;\n}\n.input-padding.position-border .order-1 {\n  left: 100%;\n  margin-left: -25px;\n  top: 5px;\n}\n.input-padding.position-border .order-2 {\n  left: 50%;\n  margin-left: -35px;\n  top: 28px;\n}\n.input-padding.position-border .order-3 {\n  left: 0;\n  margin-left: -25px;\n  top: 5px;\n}\n.input-padding.position-corner .order-0 {\n  left: 0;\n  margin-left: -25px;\n  top: -15px;\n}\n.input-padding.position-corner .order-1 {\n  left: 100%;\n  margin-left: -25px;\n  top: -15px;\n}\n.input-padding.position-corner .order-2 {\n  left: 100%;\n  margin-left: -25px;\n  top: 28px;\n}\n.input-padding.position-corner .order-3 {\n  left: 0;\n  margin-left: -25px;\n  top: 28px;\n}\n.input-padding .input-padding-number {\n  position: absolute;\n  background-color: var(--semi-color-bg-0);\n  width: 60px;\n}\n.event-edit {\n  width: 100%;\n}\n.event-edit .tree-label i.bi {\n  font-size: 18px;\n}\n.effect-pop-content {\n  width: 720px;\n  height: 480px;\n  padding: 10px;\n}\n.effect-pop-content .semi-tabs-content {\n  height: 430px;\n}\n.effect-pop-content .semi-tabs-content .semi-tabs-pane-motion-overlay {\n  height: 100%;\n}\n.semi-portal img,\n.semi-portal svg {\n  vertical-align: initial;\n}\n.object-form {\n  padding: 0 3px;\n  height: 100%;\n  overflow-y: overlay;\n}\n.object-form .semi-tabs-pane {\n  width: 100%;\n  height: 100%;\n  overflow: hidden auto;\n  color: var(--semi-color-text-0);\n}\n.object-form img,\n.object-form svg {\n  vertical-align: initial;\n}\n.object-form .event-edit .semi-tree-option-list {\n  padding: 0;\n}\n.object-form .semi-form-horizontal .semi-form-field:last-child {\n  margin-right: 2px;\n}\n.object-form .semi-form-horizontal .semi-form-field {\n  padding-right: 2px;\n}\n.object-form .semi-table-wrapper table thead {\n  display: none;\n}\n.object-form .semi-table-wrapper table .semi-table-tbody > .semi-table-row .btn-code {\n  visibility: hidden;\n}\n.object-form .semi-table-wrapper table .semi-table-tbody > .semi-table-row .btn-code.semi-button-primary {\n  visibility: visible;\n}\n.object-form .semi-table-wrapper table .semi-table-tbody > .semi-table-row:hover .btn-code {\n  visibility: visible;\n}\n.object-form .semi-table-wrapper table td.semi-table-row-cell {\n  padding: 4px 2px;\n}\n.object-form .semi-table-wrapper table td.semi-table-row-cell .semi-form-field {\n  padding: 0;\n}\n.object-form .semi-form .field-block {\n  padding: 4px 0;\n  overflow: hidden;\n}\n.object-form .semi-form .field-block .semi-form-field[x-label-pos=left] .semi-form-field-label {\n  margin-bottom: 0;\n  margin-right: 0;\n  padding-top: 0px;\n  line-height: 26px;\n  min-width: 63px;\n  padding-bottom: 0px;\n  padding-right: 8px;\n  font-weight: normal;\n  color: var(--semi-color-text-2);\n}\n.object-form .semi-form .field-block.full .semi-form-field[x-label-pos=left] .semi-form-field-label {\n  min-width: 63px;\n}\n.object-form .semi-form .with-code-expr {\n  display: flex;\n}\n.object-form .semi-form .with-code-expr .semi-button-tertiary.btn-code {\n  visibility: hidden;\n}\n.object-form .semi-form .with-code-expr .semi-button-tertiary.btn-code.semi-button-primary {\n  visibility: initial;\n}\n.object-form .semi-form .with-code-expr .semi-button-tertiary.is-open {\n  visibility: initial;\n}\n.object-form .semi-form .with-code-expr:hover .semi-button-tertiary.btn-code {\n  visibility: initial;\n}\n.object-form .semi-form .semi-form-field-main > .semi-checkbox {\n  padding: 2px;\n}\n.object-form .semi-form .semi-divider_inner-text {\n  font-size: 14px;\n  font-weight: normal;\n  color: var(--semi-color-text-1);\n}\n.object-form .semi-form .semi-form-field .semi-checkboxGroup-horizontal-cardType {\n  padding-top: 0;\n  padding-bottom: 0;\n  gap: 4px;\n}\n.object-form .semi-form .semi-form-field .semi-checkboxGroup-horizontal-cardType .semi-checkbox {\n  padding: 2px 4px;\n}\n.object-form .semi-form .semi-form-field .semi-checkboxGroup-horizontal-cardType .semi-checkbox .semi-checkbox-addon {\n  font-weight: normal;\n}\n.object-form .semi-form .semi-form-field .semi-radio-addon-buttonRadio-small {\n  padding: 2px 4px;\n}\n.object-form .semi-form .semi-form-field .semi-checkboxGroup-horizontal-pureCardType .semi-checkbox {\n  column-gap: 0;\n  align-items: center;\n  padding: 2px 5px;\n}\n.object-form .state-list-edit {\n  display: flex;\n}\n.object-form .state-list-edit .state-list {\n  flex: 1;\n}\n.object-form .state-list-edit .state-list .list-item {\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n}\n.object-form .state-list-edit .state-list .list-item:hover {\n  background-color: var(--semi-color-fill-1);\n}\n.object-form .state-list-edit .state-list .list-item.is-current {\n  border: 1px solid var(--semi-color-info-light-active);\n  background-color: var(--semi-color-info-light-default);\n}\n.object-form .state-list-edit .state-list .list-item .state-name {\n  padding: 0 5px;\n}\n.object-form .background-edit {\n  display: flex;\n}\n.object-form .background-edit .color-list {\n  flex: 1;\n}\n.object-form .semi-input-number.digit2 {\n  width: 46px;\n}\n.object-form .semi-input-wrapper .semi-input {\n  padding-left: 6px;\n  padding-right: 6px;\n}\n.object-form .semi-input-wrapper .semi-input-append {\n  padding: 0 5px;\n}\n.object-form .semi-input-textarea-wrapper .semi-input-textarea {\n  padding: 0;\n  padding-left: 6px;\n  padding-right: 6px;\n}\n.object-form .semi-input-number-suffix-btns {\n  margin-left: 1px;\n}\n.object-form .picker-button {\n  font-size: 20px;\n  width: 21px;\n  cursor: pointer;\n}\n.pop-icon-container .icon-list {\n  width: 420px;\n  height: 330px;\n  overflow: auto;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 5px;\n}\n.pop-icon-container .icon-list i {\n  cursor: pointer;\n  color: var(--semi-color-tertiary-hover);\n  padding: 5px;\n  width: 40px;\n  height: 40px;\n  font-size: 24px;\n}\n.pop-icon-container .icon-list i:hover {\n  color: var(--semi-color-primary-hover);\n}\n.series-table-edit {\n  border: 1px solid var(--semi-color-border);\n  border-collapse: collapse;\n  font-size: 14px;\n  border-right: none;\n  border-bottom: none;\n}\n.series-table-edit th {\n  background-color: var(--semi-color-fill-1);\n}\n.series-table-edit th:nth-child(1),\n.series-table-edit td:nth-child(1),\n.series-table-edit th.column-plus {\n  background-color: var(--semi-color-fill-1);\n  width: 28px;\n  min-width: 28px;\n}\n.series-table-edit td.row-delete {\n  padding: 0 5px;\n  width: 28px;\n  min-width: 28px;\n  line-height: 14px;\n  color: var(--semi-color-danger);\n  border: none;\n  display: none;\n}\n.series-table-edit td.column-delete {\n  line-height: 14px;\n  cursor: pointer;\n  color: var(--semi-color-danger);\n}\n.series-table-edit tr:hover td.row-delete {\n  width: 28px;\n  border: none;\n  min-width: 28px;\n  cursor: pointer;\n  display: table-cell;\n}\n.series-table-edit td,\n.series-table-edit th {\n  border: 1px solid var(--semi-color-border);\n  padding: 0.1rem 0.5rem;\n  vertical-align: middle;\n  min-width: 60px;\n}\n.series-table-edit th.column-plus,\n.series-table-edit td.row-plus {\n  cursor: pointer;\n}\n.series-table-edit th.column-plus:hover,\n.series-table-edit td.row-plus:hover {\n  background-color: var(--semi-color-fill-0);\n}\n.semi-tree-option-label .item-icon {\n  width: 18px;\n  margin-right: 4px;\n  height: 18px;\n}\n.state-tree-wrapper {\n  width: 480px;\n  display: flex;\n  flex-direction: column;\n  padding: 0;\n  height: 560px;\n  overflow: auto;\n}\n.state-tree-wrapper .semi-tree-option-label i.bi {\n  color: var(--semi-color-primary);\n  margin-right: 6px;\n  font-size: 18px;\n  height: 18px;\n}\n.state-tree-wrapper .semi-tree-option-empty {\n  height: 370px;\n}\n.state-tree-wrapper .semi-tabs {\n  flex: 1;\n}\n",""]);const a=r},7262:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,".outline-tree {\n  height: 100%;\n  overflow: auto;\n}\n.outline-tree img.item-icon {\n  width: 18px;\n  height: 18px;\n  margin-right: 4px;\n}\n.outline-tree .semi-tree-option-label:has(.is-hidden) {\n  opacity: 0.6;\n}\n.outline-tree .tree-label.is-hidden {\n  opacity: 0.6;\n}\n",""]);const a=r},7503:(e,t,n)=>{"use strict";var i=n(5072),o=n.n(i),s=n(7825),r=n.n(s),a=n(7659),l=n.n(a),c=n(5056),d=n.n(c),p=n(540),h=n.n(p),m=n(1113),g=n.n(m),u=n(5886),f={};f.styleTagTransform=g(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=h(),o()(u.A,f),u.A&&u.A.locals&&u.A.locals;var b=n(1594),v=n.n(b),w=n(5873),y=n(2487),x=n(6628),C={};C.styleTagTransform=g(),C.setAttributes=d(),C.insert=l().bind(null,"head"),C.domAPI=r(),C.insertStyleElement=h(),o()(x.A,C),x.A&&x.A.locals&&x.A.locals;var E=n(124),k=n.n(E),S=n(4967),P={};P.styleTagTransform=g(),P.setAttributes=d(),P.insert=l().bind(null,"head"),P.domAPI=r(),P.insertStyleElement=h(),o()(S.A,P),S.A&&S.A.locals&&S.A.locals;var N=n(9011),T=n.n(N),O=n(816),j=n.n(O),L=n(9742),F=(n(9677),n(107)),A=n.n(F);const z=(0,L.d_)("1234567890abcdefghijklmnopqrstuvwxyz",10),D=e=>{return(t=e).substring(t.lastIndexOf("/")+1).split(".")[0];var t},M=e=>{if(null==e)return e;const t=String(e).trim();return/^(auto|inherit|initial|unset|0|calc|min|max|clamp)/.test(t)||/[^\d.]\s*\d/.test(t)?t:`${parseFloat(t)||0}px`},R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/";return e.startsWith(t)?e:t+e},I=(e,t)=>{if(t.startsWith("/"))return t;const n=(e.endsWith("/")?e:e.slice(0,e.lastIndexOf("/")+1)).split("/").filter((e=>e));return t.split("/").forEach((e=>{".."===e?n.pop():"."!==e&&e&&n.push(e)})),"/"+n.join("/")},B=window.showError||function(){},U={set:function(e,t,n){return e[t]=n,globalThis.appModulesNotifier[t]&&globalThis.appModulesNotifier[t](n),!0},get:function(e,t){return e[t]}};globalThis.appModules=new Proxy({},U),globalThis.appModulesNotifier={};const _=e=>{const t=e.match(/import(?:\s*(\w+)\s*(?:,\s*\{([^}]+)\})?|\s*\{([^}]+)\}\s*(?:,\s*(\w+))?)\s*from\s*['"]([^'"]+)['"]|import\s+['"]([^'"]+)['"]/);if(t){let e=[],n=null;return t[1]&&(n=t[1]),t[2]?e=t[2].split(",").map((e=>e.trim())):t[3]&&(e=t[3].split(",").map((e=>e.trim()))),t[4]&&(n=t[4]),{moduleNames:e,defaultModuleName:n,filePath:t[5]||t[6]}}return null},W=T()((async e=>{if(B("load Remote:",e),globalThis.appModules[e])return globalThis.appModules[e];let t=e;if(window.ridge&&window.ridge.baseUrl){const n=window.ridge.baseUrl;t.startsWith(n)||(t=n+e)}B("load Remote:",t);const n=`\n      import * as currentModule from '${t}'\n      globalThis.appModules['${t}'] = currentModule\n    `,i=document.createElement("script");return i.type="module",new Promise(((e,o)=>{try{globalThis.appModulesNotifier[t]=n=>{B("Callback:",t),e(n)},i.textContent=n,document.head.append(i)}catch(t){B("remote js error",t),e(null)}}))})),V=(T()((async e=>{let t=e;return window.ridge&&window.ridge.baseUrl&&(t=window.ridge.baseUrl+"/"+t.replace(/^\/npm/,"").replace(/^\//,"")),B("load Remote:",t),await V(t,{load:async e=>{const t=await window.fetch(e,{mode:"cors",credentials:"include"});return t.ok?await t.text():null}})})),async(e,t)=>{const n=await t.load(e);if(n){const{importStatements:i}=(e=>{const t=[];let n=e;const i=/\bimport\s+(?:(?:(?:\*\s+as\s+)?[\w$]+|(?:\{[\s\w$*,]+?\}))\s+from\s+)?['"][^'"]+['"];?/gm;let o;for(;o=i.exec(e);){const{moduleNames:e,filePath:i}=_(o[0]);t.push({moduleNames:e,filePath:i}),n=n.replace(o[0],"")}return{sourceCode:e,updatedSourceCode:n,importStatements:t}})(n);for(const n of i)if(n.filePath.startsWith("/"))await W(n.filePath);else{const i=I(e,n.filePath);await V(i,t)}const o=function(e,t){const n=/import\s+([\s\S]*?)\s+from\s+(['"])([^'"]+)\2/g,i=[];let o;for(;null!==(o=n.exec(e));)i.push(o[3]);return globalThis.appModules[t]||(globalThis.appModules[t]={}),e.replace(/import\s+(\w+)\s+from\s+(['"])([^'"]+)\2/g,((e,n,i,o)=>`const ${n} = globalThis.appModules['${I(t,o)}'].default;`)).replace(/import\s+(['"])([^'"]+)\1/g,"").replace(n,((e,n,i,o)=>`const ${n} = globalThis.appModules['${I(t,o)}'];`)).replace(/export\s+(\{[^}]+\})/g,`globalThis.appModules['${t}'] = $1;`).replace(/export\s+const\s+(\w+)\s*=/g,`globalThis.appModules['${t}'].$1 = $1;`).replace(/export\s+default\s+(\{[\s\S]*\})/g,`globalThis.appModules['${t}'].default = $1;`)}(n,e),s=document.createElement("script"),r=`(function() {\n      ${o}\n    })()`;s.textContent=r;try{document.head.append(s)}catch(e){}finally{document.head.removeChild(s)}return globalThis.appModules[e]}return null});function J(e){const t=D(e),n=`\n      @font-face {\n          font-family: '${t}';\n          src: url('${e}') format('woff2');\n          font-weight: normal;\n          font-style: normal;\n      }\n  `,i=document.createElement("style");return i.type="text/css",i.textContent=n,document.head.appendChild(i),t}function $(e){const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("HEAD")[0].appendChild(t)}const q=k()("ridge:loader"),H=window.showError||function(){},K=class{constructor(e){let{baseUrl:t,loadPropControl:n}=e;this.baseUrl=t.replace(/\/$/,""),this.loadPropControl=n,q("RidgeLoader baseUrl: "+this.baseUrl),this.loadedFonts=[],this.themeUrls={},this.loadComponent=T()(this._loadComponent),this.loadScript=T()(this._loadScript),this.loadExternal=T()(this._loadExternal),this.loadTextContent=T()(this.loadTextContent),this.loadStoreScript=T()(this.loadStoreScript),this.loadLocalJsModule=V,this.loadRemoteJsModule=W,this.confirmPackageDependencies=T()(this._confirmPackageDependencies),this.loadWebFont=T()(J),this.loadCss=$,this.jsonCache=new Map,this.codeCache=new Map,this.blobCache=new Map}getURIPath(e){return`${this.baseUrl}/${e}`.replace(/(https?:\/\/)|(\/)+/g,((e,t,n)=>t||"/"))}async _loadComponent(e){let t,n;if("object"==typeof e)t=e.packageName,n=e.path;else{const i=e.split("/");i[0].startsWith("@")?(t=i.splice(0,2).join("/"),n=i.join("/")):(t=i.splice(0,1).join("/"),n=i.join("/"))}const i=await this.doLoadComponent({packageName:t,path:n});return i&&(i.componentPath=e),i}async doLoadComponent(e){let{packageName:t,path:n}=e;q("doLoadComponent",t,n);const i=await this.getPackageJSON(t);if(null==i)return null;await this.confirmPackageDependencies(t);let o=null;return i.ridgeDist?(await this.loadScript(`${i.name}/${i.ridgeDist}`),o=window[i.name][n]):o=await this.loadComponentScript({packageName:t,path:n}),o&&await this.prepareComponent(o,{packageName:t,path:n},i),o}async prepareComponent(e,t){let{packageName:n,path:i}=t;if(e.packageName=n,e.path=i,e.title=e.title||e.label,Array.isArray(e.externals))for(const t of e.externals)t.startsWith("/")?await this.loadScript(t):await this.loadScript(n+"/"+t);if(e.component){if("function"==typeof e.component&&"AsyncFunction"===e.component.constructor.name&&(e.component=(await e.component()).default),this.loadPropControl)for(const t of e.props||[])t&&t.control&&"function"==typeof t.control&&t.control.toString().startsWith("()")&&(t.controlComponent=(await t.control()).default),t.options&&"function"==typeof t.options&&t.options.toString().startsWith("()")&&(t.optionsLoads=await t.options())}else q("组件 Component定义未加载到",e)}on(e,t){this.eventCallbacks.push({eventName:e,callback:t})}async loadComponentScript(e){let{packageName:t,path:n}=e;await this.loadScript(`${t}/build/${n}.js`);const i=`${t}/${n}`;return window[i]?window[i].default:null}removeCss(e){if(!e)return;const t=Array.from(document.head.children).filter((e=>"link"===e.tagName.toLowerCase()));for(const n of t)n.href.endsWith(e)&&document.head.removeChild(n)}getFinalCDNUrl(e){let t=e.replace(/\/\//g,"/");t.startsWith("/")||(t="/"+t),t=this.baseUrl+t,t.startsWith("/")||t.indexOf("")}async _loadScript(e){if(null!=e)try{let t=e.replace(/\/\//g,"/");if(t.startsWith("/")||(t="/"+t),Array.from(document.querySelectorAll("script")).find((e=>e.src&&e.src.endsWith(t)))||Array.from(document.querySelectorAll("link")).find((e=>e.href&&e.href.endsWith(t))))return q("Script loaded: ",t),t;const n=this.baseUrl+t;return H("Load:"+n),n.endsWith(".css")?await $(n):await async function(e){if(!e||"string"!=typeof e)throw new Error("Invalid script URL provided");let t;try{t=new URL(e,window.location.href)}catch(t){throw new Error(`Malformed script URL: ${e}`)}if(!["https:","http:"].includes(t.protocol))throw new Error(`Unsupported protocol: ${t.protocol}`);return function(e){Array.from(document.querySelectorAll("script[src]")).find((t=>t.src===e))}(e),new Promise(((n,i)=>{const o=document.createElement("script");o.src=e,t.origin!==window.location.origin&&(o.crossOrigin="anonymous"),o.onload=()=>{window.showError&&window.showError(`Script successfully: ${e}`),n()},o.onerror=t=>{window.showError&&window.showError(`Failed to load script: ${e}`,t),o.parentNode&&o.parentNode.removeChild(o),i(new Error(`Script load failed: ${e}`))},document.head.appendChild(o)}))}(n),t}catch(t){console.error("JS Load Error:",`${e}`)}}async getPackageJSON(e){return this.loadJSON(`${e}/package.json`)}async _confirmPackageDependencies(e){q("_confirmPackageDependencies",e);const t=await this.getPackageJSON(e);if(null==t)return;const n=Object.keys(t.dependencies||{});for(const e of n)await this.loadExternal(e);const i=t.externals||t.prepares,o=[];if(Array.isArray(i))for(const e of i)e.startsWith("/")?o.push(await this.loadScript(e)):o.push(await this.loadScript(t.name+"/"+e));await Promise.allSettled(o),window.ridgeTheme&&window.ridgeTheme[e]?this.loadPackageTheme(e,window.ridgeTheme[e]):t.themes&&this.loadPackageTheme(e,t.themes.default)}async loadPackageTheme(e,t){this.themeUrls[e]&&this.removeCss(this.themeUrls[e]),$(this.baseUrl+"/"+t),this.themeUrls[e]=t}async _loadExternal(e){q("_loadExternal",e);const t=j().externals.filter((t=>t.module===e))[0];if(t){if(q("Found External Package",t),t.root&&window[t.root])return;if(t.dependencies)for(const e of t.dependencies)await this.loadExternal(e);if(Array.isArray(t.dist)){const e=[];for(const n of t.dist)e.push(this.loadScript(n));await Promise.allSettled(e)}else"string"==typeof t.dist&&await this.loadScript(t.dist)}}async loadStoreScript(e){return W(e)}async fetchJSON(e){H("Fetch:"+e);const t=await window.fetch(e,{mode:"cors",credentials:"include"});return t.ok?await t.json():null}async loadTextContent(e){const t=this.getURIPath(e);H("Fetch:"+t);const n=await window.fetch(t,{mode:"cors",credentials:"include"});return n.ok?await n.text():null}setJSONCache(e,t){const n=this.getURIPath(e);this.jsonCache.set(n,t)}async loadJSON(e){const t=this.getURIPath(e);if(!this.jsonCache.get(t)){const e=await this.fetchJSON(t);e&&this.jsonCache.set(t,e)}return this.jsonCache.get(t)}};var X=n(6366),Z=n(1263),Y=n.n(Z),G=n(6123),Q=n.n(G);const ee=e=>{try{return JSON.parse(JSON.stringify(e))}catch(t){return e}};function te(e){return e&&"object"==typeof e&&e.constructor===Object}function ne(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return e===t;const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const o of n)if(!i.includes(o)||!ne(e[o],t[o]))return!1;return!0}const ie=new Map,oe=k()("ridge:store"),se=k()("ridge:store-error");class re{constructor(e,t){this.module=e,this.composite=t,this.watchers={"*":new Set},this.state={},this.globals={},this.context=new Proxy(this,{get:function(e,t){switch(t){case"context":return e.composite.context;case"composite":return e.composite;case"emit":return(t,n)=>{e.composite.emit(t,ee(n))};case"setState":return t=>{Object.assign(e.state,t)};case"properties":return e.properties;case"state":return e.state;case"scope":return;default:if(void 0!==e.state[t])return e.computedUsedState&&e.computedUsedState.push(t),e.state[t];if(e.module.actions&&e.module.actions[t])return e.module.actions[t];if(e.module.computed&&e.module.computed[t]){if("function"==typeof e.module.computed[t])return e.module.computed[t].call(e.context);if("function"==typeof e.module.computed[t].get)return e.module.computed[t].get.call(e.context)}else{if(void 0!==e.properties[t])return e.properties[t];if(void 0!==e.globals[t])return e.globals[t];if(window[t])return window[t]}}},set:function(e,t,n){return void 0!==e.state[t]?e.state[t]=n:e.globals[t]=n,!0}}),this.scheduledJobs=new Set}async initStore(e,t){if(this.properties=e,this.globalVariables=t,"function"==typeof this.module.state)try{this.state=(0,X.BX)(this.module.state(e))}catch(e){console.error("initStore Error",e)}else"object"==typeof this.module.state?this.state=(0,X.BX)(ee(this.module.state)):this.state=(0,X.BX)({});for(const e of this.module.properties||[])null==this.properties[e.name]&&null!=e.value&&(this.properties[e.name]=e.value);if(this.module.externals)if(Array.isArray(this.module.externals))for(const e of this.module.externals)await this.composite.context.loadScript(e);else if("string"==typeof this.module.externals)await this.composite.context.loadScript(this.module.externals);else for(const e of Object.keys(this.module.externals))await this.composite.context.loadScript(this.module.externals[e]);if(Array.isArray(this.module.dependencies))for(const e of this.module.dependencies)await this.composite.context.loadScript(e);if(this.state&&(0,X.B1)(this.state,(e=>{this.onMutations(e)})),this.module.setup)try{const e=await async function(e,t){if(!t)return await e(),-1;const n=performance.now();return await e(),performance.now()-n}((async()=>{await this.module.setup.call(this.context,this.context)}),k().enabled);e>-1&&k()("Module Setup:",this.module.name,"Duration:",e+"ms"),this.storeSetUp=!0,this.flushScheduledJobs()}catch(e){console.error("Module Setup Error!",this.module,e)}}updateProps(e){this.properties=e;const t=[];for(const n in e)this.watchers[n]&&t.push(...this.watchers[n]),this.module.watch&&this.module.watch[n]&&this.module.watch[n].call(this.context,e[n],e);this.scheduleCallback(t),this.module.update&&this.module.update.call(this.context,e),this.flushScheduledJobs()}subscribe(e,t,n){const i=t.join(".");switch(e){case"state":case"prop":this.addWatchers(i,n);break;case"computed":if(this.module.computed&&this.module.computed[i])if(Array.isArray(this.module.computed[i].dependencies))for(const e of this.module.computed[i].dependencies)this.addWatchers(e,n);else 0===(this.module.computed[i].get||this.module.computed[i]).length&&this.addWatchers("*",n)}}addWatchers(e,t){null==this.watchers[e]&&(this.watchers[e]=new Set),this.watchers[e].add(t)}getValue(e,t,n){let i=null;if("state"===e)i=Q()(this.state,t);else if("computed"===e){const e=[...n];e.push(this.context.state);const o=this.module.computed[t];if(o){this.computedUsedState=[];try{"function"==typeof o?i=o.call(this.context,...e):"function"==typeof o.get&&(i=o.get.call(this.context,...e))}catch(e){console.error("getValue Error",e),this.storeSetUp&&console.error("ComputedError: ",o,n)}}}else if("prop"===e)return this.context.properties[t];return null!=i&&(i=ee(i)),i}dispatchChange(e,t,n,i){if("state"===e)Y()(this.state,t.split("."),n);else if("computed"===e&&this.module.computed&&"function"==typeof this.module.computed[t]?.set)try{this.module.computed[t]?.set.call(this.context,n,this.state,...i)}catch(e){se("dispatchChange Error",e)}}doStoreAction(e,t){let{scopedData:n,payload:i,eventArgs:o}=t;if(this.module.actions&&this.module.actions[e])try{const t=[];(function(e){if(ie.has(e))return ie.get(e);const t="function"==typeof e&&/^[^{]*=>/.test(e.toString());return ie.set(e,t),t})(this.module.actions[e])&&t.push(this.context),""!==o&&t.push(o),n&&n.length&&t.push(...n),null!=i&&(Array.isArray(i)?t.push(...i):t.push(i));const s=function(e,t){if(!t)return e(),-1;const n=performance.now();return e(),performance.now()-n}((()=>{const n=this.module.actions[e].call(this.context,...t);"object"==typeof n&&this.context.setState(n)}),k().enabled);s>-1&&k()("Action Dura",e,t,s)}catch(e){console.error("doStoreAction Error",e)}}onMutations(e){for(const t of e){const[e,n,i,o]=t;oe("mutation",e,n.join("."),i,o),this.onStateChange(n,i,o)}this.flushScheduledJobs()}onStateChange(e,t,n){const i=e.join("."),o=[],s=new Set;this.watchers["*"]&&o.push(...this.watchers["*"]);const r=Object.keys(this.watchers);for(const e of r)(e.startsWith(i)||i.startsWith(e+".")||e===i)&&o.push(...this.watchers[e]);const a=Object.keys(this.module.watch||{});for(const e of a)(e.startsWith(i)||i.startsWith(e+".")||e===i)&&s.add(this.module.watch[e]);o.push(...Array.from(s).map((e=>()=>{e.call(this.context,n,t)}))),this.scheduleCallback(o)}scheduleCallback(e){for(const t of e)this.scheduledJobs.add(t)}flushScheduledJobs(){for(const e of this.scheduledJobs)try{e()}catch(e){console.error("job exec error",e)}this.scheduledJobs.clear()}destory(){this.module.destory&&this.module.destory.call(this.context)}}const ae="Promote",le="props",ce=k()("ridge:store");k()("ridge:store-error");class de{constructor(e){this.composite=e,this.properties=e.properties,this.storeObjects={}}setProperties(e){this.properties=e;for(const t of Object.values(this.storeObjects))t.updateProps(e)}load(e,t){for(const n of Array.isArray(e)?e:[e])this.registerPageStore(n,t)}getStoreValue(e,t){const[n,i,...o]=e.split(".");return n===ae&&i===le?this.properties[o[0]]:this.storeObjects[n]?this.storeObjects[n].getValue(i,o.join("."),t):void 0}subscribe(e,t){if(e)try{const[n,i,...o]=e.split(".");ce("subscribe",e),this.storeObjects[n]&&this.storeObjects[n].subscribe(i,o,t)}catch(t){console.error("subscribe error",e,t)}}dispatchChange(e,t,n){const[i,o,...s]=e.split(".");this.storeObjects[i]&&this.storeObjects[i].dispatchChange(o,s.join("."),t,n)}doStoreAction(e,t,n){this.storeObjects[e]&&this.storeObjects[e].doStoreAction(t,n)}registerPageStore(e,t){if(ce("RegisterPageStore",e),!e.name)return void ce("Store Not Registered: No Name");const n=e.name;this.storeObjects[n]=new re(e,this.composite),this.storeObjects[n].initStore(t)}destory(){for(const e of Object.values(this.storeObjects))e.destory()}}class pe{async mount(){}setOption(e){}updateProps(e){}layout(e){}invoke(e,t){}on(e,t){}destroy(){}}class he extends pe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.JSXComponent=e,this.props=t,this.props.ref||(this.props.ref=React.createRef()),this.renderRef=this.props.ref}mount(e){this.el=e,this.root=ReactDOM.createRoot(e),this.root.render(this.getRenderInstance())}getRenderInstance(){return React.createElement(this.JSXComponent,this.props)}on(e,t){Object.assign(this.props,{[e]:t}),this.root.render(React.createElement(this.JSXComponent,this.props),this.el)}invoke(e,t){if(this.renderRef&&this.renderRef.current&&this.renderRef.current[e]&&"function"==typeof this.renderRef.current[e])return this.renderRef.current[e](...t||[])}hasMethod(e){return this.renderRef&&this.renderRef.current&&this.renderRef.current[e]&&"function"==typeof this.renderRef.current[e]}setOption(e){this.updateProps(e)}updateProps(e){this.props=Object.assign({},e,{ref:this.props.ref});try{this.renderRef&&this.renderRef.current&&"function"==typeof this.renderRef.current.updateProps&&this.renderRef.current.updateProps(e),this.root.render(this.getRenderInstance())}catch(e){console.error("React update error",e)}}layout(e){ReactDOM.render(React.createElement(this.JSXComponent,e),this.el)}destroy(){this.root.unmount(),this.renderRef&&(this.renderRef=null)}}class me extends pe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.VannilaComponent=e,this.props=t}mount(e){this.el=e,this.getRenderInstance().mount(e)}getRenderInstance(){return this.instance||(this.instance=new this.VannilaComponent(this.props)),this.instance}on(e,t){this.instance.on(e,t)}invoke(e,t){if(this.getRenderInstance()[e])return this.getRenderInstance()[e].apply(this.getRenderInstance(),t)}hasMethod(e){return null!=this.getRenderInstance()[e]}setOption(e){this.updateProps(e)}updateProps(e){this.getRenderInstance().update(e)}layout(){this.getRenderInstance().layout()}destroy(){this.instance&&(this.instance.destroy&&this.instance.destroy(),this.instance=null)}}const ge=e=>function(){let{scope:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};class n extends React.Component{constructor(e){super(e),this.scope=e.scope,this.ref=React.createRef(),this.ridgeElement=null}componentDidMount(){this.props.scope?this.ridgeElement?(this.ridgeElement.setScopedData(this.props.scope),this.ridgeElement.forceUpdate()):(this.ridgeElement=this.props.element.clone(),this.ridgeElement.setScopedData(this.props.scope),this.ridgeElement.mount(this.ref.current)):(this.ridgeElement=this.props.element,this.ridgeElement.mount(this.ref.current))}componentWillUnmount(){}render(){return React.createElement("div",{ref:this.ref,style:{width:"100%",height:"100%"}})}}return React.createElement(n,{element:e,scope:t})},ue=class{async load(){}async mount(e){}setProperties(e){}unmount(){}invoke(){}setStatus(e,t){this.status=e,this.el&&this.el.classList.add("status-"+e)}getStatus(){return this.status}removeStatus(e){if(this.status=null,this.el)for(const t of this.el.classList)e?t==="status-"+e&&this.el.classList.remove(t):t.startsWith("status-")&&this.el.classList.remove(t)}},fe=(e,t,n)=>{const i=e.classList;let o=!1;for(let s=0;s<i.length;s++)if(i[s].startsWith(t+":")){o=!0;const r=i[s].substring(t.length+1),a=r.split("-");if(n)e.classList.remove(r);else{if(a.length>1){const t=Array.from(e.classList).filter((e=>e.startsWith(a[0]+"-")));if(t.length>1){e.setAttribute("cache-pseduo-"+a[0],t.join(","));for(const n of t)e.classList.remove(n)}}e.classList.add(r)}}return o},be=(e,t,n)=>{const i=e.querySelectorAll(".has-pseudo-"+t);e.classList.contains("has-pseudo-"+t)&&fe(e,t,n);for(const e of i)fe(e,t,n)},ve=(e,t)=>{if(Array.isArray(e)){const n=[],i=e.map((e=>{const[i,o]=e.split("/");return o?(t.loader.confirmPackageDependencies(i),we(o,n)):we(e,n)}));for(const e of n)i.push("has-pseudo-"+e);return i}return[]},we=(e,t)=>{const[n,i]=e.split(":");return i&&t.push(n),e},ye=k()("ridge:element");class xe extends ue{constructor(e){let{config:t,composite:n,componentDefinition:i}=e;super(),this.config=t,this.uuid="ins-"+z(8),this.composite=n,this.componentDefinition=i,this.properties={},this.events={},ye("create",this.config.id),this.onMounted((()=>{this.bindDOMEvents()}))}getId(){return this.config.id}getProperties(){return Object.assign({width:this.style.width,height:this.style.height,visible:this.style.visible,__composite:this.composite,__applyEffect:this.composite.context.applyEffect.bind(this.composite.context)},this.config.props,this.events,this.properties,{children:this.children})}getConfig(){return this.config}getEl(){return this.el}getParent(){return this.parent}getScopedData(){const e=this.getParent(),t=e?e.getScopedData():[];return null==this.scopedData?t:[this.scopedData,...t]}setScopedData(e){this.scopedData=e}async load(e){if(this.componentDefinition||this.config.path&&(this.componentDefinition=await this.composite.context.loader.loadComponent(this.config.path)),this.componentDefinition){if(e&&this.config.props.children)for(const e of this.config.props.children){const t=this.composite.getNode(e);t&&await t.load(!0)}return!0}return this.setStatus("not-found"),!1}firstPaint(e){e&&(this.el=e),ye("el first paint",this.config.title,this),this.firstPainted=!0,this.setStatus("Loading"),this.el.setAttribute("ridge-title",this.config.title),this.el.setAttribute("ridge-mount","mounting"),this.style=Object.assign({},this.config.style),this.updateStyle()}async mount(e){if(e){if(this.el&&this.el!==e){ye("Do Unmount Before Mount");try{this.unmount()}catch(e){}}this.el=e}if(this.el&&(ye("mounting",this.config.id,this),this.el.ridgeNode=this,this.firstPainted||this.firstPaint(),this.forceUpdateStyle(),this.componentDefinition||await this.load(),this.componentDefinition))try{this.initializeEvents(),this.initSubscription(),this.updateConnectedProperties(),this.preparePropsBeforeRender(),this.createRenderer(),this.mounted&&this.mounted(),ye("mounted",this.config.id,this),this.el.setAttribute("ridge-mount","mounted"),this.removeStatus()}catch(e){console.error("ridge element mount error:",e)}}getIsMounted(){return this.isMounted}mounted(){this.mounteds&&this.mounteds.forEach((e=>e(this))),this.isMounted=!0}onMounted(e){!0===this.isMounted?e(this):(this.mounteds||(this.mounteds=[]),this.mounteds.push(e))}initChildren(){if(this.config.props.children&&null==this.children){this.children=[];for(const e of this.config.props.children){const t=this.composite.getNode(e);t&&(t.parent=this,this.children.push(t),t.initChildren())}}if(this.config.slots&&this.config.slots.length)for(const e of this.config.slots){const t=this.composite.getNode(e);t&&(t.parent=this,t.isSlot=!0,t.initChildren())}}initializeEvents(){var e=this;if(this.componentDefinition.props){const e=this.componentDefinition.props.find((e=>"value"===e.name||!0===e.input));e&&(this.inputKey=e.name)}this.inputKey&&this.config.propEx[this.inputKey]&&(this.events.input=e=>{this.composite.store.dispatchChange(this.config.propEx[this.inputKey],e,this.getScopedData())},this.events.onChange=e=>{this.composite.store.dispatchChange(this.config.propEx[this.inputKey],e,this.getScopedData())});for(const[t,n]of Object.entries(this.config.events??{}))this.events[t]=function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];if(Array.isArray(n)){for(const t of n)if(t.store&&t.method){const n={payload:o,scopedData:e.getScopedData(),eventArgs:t.payload};e.composite.store.doStoreAction(t.store,t.method,n)}}else"promoted"===n&&e.composite.emit(e.getId()+"-"+t,o)}}bindDOMEvents(){this.el&&this.el.classList.contains("ridge-is-hoverable")&&(this.el.addEventListener("mouseenter",this.handleMouseOver),this.el.addEventListener("mouseleave",this.handleMouseOut)),this.el&&this.el.classList.contains("ridge-is-selectable")&&(this.el.addEventListener("selected",(e=>{be(e.target,"selected")})),this.el.addEventListener("unselected",(e=>{be(e.target,"selected",!0)})))}initSubscription(){te(this.config.styleEx)&&Object.values(this.config.styleEx).forEach((e=>{this.composite.store?.subscribe&&this.composite.store.subscribe(e,(()=>{this.forceUpdateStyle()}))})),te(this.config.propEx)&&Object.values(this.config.propEx).forEach((e=>{this.composite.store?.subscribe&&this.composite.store.subscribe(e,(()=>{this.forceUpdateProperty()}))}))}createRenderer(){if(null==this.componentDefinition)return null;const{type:e="vanilla"}=this.componentDefinition;try{switch(e){case"vanilla":this.renderer=new me(this.componentDefinition.component,this.getProperties()),this.renderer.mount(this.el);break;case"react":this.renderer=new he(this.componentDefinition.component,this.getProperties()),this.renderer.mount(this.el)}}catch(e){this.setStatus("render-error",{code:"R_ERR",error:e}),console.error("组件初始化渲染异常",this.componentDefinition,e)}}forceUpdateStyle(){const e={width:this.style.width,height:this.style.height,visible:this.style.visible};this.updateConnectedStyle(),this.updateStyle(),ne(e,{width:this.style.width,height:this.style.height,visible:this.style.visible})||this.updateProps()}forceUpdateProperty(){this.updateConnectedProperties(),this.updateProps()}forceUpdate(){this.forceUpdateStyle(),this.forceUpdateProperty()}updateProps(e){e&&Object.assign(this.properties,e),ye("updateProps",this.config.id,this.properties),this.renderer&&this.el&&"mounted"===this.el.getAttribute("ridge-mount")?(this.preparePropsBeforeRender(),this.renderUpdate()):ye("updateProps umounted",this.getId(),this)}renderUpdate(){const e=this.getProperties();try{ye("updateProps",this.config.id,e),this.renderer.updateProps(e)}catch(t){console.error("Render Error:",t,this,e)}}updateConnectedStyle(){if(this.composite.store)for(const e of Object.keys(this.config.styleEx||{}))null!=this.config.styleEx[e]&&""!==this.config.styleEx[e]&&(this.style[e]=this.composite.store.getStoreValue(this.config.styleEx[e],this.getScopedData()))}updateChildStyle(e){this.invoke("updateChildStyle",[e])}updateStyle(){this.el&&(this.el.setAttribute("component",this.config.path),this.el.setAttribute("ridge-id",this.config.id),this.el.setAttribute("ridge-title",this.config.title),this.el.classList.add("ridge-element"),!1===this.style.visible?this.el.classList.add("ridge-runtime-hidden"):this.el.classList.remove("ridge-runtime-hidden"),this.parent&&this.parent.updateChildStyle(this),this.invoke("onStyleUpdated",[this]),this.styleUpdated&&this.styleUpdated())}updateConnectedProperties(){if(this.composite.store&&te(this.config.propEx))for(const[e,t]of Object.entries(this.config.propEx))if(null!=t&&""!==t)if(t.startsWith(ae+"."+le)){const[n,i,o]=t.split(".");o&&null!=this.composite.properties[o]&&(this.config.props[e]=this.composite.properties[o])}else try{this.properties[e]=this.composite.store.getStoreValue(t,this.getScopedData())}catch(e){ye("updateConnectedProperties Fail",t,e)}}getSlotPropValue(e){return e?(e.parent=this,e.isSlot=!0,"react"===this.componentDefinition.type?ge(e):e):null}needPrepareProps(){}prepareSlotProperties(){}preparePropsBeforeRender(){if(!this.componentDefinition)return;if(!te(this.config.props))return;let e=0;for(let t=0;t<(this.componentDefinition.props||[]).length;t++){const n=this.componentDefinition.props[t];if("image"===n.type||"file"===n.type){const e=this.config.props[n.name]||this.properties[n.name];null!=e&&""!==e&&(this.properties[n.name]=this.composite.getBlobUrl(e,this.composite.packageName))}else if("slot"===n.type){delete this.properties[n.name];const t=this.config.props[n.name];if(t){const e=this.composite.getNode(t);this.properties[n.name]=this.getSlotPropValue(e)}else if(Array.isArray(this.children)){for(const e of this.children)e.config.title===n.name&&(this.properties[n.name]=this.getSlotPropValue(e));if(null==this.properties[n.name]){const t=this.children[e];this.properties[n.name]=this.getSlotPropValue(t),e++}}}else if("decorate"===n.type){const e=this.config.props[n.name];e&&(this.properties[n.name]=this.composite.getNode(e))}else"style"===n.type&&(this.properties[n.name]=ve(this.config.props[n.name],this.composite))}}handleMouseOver(e){be(e.target,"hover")}handleMouseOut(e){be(e.target,"hover",!0)}clone(){const e=new xe({composite:this.composite,componentDefinition:this.componentDefinition,config:this.config});if(this.children){e.children=[];for(const t of this.children){const n=t.clone();n.parent=e,e.children.push(n)}}return e.isSlot=this.isSlot,e.parent=this.parent,e}invoke(e,t){if(this.renderer)return this.renderer.invoke(e,t)}hasMethod(e){return!!this.renderer&&this.renderer.hasMethod(e)}unmount(){this.isMounted=!1,this.renderer&&(this.renderer.destroy(),this.renderer=null,this.el=null)}}const Ce=xe,Ee=k()("ridge:composite"),ke=class extends ue{constructor(e){let{id:t,packageName:n,compositePath:i,properties:o,config:s,appPackageObject:r,context:a}=e;super(),this.id=t,this.config=ee(s),this.compositePath=i,this.context=a,this.appPackageObject=r,this.loader=a.loader,this.packageName=n,this.properties=o||s.properties,this.CLASS_LIST=["ridge-composite"],this.dataReady=!0,this._hoveredElements=[]}async loadConfig(){this.config=ee(await this.context.loadComposite(this.packageName,this.compositePath)),null!=this.config&&this.config.elements||(this.config=null)}firstPaint(e){Ee("Composite FP",e,this.config.compositePath,this.config),e&&(this.el=e),this.initialClassList=Array.from(this.el.classList),this.firstPainted=!0,this.updateStyle(),this.initializeNodes(),this.el.closest('[composite-id="'+this.getCompositeId()+'"]')!==this.el&&this.setStatus("Circular"),this.children=[];for(const e of this.config.children??[]){const t=this.getNode(e);if(t){const e=document.createElement("div");this.el.appendChild(e),t.parent=this,this.children.push(t),t.firstPaint(e)}}}initializeNodes(){this.nodes={};for(let e=0;e<this.config.elements.length;e++){const t=this.createElement(this.config.elements[e]);this.nodes[t.getId()]=t}this.initChildren(),this.events={}}async initialize(){return Ee(this.packageName,this.compositePath,"initialize start"),this.config||(this.config=await this.context.loadComposite(this.packageName,this.compositePath)),!!this.config}async loadChildren(){const e=[];this.config||(this.config=await this.context.loadComposite(this.packageName,this.compositePath));for(const t of Object.values(this.nodes))e.push(await t.load());await Promise.allSettled(e)}getCompositeId(){return this.id||`${this.packageName??""}${this.compositePath}`}getNodes(e){const t=Object.values(this.nodes);return e?t.filter(e):t}getNode(e){return this.nodes[e]}getRootNode(e){return this.children.filter((t=>t.id===e))[0]}getBlobUrl(e){return this.context.getBlobUrl(e,this.packageName)}initChildren(){this.config.children?this.children=Array.from(new Set(this.config.children)).map((e=>this.nodes[e])).filter((e=>e)):this.children=Object.values(this.nodes).filter((e=>null==e.config.parent));for(const e of this.children)e.parent=this,e.initChildren()}createElement(e){return new Ce({composite:this,config:e})}getJsModules(){return this.jsModules||[]}async mount(e,t){Ee("Composite Moute: ",this.packageName,this.compositePath);try{this.beforeMount&&this.beforeMount(e)}catch(e){}if(e&&(this.el=e,e.ridgeComposite&&e.ridgeComposite.unmount(),this.el.ridgeComposite=this),this.removeStatus(),this.config||(Ee("Loading Config",this.packageName,this.compositePath),this.setStatus("Loading"),await this.loadConfig()),this.removeStatus("Loading"),!this.config)return this.setStatus("Page-not-found"),Ee("Config Not Found",this.packageName,this.compositePath),void(this.onPageNotFound&&this.onPageNotFound(this));if(this.firstPainted||this.firstPaint(),this.appPackageObject||(Ee("Load PackageJSON",this.packageName,this.compositePath),this.appPackageObject=await this.context.loadAppPackageJSON(this.packageName)),t&&(Ee("Apply theme",this.packageName,this.compositePath),window.ridgeTheme={},this.appPackageObject.themes))for(const e of Object.keys(this.appPackageObject.themes))window.ridgeTheme[e]=this.appPackageObject.themes[e];await this.importJSFiles(),await this.loadStore(),this.updatePromotedElement(),this.dataReady=!0,Ee("JS Imported: ",this.packageName,this.compositePath),this.emit("postMount"),this.postMount&&await this.postMount(),Ee("Mount Root Elements: ",this.packageName,this.compositePath);const n=[];for(const e of this.children??[])n.push(e.mount());await Promise.allSettled(n),Ee("Mounted Roots ",this.packageName,this.compositePath),this.initializeEvents(),this.emit("mounted"),this.mounted&&this.mounted(),this.importFontFiles()}async mountRootComponents(){}unmount(){if(this.el.className=this.initialClassList.join(" "),this.el.removeAttribute("composite-id"),this.config){for(const e of this.children){const t=e.el;try{e.unmount()}catch(e){}t&&t.parentElement===this.el&&this.el.removeChild(t)}this.store&&this.store.destory()}this.el.removeEventListener("mouseover",this.handleMouseOver),this.el.removeEventListener("mouseout",this.handleMouseOut)}updateStyle(){if(this.el.setAttribute("composite-id",this.getCompositeId()),this.config&&this.config.style&&this.el){this.el.style.background="",this.config.style.widthFix?(this.el.style.width=this.config.style.width+"px",this.el.style.overflowX="hidden"):this.el.style.width="100%",this.config.style.heightFix?(this.el.style.height=this.config.style.height+"px",this.el.style.overflowY="hidden"):this.el.style.height="100%";const e=ve(this.config.classList,this);this.el.className=[...this.initialClassList,"ridge-composite",...this.CLASS_LIST,...e].join(" ")}}updateChildStyle(e){if(e.el)if(e.config.full)e.el.classList.add("ridge-is-full"),e.el.style.transform="none",e.el.style.width="",e.el.style.height="";else{const t=e.style;e.el.classList.remove("ridge-is-full"),e.el.style.position="absolute",e.el.style.left=0,e.el.style.top=0,e.el.style.transform=`translate(${t.x}px, ${t.y}px)`,e.el.style.width=t.width?M(t.width):"",e.el.style.height=t.height?M(t.height):"",t.portalled&&!this.isEdit&&(e.el.style.width=0,e.el.style.height=0)}}getScopedData(){return[]}async importJSFiles(){const{jsFiles:e}=this.config;Ee("Load importJSFiles",this.packageName,this.compositePath,e);const t=[];for(const n of e??[])try{const e=await this.context.loadModule(this.packageName,n);if(e&&e.default){const i=e.default;i.filePath=n,e.jsContent&&(i.jsContent=e.jsContent),t.push(i)}}catch(e){console.error("JS Module Load Fail: ",this.packageName+"/"+n)}this.jsModules=t}importFontFiles(){const{fontFiles:e}=this.config;if(this.fontList=[],e)for(const t of e)Ee("loadWebFont",t),this.fontList.push({label:t.split("/").pop(),value:D(t)}),this.loader.loadWebFont(t)}initializeEvents(){this.el.onclick=e=>{e.target===this.el&&this.emit("onClick",[e])}}handleMouseOver(e){if(this.currentHoverTarget=e.target,window.requestAnimationFrame((()=>{this.setHoveredElementClassList()})),e.target.contains(e.relatedTarget))return;const t=e.target.classList;for(let n=0;n<t.length;n++)if(t[n].startsWith("hover:")){const i=t[n].substring(6);e.target.classList.add(i)}}setHoveredElementClassList(e){for(const e of this._hoveredElements)this.setHoveredClassList(e,!0)}setHoveredClassList(e,t){const n=e.classList;let i=!1;for(let o=0;o<n.length;o++)if(n[o].startsWith("hover:")){i=!0;const s=n[o].substring(6);t?e.classList.remove(s):e.classList.add(s)}return i}handleInternalEventConfig(e,t){if(this.config.events&&this.config.events[e])for(const n of this.config.events[e])n.store&&n.method&&this.store.doStoreAction(n.store,n.method,{payload:t,eventArgs:n.payload})}on(e,t){this.events[e]=t}emit(e,t){this.handleInternalEventConfig(e,t),this.events[e]&&this.events[e](t??[]),this.properties[e]&&"function"==typeof this.properties[e]&&this.properties[e].call(null,t)}setProperties(e){this.properties=e,this.store&&this.store.setProperties(this.properties),this.updatePromotedElement()}updatePromotedElement(){if(this.nodes)for(const e of Object.values(this.nodes))for(const[t,n]of Object.entries(e.config.propEx||{}))if("string"==typeof n&&n.startsWith(ae+"."+le)){const[i,o,s]=n.split(".");this.properties[s]&&(e.config.props[t]=this.properties[s],e.forceUpdateProperty())}}async loadStore(){Ee("Load loadStore",this.packageName,this.compositePath,this.jsModules,this.properties),this.store=new de(this);try{this.store.load(this.jsModules,this.properties)}catch(e){console.error("Store Load Fail: ",e)}}async loadScript(e){await this.loader.loadScript(e)}};window.createDebug=k();const Se="1.4.0",Pe=class{constructor(e){let{baseUrl:t,loadPropControl:n}=e;this.VERSION=Se,this.baseUrl=t,console.log("Ridge Runtime  Version:1.4.0, baseUrl:"+this.baseUrl);const i=new K({baseUrl:this.baseUrl,loadPropControl:n});this.loader=i,this.services={loader:i}}parseRidgePath(e){const t=e.split("/").filter((e=>e));if(t[0].startsWith("@")){if(t.length>=3){const[e,n,...i]=t;return{packageName:e+"/"+n,compositePath:i.join("/")}}return null}if(t.length>=2){const[e,...n]=t;return{packageName:e,compositePath:n.join("/")}}return null}createCompositeByPath(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.parseRidgePath(e);return n?new ke({context:this,packageName:n.packageName,compositePath:n.compositePath,properties:t}):null}createComposite(e,t,n){try{return new ke({context:this,packageName:e,compositePath:t.startsWith("/")?t:"/"+t,properties:n})}catch(e){return console.error("createComposite error",e),null}}async loadComposite(e,t){if(t){const n=t.endsWith(".json")?t:t+".json";return this.loader.loadJSON(`${e}/${n}`)}{const t=e.endsWith(".json")?e:e+".json";return this.loader.loadJSON(t)}}getBlobUrl(e,t){return e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:")||e.startsWith("/")?e:e.startsWith("composite://")?t?this.baseUrl+"/"+t+R(e.substring(12)):this.baseUrl+R(e.substring(12)):this.baseUrl+"/"+e}async loadAppPackageJSON(e){const t=await this.loader.getPackageJSON(e);return this.applyPackageObjectSetting(t),t}async loadFileContent(e){return this.loader.loadTextContent(e)}async loadModule(e,t){let n="";return t.startsWith("composite://")?n=("/"+e+"/"+t.substring(12)).replace(/\/\//g,"/"):t.startsWith("/")&&(n=t),W(n)}async loadScript(e){return this.loader.loadScript(e)}async loadPlugin(e){let t=e;if("string"==typeof e&&(t=await this.loader.getPackageJSON(e)),await this.loader.confirmPackageDependencies(t.name),t.plugin){const e=(await W("/"+t.name+"/"+t.plugin)).default;return e.packageName=t.name,e}}async applyEffect(e,t,n){try{if(!e||"string"!=typeof e)return;const[i,o]=e.split("/"),s=await this.loadPlugin(i);s&&s.apply&&s.apply(o,t,(()=>{n&&n()}))}catch(e){console.error("Apply Plugin Error",e)}}applyPackageObjectSetting(e){if(e.global&&te(e.global))for(const[t,n]of Object.entries(e.global))globalThis.hasOwnProperty(t)||(globalThis[t]=n)}};function Ne(){return Ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ne.apply(null,arguments)}const Te=e=>{let{app:t,path:n,ridge:i,...o}=e;const s=(0,b.useRef)(null);let r=i;return r||(r=globalThis.ridge),r?((0,b.useEffect)((()=>{r.createComposite(t,n,o).mount(s.current)}),[t,n]),(0,b.useEffect)((()=>{s.current.ridgeComposite&&s.current.ridgeComposite.setProperties(o)})),v().createElement("div",{ref:s,className:"composite-view",style:{width:"100%",height:"100%"}})):(console.error("请在页面引入ridgejs库"),v().createElement(v().Fragment,null,"请在页面引入ridgejs库"))};window.Ridge=Pe,window.ridgejs={VERSION:Se,ReactComposite:Te,withRidgePlugin:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"effect";const n=n=>{const{__applyEffect:i,...o}=n,s=(0,b.useRef)(null);return(0,b.useEffect)((()=>{i&&i(n[t],s.current)}),[n[t]]),v().createElement(e,Ne({},o,{ridgePluginRef:s}))};return n.displayName=`withRidgePlugin(${e.displayName||e.name||"Component"})`,n}};const Oe=Pe;var je=n(4881),Le=n.n(je),Fe=n(7354),Ae=n.n(Fe),ze=n(3917),De=n.n(ze),Me=n(2461),Re=n.n(Me);const Ie=async e=>{const t=await fetch(e);return await t.blob()},Be=async e=>{const t=await Ie(e);return await t.text()},Ue=(e,t)=>new Blob([e],{type:t}),_e=async(e,t)=>new Promise((n=>{const i=new FileReader;i.addEventListener("load",(()=>{n(i.result)}),!1),i.readAsDataURL(e,{type:t})})),We=(e,t)=>{const n=document.createElement("a");e instanceof Blob?n.href=window.URL.createObjectURL(e):n.href=window.URL.createObjectURL(new Blob([e],{type:"text/plain"})),n.download=t||e.name||"下载",n.rel="noopener",setTimeout((function(){URL.revokeObjectURL(n.href)}),4e4),setTimeout((function(){!function(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}(n)}),0)};var Ve=n(2139);const Je=(e,t)=>e.filter((e=>-1===e.parent)).map((n=>Xe(n,null,e,t))).sort($e),$e=(e,t)=>"directory"===e.type&&"directory"===t.type?e.label>t.label?1:-1:"directory"===e.type?-1:"directory"===t.type||e.label>t.label?1:-1,qe=async(e,t)=>{for(const n of e)await t(n),n.children&&await qe(n.children,t)},He=(e,t)=>{const n=[];return e.forEach((e=>{t(e)&&n.push(e),e.children&&n.push(...He(e.children,t))})),n},Ke=(e,t)=>{const n=[];return e.forEach((e=>{const i=t(e);i&&(e.children?(i.children=Ke(e.children,t),i.children.length&&n.push(i)):n.push(i))})),n},Xe=(e,t,n,i)=>{const o={id:e.id,key:e.id,name:e.name,label:e.name,type:e.type,path:-1===e.parent?"/"+e.name:t.path+"/"+e.name,parent:e.parent,parentNode:t,raw:e,value:e.id};if(e.mimeType&&(o.mimeType=e.mimeType),"directory"===o.type){const t=n.filter((t=>t.parent===e.id));o.children=t.map((e=>Xe(e,o,n,i))).sort($e)}return i&&i(o),o};var Ze=n(1756),Ye=n(2206);const Ge=new Map;Ge.set(".js","text/javascript"),Ge.set(".json","text/json"),Ge.set(".md","text/markdown"),Ge.set(".woff","application/font-woff"),Ge.set(".gif","image/gif"),Ge.set(".jpeg","image/jpeg"),Ge.set(".jpg","image/jpeg"),Ge.set(".png","image/png"),Ge.set(".svg","image/svg+xml"),Ge.set(".zip","application/zip"),Ge.set(".mid","audio/midi"),Ge.set(".mp4a","audio/mp4"),Ge.set(".m4a","audio/mp4a-latm"),Ge.set(".ogg","audio/ogg"),Ge.set(".aac","audio/x-aac"),Ge.set(".m3u","audio/x-mpegurl"),Ge.set(".wma","audio/x-ms-wma"),Ge.set(".ico","image/x-icon"),Ge.set(".css","text/css"),Ge.set(".csv","text/csv"),Ge.set(".html","text/html"),Ge.set(".txt","text/plain"),Ge.set(".avi","video/x-msvideo");const Qe=e=>Ge.get("."+e)||"application/"+e,et=n.p+"7afa99d3d66a4b39fbeab64182e3117c.zip",tt=n(1791);class nt{constructor(e){this.appService=e,this.coll=e.collection,this.backUpStorage=De().createInstance({name:"ridge-store"}),this.store=e.store,this.archiveColl=new(Le())("ridge.backup.db")}async backup(){const e=await this.appService.getPackageJSONObject();if(e){const t=(0,Ve.formateDate)(),n=`${e.name}-${e.version}-${t}`,i=await this.getAppBlob();await this.backUpStorage.setItem(n,i);const o={backUpName:n,name:e.name,version:e.version};await this.archiveColl.insert(o)}}async recover(e){const t=await this.backUpStorage.getItem(e);t&&await this.importAppArchive(t)}async listAllHistory(){return await this.archiveColl.find({})}async deleteHistory(e){await this.archiveColl.findOne({backUpName:e})&&(await this.archiveColl.remove({backUpName:e}),await this.backUpStorage.removeItem(e))}async exportFileArchive(e){const t=await this.coll.findOne({id:e});if("directory"===t.type){const e=await this.coll.find({}),n=new(Re()),i=Xe(t,null,e);await this.zipFolder(n,[i]);const o=await n.generateAsync({type:"blob"});We(o,t.name+".zip")}else{const n=await this.store.getItem(e);n&&("page"===t.type?We(new Blob([JSON.stringify(n,null,2)]),t.name+".json"):We(await Ie(n),t.name))}}async importFileArchive(e,t){const{appService:n}=this;if(t.name.endsWith(".json")){const i=JSON.parse(await t.text());i.elements?await n.createPage(e,(0,Ve.basename)(t.name,".json"),i):await n.createFile(e,new File([JSON.stringify(i)],t.name,{type:"text/json"}))}else await n.createFile(e,t)}async getAppBlob(){const e=new(Re()),t=await this.coll.find({}),n=Je(t);return await this.zipFolder(e,n),await e.generateAsync({type:"blob"})}async exportAppArchive(e){const t=await this.getAppBlob();We(t,e.name+"-"+e.version+".zip")}async zipFolder(e,t){for(const n of t)if("directory"===n.type){const t=e.folder(n.label);await this.zipFolder(t,n.children)}else{const t=await this.store.getItem(n.key);"page"===n.type?e.file(n.label+".json",JSON.stringify(t,null,2)):e.file(n.label,await Ie(t))}}async importHelloArchive(){const e=await fetch(et),t=await e.arrayBuffer();await this.importAppArchive(t)}async importAppArchive(e){const t=new(Re());try{await t.loadAsync(e)}catch(e){return console.error("invalid zip file",e),!1}const{appService:n}=this;await this.coll.clean(),await this.store.clear();const i=[];t.forEach((async(e,t)=>{i.push({filePath:e,zipObject:t})}));for(const{filePath:e,zipObject:t}of i)t.dir?await n.ensureDir(e):await this.importSingleFile(e,t);return i}async importFolderArchive(e,t){const n=new(Re());try{await n.loadAsync(e)}catch(e){return console.error("invalid zip file",e),!1}const{appService:i}=this,o=[];n.forEach((async(e,t)=>{o.push({filePath:e,zipObject:t})}));for(const{filePath:e,zipObject:n}of o)n.dir?await i.ensureDir(t+"/"+e):await this.importSingleFile(t+"/"+e,n);return o}async importSingleFile(e,t){const{appService:n}=this,i=await n.ensureDir((0,Ve.dirname)(e)),o=i?i.id:-1,s=(0,Ve.basename)(t.name),r=(0,Ve.extname)(t.name);if(e.endsWith(".json")){const e=JSON.parse(await t.async("text"));e.elements?await n.createComposite(o,(0,Ve.basename)(s,".json"),e):await n.createFile(o,s,new File([JSON.stringify(e,null,2)],s),"text/json")}else{const e=Qe(r);await n.createFile(o,s,new File([await t.async("blob")],s,{type:e}),Qe(r))}}async getPackageLatestVersion(e,t){}async importFromRidgeCloud(e){try{const t=(await Ze.A.get(`/api/app/storage/share/${e}`,{responseType:"arraybuffer"})).data;await this.importAppArchive(t)}catch(e){return null}}async importFromNpmRegistry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.0.0";const n=await Ze.A.get(`https://registry.npmjs.org/${e}/-/${e}-${t}.tgz`,{responseType:"arraybuffer"}),i=tt.ungzip(n.data),o=new Ye.TarReader,s=await o.readFile(new Blob([i.buffer],{type:"application/gzip"})),{appService:r}=this;await r.collection.clean(),await r.store.clear();for(const e of s)if(e.name.startsWith("package")){const t=e.name.substring(7),n=o.getFileBlob(e.name),i=await r.ensureDir((0,Ve.dirname)(t)),s=i?i.id:-1,a=(0,Ve.basename)(t),l=(0,Ve.extname)(t);if(t.endsWith(".json")){const n=JSON.parse(o.getTextFile(e.name));n.elements?(await r.deleteFileByPath(t.substring(0,t.length-5)),await r.createComposite(s,(0,Ve.basename)(a,".json"),n)):(await r.deleteFileByPath(t),await r.createFile(s,a,new File([JSON.stringify(n)],a),"text/json"))}else await r.deleteFileByPath(t),await r.createFile(s,a,new File([n],a,{type:Qe(l)}),Qe(l))}await r.updateAppFileTree()}}const it={version:Se,style:Object.assign({width:1290,height:960,classNames:[]}),properties:{},cssFiles:[],jsFiles:[],elements:[]},ot={name:"ridge-hello-app",version:"1.0.0",description:"Hello Ridge应用",keywords:["ridge-webapp"],ridgeType:"app",themes:{},dependencies:{"ridge-container":"1.0.0"}},{nanoid:st,extname:rt}=n(2139),at=k()("ridge:app-service");class lt{constructor(e){this.collection=new(Le())("ridge.app.db"),this.store=De().createInstance({name:"ridge-store"}),this.backUpService=new nt(this),this.loader=e,this.dataUrlByPath={},this.dataUrls={},this.fileTree=null,this.init=Ae()(this._init)}async _init(){0===(await this.collection.find({})).length&&(console.log("No files found in workspace"),await this.backUpService.importHelloArchive()),await this.getAppFileTree()}getFileTree(){return this.fileTree}mapFileTree(e){return Ke(this.fileTree,e)}getUITreeData(e){return Ke(this.fileTree,(t=>"directory"===t.type||e(t)?{isLeaf:"directory"!==t.type,disabled:"directory"===t.type,label:t.label,value:t.path,key:t.path}:null))}filterFiles(e){return He(this.fileTree,e)}getFileByPath(e){const t=He(this.fileTree,(t=>t.path===e));return t.length>0?t[0]:null}async getAppFileTree(){if(!this.fileTree){const e=await this.getFiles();this.updateFileBlobUrls(e),this.fileTree=Je(e)}return this.fileTree}async updateAppFileTree(){at("Update File Tree");const e=await this.getFiles();this.updateFileBlobUrls(e),this.fileTree=Je(e)}async updateFileBlobUrls(e){const t={};for(const n of e)if("page"!==n.type&&"directory"!==n.type)if(this.dataUrls[n.id])t[n.id]=this.dataUrls[n.id];else{const e=await this.store.getItem(n.id);t[n.id]=e}this.dataUrls=t}async createDirectory(e,t){if(at("createDirectory",e,t),await this.collection.findOne({parent:e,name:t}))throw new Error("File existed",t);const n={parent:e,id:st(10),name:t,type:"directory"};return await this.collection.insert(n)}async createComposite(e,t,n){if(at("createComposite",e,t),await this.collection.findOne({parentId:e,name:t}))throw new Error("File existed",t);const i=st(10),o=n??it,s={id:i,name:t,type:"page",parent:e,mimeType:"text/json"};return await this.store.setItem(i,o),await this.collection.insert(s),s}async createFile(e,t,n,i){if(at("createFile",e,t),await this.collection.findOne({parent:e,name:t}))throw new Error("File existed",t);const o=st(10),s=await _e(n,i);let r=!1;if("application/json"===n.type){const t=await Be(s);try{const n=JSON.parse(t);n.elements&&n.children&&(r=!0,this.createComposite(e,n.name,n))}catch(e){}}if(!r){await this.store.setItem(o,s);let r=n.type||i;return r||(r=Qe(rt(t))),await this.collection.insert({id:o,mimeType:r,size:n.size,name:t,parent:e})}}async updateFileContent(e,t,n){at("updateFileContent",e,t);const i=this.filterFiles((t=>t.id===e))[0];i&&(i.textContent=t,await this.store.setItem(e,await(async(e,t)=>{const n=new Blob([e],{type:t});return await _e(n)})(t,i.mimeType)))}async savePageContent(e,t){await this.store.setItem(e,t)}async rename(e,t){const n=await this.collection.findOne({id:e});return!!n&&(!await this.collection.findOne({parent:n.parent,name:t})&&(await this.collection.patch({id:e},{name:t}),!0))}async checkNewNameValid(e,t){return await this.collection.findOne({parent:e,name:t})}async move(e,t){const n=await this.collection.findOne({id:e});return n.parent!==t&&(!await this.collection.findOne({parent:t,name:n.name})&&(await this.collection.patch({id:e},{parent:t}),await this.updateAppFileTree(!0),!0))}async copy(e){const t=await this.collection.findOne({id:e});if(t){const n=st(10),i={id:n,name:t.name+"_"+n,type:t.type,parent:t.parent,mimeType:t.mimeType,copyFrom:e};await this.collection.insert(i);const o=await this.store.getItem(t.id);o&&await this.store.setItem(n,o),await this.updateAppFileTree(!0)}}async deleteFile(e){let t=null;if(t="string"==typeof e?await this.collection.findOne({id:e}):e,t){"directory"!==t.type&&await this.store.removeItem(t.id);const e=await this.collection.find({parent:t.id});if(e.length)for(const t of e)await this.deleteFile(t.id);return await this.collection.remove({id:t.id}),!0}return!1}async deleteFileByPath(e){const t=await this.getFileByPath(e);return!!t&&await this.deleteFile(t)}async savePackageJSONObject(e){const t=this.getFileByPath("/package.json");await this.updateFileContent(t.key,JSON.stringify(e,null,2))}async getPackageJSONObject(){this.fileTree||await this.init();const e=this.getFileByPath("/package.json");if(null==e)return null;try{const t=await this.getFileContent(e);return JSON.parse(t)}catch(e){}}async publishApp(e){const t=await this.getAppPackageBlob(),n=new FormData;n.append("file",t);const i=await Ze.A.post(`/api/npm/publish?npm=${!!e}`,n);return{message:i.data.msg,type:200!==i.data.code?"error":"success"}}async getFiles(e){const t={};e&&(t.name=new RegExp(e));const n=await this.collection.find(t);return n.filter((e=>-1===e.parent&&"package.json"===e.name))[0]||n.push(await this.createFile(-1,"package.json",Ue(JSON.stringify(ot,null,2),"text/json"))),n}async getFile(e){at("getFile",e);let t=await this.collection.findOne({id:e});if(t||(t=this.getFileByPath(e)),t&&"directory"!==t.type){if(t.content=await this.store.getItem(t.id),t.mimeType&&t.mimeType.startsWith("text")&&"string"==typeof t.content&&t.content.startsWith("data:")){const e=await Be(t.content);at("textContent",e),t.textContent=e}return t}}async ensureDir(e){const t=e.split("/");let n=-1,i=null;for(const e of t)e&&(i=await this.collection.findOne({parent:n,name:e}),null==i&&(i=await this.createDirectory(n,e)),n=i.id);return i}async getRecentPage(){const e=await this.collection.find({parent:-1,type:"page"},{sort:{name:1}});return 0===e.length?this.createPage(-1):{...e[0],...await this.store.getItem(e[0].id)}}async getFilePath(e){if(e.parent&&-1!==e.parent){const t=await this.getFile(e.parent);return await this.getFilePath(t)+"/"+e.name}return e.name}async getByMimeType(e){const t=await this.collection.find({mimeType:new RegExp(e)});for(const e of t)"file"===e.type&&(e.src=await this.store.getItem(e.id));return t}async isParent(e,t){let n=await this.getFile(t);for(;-1!==n.parent;){if(n.parent===e)return!0;n=await this.getFile(n.parent)}return!1}async updateDataUrl(){const e=await this.getByMimeType("image");for(const t of e)this.dataUrls[t.id]=t.dataUrl}getDataUrl(e){if(e.startsWith("/")){const t=this.getFileByPath(e);return t?this.dataUrls[t.id]:null}return this.dataUrls[e]}async getFileContent(e){const t=await this.store.getItem(e.key);return e.mimeType&&e.mimeType.indexOf("text")>-1?await Be(t):await Ie(t)}async getFileContentByPath(e){const t=this.getFileByPath(e);return t?await this.getFileContent(t):null}async exportFileArchive(e){await this.backUpService.exportFileArchive(e)}async getAppFileBlob(){return this.backUpService.getAppBlob()}async exportAppArchive(){const e=await this.getPackageJSONObject();await this.backUpService.exportAppArchive(e)}async exportPage(e){const t=await this.collection.findOne({id:e}),n=await this.store.getItem(e);n&&("page"===t.type?We(new Blob([JSON.stringify(n)]),t.name+".json"):We(await Ie(n),t.name))}async getAppPackageBlob(){return this.backUpService.getAppBlob()}async reset(){await this.collection.clean(),await this.store.clear(),window.location.reload()}async backupCurrentApp(){await this.backUpService.backup()}async importFromNpmRegistry(e,t){return await this.backupCurrentApp(),await this.backUpService.importFromNpmRegistry(e,t)}async importFromRidgeCloud(e){return await this.backupCurrentApp(),await this.backUpService.importFromRidgeCloud(e)}async importAppArchive(e){return await this.backupCurrentApp(),await this.backUpService.importAppArchive(e,this.collection,this.store)}async backUpAppArchive(e){await this.backUpService.createHistory(this.collection,e)}async recoverBackUpAppArchive(e){await this.backUpService.recover(e)}async getAllBackups(){return await this.backUpService.listAllHistory()}async removeBackup(e){return await this.backUpService.deleteHistory(e)}async exportArchive(){this.backUpService.exportColl(this.collection)}async archive(){}}class ct{async getPackage(e){return(await Ze.A.get(`https://registry.npmjs.org/${e}`)).data}}var dt=n(1648),pt=n(5222),ht={};ht.styleTagTransform=g(),ht.setAttributes=d(),ht.insert=l().bind(null,"head"),ht.domAPI=r(),ht.insertStyleElement=h(),o()(pt.A,ht),pt.A&&pt.A.locals&&pt.A.locals;var mt=n(2529);const gt=e=>new mt.Ay(document.body,Object.assign({dimensionViewable:!0,deleteButtonViewable:!1,container:document.body,snappable:!1,snapGap:!1,isDisplayInnerSnapDigit:!1,draggable:!0,resizable:!0,scalable:!1,rotatable:!1,warpable:!1,pinchable:!1,origin:!0,keepRatio:!1,edge:!1,throttleDrag:0,throttleResize:1,throttleScale:0,throttleRotate:0,clipTargetBounds:!0},e));var ut=n(2362),ft=n.n(ut),bt=n(5250);function vt(e,t){for(const{code:n,currentComment:i}of t)if(new RegExp(e+" *[:(]").test(n)&&i)return i;return e}const wt=e=>{const t=[];for(const n of e.jsModules??[])t.push(...(n.properties??[]).map((e=>Object.assign({},e,{field:"properties."+e.name}))));for(const n of Object.values(e.nodes))for(const[e,i]of Object.entries(n.config.propEx||{}))if("string"==typeof i&&i.startsWith(ae+"."+le)){const[o,s,r]=i.split(".");xt(n,e),t.push((0,bt.cloneDeep)(Object.assign(xt(n,e),{label:r,field:"properties."+r})))}return t},yt=e=>{const t=[];for(const n of e.jsModules??[])t.push(...(n.events??[]).map((e=>Object.assign({},e,{control:"event",field:"events."+e.name}))));for(const n of e.getNodes())Object.entries(n.config.events).forEach((e=>{let[i,o]=e;if("promoted"===o){const e=n.componentDefinition?n.componentDefinition.events.find((e=>e.name===i))?.label:i;t.push({label:n.config.title+"-"+e,control:"event",field:"events."+n.getId()+"-"+i})}}));return t},xt=(e,t)=>e.componentDefinition&&e.componentDefinition.props?e.componentDefinition.props.filter((e=>e.name===t))[0]:null,Ct=(e,t,n,i)=>{const o={key:n+e,label:vt(e,i)};if((0,bt.isPlainObject)(t)){o.children=[];for(const s in t)s.startsWith("_")||o.children.push(Ct(s,t[s],n+e+".",i))}return o},Et=e=>{try{const t={key:e.name+".connect",icon:React.createElement("i",{className:"bi bi-window-dock"}),disabled:!1,label:e.label??e.name,children:[]},n={key:e.name+".event",label:e.label??e.name,children:[]},i=function(e){const t=e.split("\n"),n=[];let i=null;for(let e=0;e<t.length;e++){const o=t[e].trim();let s=null,r=null,a=o;if(o.startsWith("//"))r=o.substring(2).trim(),a="";else{const e=a.indexOf("// ");-1!==e&&(a=a.substring(0,e).trim(),s=o.substring(e+2).trim())}const l={lineNumber:e+1,code:a,previousComment:e>0&&null!==i?i:null,currentComment:s};n.push(l),i=null!==r?r:null}return n.filter((e=>e.currentComment||e.previousComment))}(e.jsContent);if(e.properties){const n={key:e.name+".properties",label:"属性",children:[]};for(const t of e.properties)n.children.push({key:e.name+".prop."+t.name,label:t.label??t.name});n.children.length&&t.children.push(n)}if(e.state){const n={key:e.name+".state",label:"状态",children:[]};let o={};"function"==typeof e.state?o=e.state({}):"object"==typeof e.state&&(o=e.state);for(const t of Object.keys(o))t.startsWith("_")||n.children.push(Ct(t,o[t],e.name+".state.",i));n.children.length&&t.children.push(n)}if(e.computed){const n={key:e.name+".computed",label:"计算值",children:[]};for(const t of Object.keys(e.computed))n.children.push({key:e.name+".computed."+t,label:vt(t,i)});n.children.length&&t.children.push(n)}return e.actions&&"object"==typeof e.actions&&Object.keys(e.actions||{}).forEach((t=>{t.startsWith("_")||n.children.push({name:e.name+"."+t,label:vt(t,i)})})),{name:e.name,events:e.events??[],properties:e.properties??[],connects:t,actions:n}}catch(t){return console.error("jsStoreModule Parse Error",e),{error:t}}},kt=".ridge-editor-element",St=k()("ridge:workspace");class Pt{init(e){let{workspaceEl:t,viewPortEl:n,context:i}=e;this.workspaceEl=t,this.viewPortEl=n,this.context=i,this.zoom=1,this.selectorDropableTarget=[".ridge-container",".ridge-droppable"],this.initKeyBind(),this.initComponentDrop(),this.viewPortX=0,this.viewPortY=0,this.dragActive=!0,this.selected=[],this.viewPortEl.style.transformOrigin="top left"}enable(){this.initSelecto(),this.initMoveable(),this.setWorkSpaceMovable(),this.enabled=!0}setDragActive(e){this.dragActive=e}disable(){this.enabled&&(this.selecto.destroy(),this.selecto=null,this.moveable.destroy(),this.moveable=null,this.workspaceMovable&&(this.workspaceMovable.destroy(),this.workspaceMovable=null),this.enabled=!1,this.viewPortEl.style.transform="")}updateMovable(){this.moveable.updateTarget()}fitByWidth(){const e=this.workspaceEl.getBoundingClientRect(),t=this.viewPortEl.getBoundingClientRect();this.viewPortX=292,this.viewPortY=7;const n=e.width-300-314;return t.width<n?this.zoom=1:t.width<2*n?this.zoom=Math.floor(n/t.width*100)/100:this.zoom=.5,this.viewPortEl.style.transform=`translate(${this.viewPortX}px, ${this.viewPortY}px) scale(${this.zoom})`,this.zoom}fitToCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;this.viewPortEl.style.transform="";const t=this.workspaceEl.getBoundingClientRect(),n=this.viewPortEl.getBoundingClientRect();this.zoom=1;const i=function(e,t){if(e.width<t.width&&e.height<t.height)return e;const n={};return e.width/e.height>t.width/t.height?(n.fitTo="width",n.width=parseInt(t.width),n.height=Math.floor(e.height*(t.width/e.width))):(n.fitTo="height",n.width=Math.floor(e.width*(t.height/e.height)),n.height=parseInt(t.height)),n}({width:n.width,height:n.height},{width:t.width-2*e,height:t.height-2*e});return i.width!==n.width?(this.viewPortX=0,this.viewPortY=0,this.zoom):(this.viewPortX=(t.width-i.width)/2,this.viewPortY=(t.height-i.height)/2,this.viewPortEl.style.transform=`translate(${this.viewPortX}px, ${this.viewPortY}px) scale(${this.zoom})`,this.zoom)}setZoom(e){this.zoom=e,this.moveable&&(this.moveable.target=[],this.moveable.updateTarget()),this.viewPortEl.style.transform=`translate(${this.viewPortX}px, ${this.viewPortY}px) scale(${this.zoom})`}getTransform(){return{viewPortX:this.viewPortX,viewPortY:this.viewPortY,zoom:this.zoom}}setTransform(e){let{viewPortX:t=0,viewPortY:n=0,zoom:i=1}=e;this.viewPortX=t,this.viewPortY=n,this.zoom=i,this.viewPortEl.style.transform=`translate(${this.viewPortX}px, ${this.viewPortY}px) scale(${this.zoom})`,setTimeout((()=>{this.workspaceEl.scrollTo({top:0,left:0,behavior:"smooth"})}),500)}setWorkSpaceMovable(){this.workspaceMovable=gt({target:this.workspaceEl,className:"workspace-movable"}),this.workspaceMovable.on("dragStart",(e=>{e.inputEvent.ctrlKey?(this.workspaceMovable.dragWorkSpace=!0,this.moveable.target=[]):this.workspaceMovable.dragWorkSpace=!1})),this.workspaceMovable.on("drag",(e=>{e.inputEvent.ctrlKey&&this.workspaceMovable.dragWorkSpace&&(this.moveable.target=null,this.viewPortX+=e.delta[0],this.viewPortY+=e.delta[1],this.viewPortEl.style.transform=`translate(${this.viewPortX}px, ${this.viewPortY}px) scale(${this.zoom})`)}))}isElementMovable(e){return null!=this.moveable.target&&1===this.moveable.target.length&&this.moveable.target[0]==e}initMoveable(){const e=this,{context:t}=this;this.moveable=gt({target:[],snappable:!0}),this.moveable.on("dragStart",(e=>{if(!this.dragActive)return!1;const n=e.target;n.ridgeNode&&n.ridgeNode.parent&&n.ridgeNode.parent!==t.editorComposite&&(this.moveable.dragMill=(new Date).getTime())})),this.moveable.on("drag",(t=>{if(!this.dragActive)return!1;const n=t.target;if(!e.isTargetMovable(n))return;if(this.workspaceMovable.dragWorkSpace)return;if(this.moveable.dragMill&&(new Date).getTime()-this.moveable.dragMill<280)return;this.moveable.dragMill&&(e.onElementDragStart(n,t.inputEvent),this.moveable.dragMill=null);const i=t.inputEvent,o=n.ridgeNode.config;n.style.transform=`translate(${o.style.x+t.dist[0]}px,${o.style.y+t.dist[1]}px)`,n.style.zIndex=1010,this.checkDropTargetStatus({target:n,clientX:i.clientX,clientY:i.clientY})})),this.moveable.on("dragEnd",(t=>{if(!this.dragActive)return!1;const n=t.target;n.style.zIndex="",t.isDrag&&e.isTargetMovable(n)&&null==this.moveable.dragMill?e.placeElementAt(n,t.clientX,t.clientY):e.selectElements([n])})),this.moveable.on("resize",(t=>{let{target:n,width:i,height:o,drag:s,delta:r,transform:a}=t;if(!e.isTargetResizable(n))return;const l={};a.match(/[0-9.]+/g),l.x=s.translate[0],l.y=s.translate[1],r[0]&&(l.width=Math.round(i)),r[1]&&(l.height=Math.round(o)),n.ridgeNode.updateStyleConfig(l)})),this.moveable.on("resizeEnd",(e=>{let{target:t,width:n,height:i,delta:o,transform:s}=e;t.ridgeNode.forceUpdate(),this.selectElements([t])})),this.moveable.on("dragGroup",(n=>{let{events:i}=n;i.forEach((n=>{let{target:i,transform:o}=n;e.isTargetMovable(i)&&i.ridgeNode.parent===t.editorComposite&&(i.style.transform=o)}))})),this.moveable.on("dragGroupEnd",(e=>{e.events.forEach((e=>{let{target:n}=e;if(n.ridgeNode.parent===t.editorComposite){const e=n.getBoundingClientRect();this.putElementToRoot(n,e.left+e.width/2,e.top+e.height/2)}}))})),this.moveable.on("resizeGroup",(t=>{let{events:n}=t;n.forEach((t=>{let{target:n,width:i,height:o,delta:s,transform:r}=t;e.isTargetResizable(n)&&(n.style.transform=r,s[0]&&(n.style.width=`${i}px`),s[1]&&(n.style.height=`${o}px`))}))})),this.moveable.on("resizeGroupEnd",(e=>{e.events.forEach((e=>{let{target:n}=e;if(!n.ridgeNode.config.parent){const e=n.getBoundingClientRect();t.updateComponentConfig(n.ridgeNode,{style:{x:e.left+e.width/2,y:e.top+e.height/2}})}}))}))}initSelecto(){this.selecto=new dt.Ay({rootContainer:null,dragContainer:this.workspaceEl,selectableTargets:[kt],selectByClick:!0,selectFromInside:!0,continueSelect:!1,toggleContinueSelect:"ctrl",preventDefault:!0,keyContainer:window,hitRate:0}),this.selecto.on("dragStart",this.onSelectoDragStart.bind(this)),this.selecto.on("selectEnd",this.onSelectoDragEnd.bind(this))}onSelectoDragStart(e){const t=e.inputEvent,n=t.target;if(n.classList&&(n.classList.contains("moveable-area")||n.classList.contains("moveable-control")))return void e.stop();if(t.ctrlKey)return void e.stop();if(n.closest(".menu-bar"))return void e.stop();const i=n.closest(kt);if(this.isElementMovable(i))e.stop();else if(!i||this.isTargetSelectable(i))if(i){if(this.moveable.target&&1===this.moveable.target.length&&this.moveable.target[0].contains(i)&&this.disableClickThrough)return void e.stop();t.shiftKey&&this.moveable.target?Array.isArray(this.moveable.target)?this.moveable.target.push(i):this.moveable.target=[this.moveable.target,i]:this.moveable.target=i,this.guidelines=[document.querySelector(".viewport-container"),...Array.from(document.querySelectorAll(kt)).filter((e=>e!==i&&e.closest(kt)!==i))],this.moveable.elementGuidelines=this.guidelines,this.moveable.elementSnapDirections={top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},this.moveable.snapDirections={top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},this.dragActive&&!t.shiftKey&&this.moveable.dragStart(t),e.inputEvent&&e.inputEvent.stopPropagation(),e.inputEvent&&e.inputEvent.preventDefault(),e.stop()}else t.ctrlKey&&e.stop()}onSelectoDragEnd(e){let{isDragStart:t,selected:n,inputEvent:i,rect:o}=e;t&&i.preventDefault(),this.moveable.elementGuidelines=[document.querySelector(".viewport-container"),...Array.from(document.querySelectorAll(kt)).filter((e=>-1===n.indexOf(e)))],this.guidelines=[document.querySelector(".viewport-container"),...Array.from(document.querySelectorAll(`${kt}[snappable="true"]`)).filter((e=>-1===n.indexOf(e)))],this.selectElements(n.filter((e=>e.parentElement)))}initComponentDrop(){this.workspaceEl.addEventListener("dragover",this.onWorkspaceDragOver.bind(this)),this.workspaceEl.addEventListener("drop",this.onWorkspaceDrop.bind(this))}onWorkspaceDragOver(e){const{context:t}=this;this.enabled&&(t.draggingComponent&&(this.selected.length&&this.selectElements([]),e.dataTransfer.dropEffect="move",this.checkDropTargetStatus({width:t.draggingComponent.width,height:t.draggingComponent.height,clientX:e.clientX,clientY:e.clientY})),e.preventDefault())}async dropComposite(){}onWorkspaceDrop(e){if(!this.enabled)return;e.preventDefault();const{context:t}=this,n=this.viewPortEl.getBoundingClientRect(),i=Math.floor((e.pageX-n.x)/this.zoom),o=Math.floor((e.pageY-n.y)/this.zoom),s=async n=>{const s=await t.loader.loadComponent("ridge-container/composite"),r={componentPath:"ridge-container/composite"};let a=null;const l={};if(n.componentPath){const[e,...i]=n.componentPath.split("/");r.title=n.title,l.pagePath=i.join("/"),l.packageName=e,a=await t.loadComposite(l.packageName,l.pagePath)}else if(n.path){a=await t.loadComposite(null,n.path);const e=n.path.split("/");r.title=e[e.length-1],l.pagePath=n.path}if(a){const n=t.createElement(Object.assign({},s,r),{x:i,y:o,width:a.style.width,height:a.style.height,props:{...Object.assign({},a.properties),...l}});this.placeElementAt(n.el,e.pageX,e.pageY)}};if(t.draggingComponent)if("composite"===t.draggingComponent.type)s(t.draggingComponent);else{const n=t.createElement(t.draggingComponent,{x:i,y:o});this.placeElementAt(n.el,e.pageX,e.pageY),this.moveable.target=n.el}else t.draggingComposite&&s(t.draggingComposite);t.draggingComponent=null}checkDropTargetStatus(e){let{target:t,clientX:n,clientY:i,width:o,height:s}=e;this.getDroppableTarget(t,{x:n,y:i,width:o,height:s})}placeElementAt(e,t,n){St("placeElementAt:",e,{x:t,y:n});const{context:i}=this,o=this.getDroppableTarget(e,{x:t,y:n},!1),s=o?o.ridgeNode:null;if(s){St("Into container",s);const t=e.getBoundingClientRect(),n=o.getBoundingClientRect();i.editorComposite.removeChild(e.ridgeNode),s.appendChild(e.ridgeNode,{x:Math.floor((t.x-n.x)/this.zoom),y:Math.floor((t.y-n.y)/this.zoom)},t)}else this.putElementToRoot(e,t,n);i.onElementMoveEnd(e),this.ensureDragPlacement(null),this.moveable.updateTarget()}putElementToRoot(e,t,n){const i=this.viewPortEl.getBoundingClientRect(),o=e.getBoundingClientRect();null==t||null==n||t>o.x&&t<o.x+o.width&&n>o.y&&n<o.y+o.height?e.ridgeNode.updateStyleConfig({x:Math.floor((o.x-i.x)/this.zoom),y:Math.floor((o.y-i.y)/this.zoom)}):e.ridgeNode.updateStyleConfig({x:Math.floor((t-i.x-o.width/2)/this.zoom),y:Math.floor((n-i.y-o.height/2)/this.zoom)}),this.moveable.updateTarget()}onElementDragStart(e){const{context:t}=this;if(e.ridgeNode&&e.ridgeNode.parent&&e.ridgeNode.parent!==t.editorComposite){const n=this.getElementRectConfig(e);e.ridgeNode.parent.removeChild(e.ridgeNode),t.editorComposite.appendChild(e.ridgeNode),t.services.outlinePanel.updateOutline(),e.ridgeNode.updateStyleConfig(n)}}getElementRectConfig(e){const t=e.getBoundingClientRect(),n=this.viewPortEl.getBoundingClientRect();return{position:"absolute",visible:!0,x:(t.x-n.x)/this.zoom,y:(t.y-n.y)/this.zoom,width:t.width/this.zoom,height:t.height/this.zoom}}selectElements(e,t){const{context:n}=this;if(this.disableClickThrough=t,document.querySelectorAll(`${kt}.selected`).forEach((e=>{e.classList.remove("selected")})),e&&e.length>0?this.selected=e.filter((e=>this.isTargetSelectable(e))):this.selected=[],this.selected.length>1&&(this.selected=this.selected.filter((e=>e.parentElement.classList.contains("ridge-composite")))),1===this.selected.length&&this.selected[0].ridgeNode){const e=this.selected[0];e.ridgeNode.config.style.width&&e.style.width&&e.style.width.indexOf("px")>-1&&parseInt(e.style.width)!==e.offsetWidth&&(e.style.width=e.offsetWidth+"px",e.ridgeNode.config.style.width=e.offsetWidth),n.onElementSelected(this.selected[0].ridgeNode)}else 1===e.length&&e[0].ridgeNode?n.onElementSelected(e[0].ridgeNode):0===this.selected.length&&(n.onPageSelected(),this.selected=[],this.moveable.target=null);0===this.selected.length?this.moveable.target=null:this.moveable.target=this.selected,this.setSelectedStatus(),this.moveable.updateTarget()}setSelectedStatus(){1===this.selected.length?(this.moveable.moveable=!0,this.moveable.resizable=!0):this.selected.length>1&&(this.moveable.resizable=!1),this.moveable.elementGuidelines=[document.querySelector(".viewport-container"),...Array.from(document.querySelectorAll(`.viewport-container > ${kt}:not(.ridge-is-hidden)`)).filter((e=>-1===this.selected.indexOf(e)))]}isTargetMovable(e){const{classList:t}=e;return!(!this.dragActive||t.contains("ridge-is-locked")||t.contains("ridge-is-full"))}isTargetSelectable(e){const{classList:t}=e;return!t.contains("ridge-is-hidden")&&!t.contains("ridge-is-locked")}isTargetResizable(e){const{classList:t}=e;return!t.contains("ridge-is-locked")&&!t.contains("ridge-is-hidden")&&(!t.contains("ridge-is-slot")||e.ridgeNode.isResizable())}unSelectElements(e){this.selected=this.selected.filter((t=>-1===e.indexOf(t))),this.moveable.target=this.selected,this.moveable.updateTarget()}getDroppableTarget(e,t,n){if(e&&e.ridgeNode&&!e.ridgeNode.canDroppedOnElement())return[];let i=[];for(const e of this.selectorDropableTarget)i=i.concat(Array.from(document.querySelectorAll(e)));const o=Array.from(i).filter((n=>{if(!n.ridgeNode)return!1;if(!n.ridgeNode.isDroppable())return!1;const{x:i,y:o,width:s,height:r}=n.getBoundingClientRect();return(!n.invoke||!1!==n.invoke("isDroppable",[e]))&&(e?!e.contains(n)&&t.x>i&&t.x<i+s&&t.y>o&&t.y<o+r&&n!==e&&n.closest("[ridge-id]")!==e:t.x>i&&t.x<i+s&&t.y>o&&t.y<o+r)}));let s=null;if(1===o.length)s=o[0];else if(o.length>1){const e=o.sort(((e,t)=>e.contains(t)?1:t.contains(e)?-1:e.style.zIndex>t.style.zIndex?1:-1));s=e[0]}if(this.ensureDragPlacement(s),s&&n){try{s.ridgeNode&&s.ridgeNode.invoke("onDragOver",e?[e.ridgeNode]:[])}catch(e){console.error("Container dragOver Error",s,e)}i.forEach((t=>{t!==s&&t.ridgeNode&&t.ridgeNode.invoke("onDragOut",e?[e.ridgeNode]:[])}))}return s}ensureDragPlacement(e){let t=document.querySelector(".drag-target-hint");if(null==e)return void(t&&this.viewPortEl.removeChild(t));t||(t=document.createElement("div"),t.className="drag-target-hint",t.dataset.targetId=e.id||"target_"+Date.now(),t.textContent="拖放内容到此处",this.viewPortEl.appendChild(t));const n=e.getBoundingClientRect(),i=this.viewPortEl.getBoundingClientRect();t.style.top=(n.top-i.top)/this.zoom+"px",t.style.left=(n.left-i.left)/this.zoom+"px",t.style.width=n.width/this.zoom+"px",t.style.height=n.height/this.zoom+"px"}downloadImg(e,t){const n=document.createElement("a"),i=new window.MouseEvent("click");n.download=e||this.props.photoName||"photo",n.href=t,n.dispatchEvent(i)}initKeyBind(){const{context:e}=this;ft().bind("del",(()=>{if(this.enabled&&this.dragActive){if(Array.isArray(this.moveable.target))for(const t of this.moveable.target)e.onElementRemoved(t);else this.moveable.target&&e.onElementRemoved(this.moveable.target);this.moveable.target=null}})),ft().bind("right",(()=>{if(this.enabled&&this.selected){for(const t of this.selected){const n=e.getNode(t);n.updateStyleConfig({x:n.config.style.x+1})}this.moveable.updateTarget()}})),ft().bind("left",(()=>{if(this.enabled&&this.selected){for(const t of this.selected){const n=e.getNode(t);n.updateStyleConfig({x:n.config.style.x-1})}this.moveable.updateTarget()}})),ft().bind("up",(()=>{if(this.enabled&&this.selected){for(const t of this.selected){const n=e.getNode(t);n.updateStyleConfig({y:n.config.style.y-1})}this.moveable.updateTarget()}})),ft().bind("down",(()=>{if(this.enabled&&this.selected){for(const t of this.selected){const n=e.getNode(t);n.updateStyleConfig({y:n.config.style.y+1})}this.moveable.updateTarget()}})),ft().bind("ctrl+c",(()=>{this.enabled&&(this.selected?e.onCopyNodes(this.selected.map((e=>e.ridgeNode))):e.onCopyNodes([]))})),ft().bind("ctrl+s",(t=>{this.enabled&&(t.preventDefault(),e.saveCurrentPage())})),ft().bind("ctrl+v",(t=>{this.enabled&&(t.preventDefault(),e.onPasteNodes())})),this.workspaceEl.onwheel=t=>{if(!this.enabled)return;t.preventDefault();let n=this.zoom+.01*(t.deltaY>0?-1:1);n=Math.min(Math.max(.1,n),2),e.services?.menuBar?.setZoom(n),this.setZoom(n)}}}var Nt=n(6108),Tt=n.n(Nt),Ot=n(3450),jt=n.n(Ot);class Lt extends Ce{getProperties(){return Object.assign({__isEdit:!0,__el:this.el,__composite:this.composite,width:this.style.width,height:this.style.height},this.config.props,this.properties,{children:this.children})}updateEditStyle(){this.config.locked?this.el.classList.add("ridge-is-locked"):this.el.classList.remove("ridge-is-locked"),this.config.visible?this.el.classList.remove("ridge-is-hidden"):this.el.classList.add("ridge-is-hidden"),this.config.locked||!this.config.visible?this.composite.context.workspaceControl.selectElements([]):this.composite.context.workspaceControl.selectElements([this.el])}styleUpdated(){this.el.classList.add("ridge-editor-element"),this.isContainer()&&this.el.classList.add("ridge-container"),this.isSlot?this.el.classList.add("ridge-is-slot"):this.el.classList.remove("ridge-is-slot")}isContainer(){return this.getPropDefinations().find((e=>"children"===e.name||"slot"===e.type))}appendChild(e){let{x:t,y:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.children||(this.children=[]);let o=-1;this.hasMethod("checkNodeOrder")&&i&&(o=this.invoke("checkNodeOrder",[i])),o>-1?this.children.splice(o,0,e):this.children.push(e),e.parent=this,this.invoke("appendChild",[e,{x:t,y:n},o]),e.forceUpdate(),this.forceUpdate(),this.config.props.children=this.children.map((e=>e.getId()))}removeChild(e){this.children||(this.children=[]),this.children=this.children.filter((t=>t!==e)),this.config.props.children=this.children.map((e=>e.getId())),e.parent=null,this.forceUpdate();const{workspaceControl:t}=Rt,n=t.getElementRectConfig(e.el);this.invoke("removeChild",[e]),e.setStyleConfig(n)}initPropsOnCreate(){for(const e of this.getPropDefinations().filter((e=>e&&e.name)))void 0!==e.value&&void 0===this.config.props[e.name]&&(this.config.props[e.name]=e.value),"children"===e.name&&(this.config.props.children=[],this.children=[]),"slot"===e.type&&(this.config.props.children=[],this.children=[])}setSlot(e){this.config.slot=e,e?this.el.classList.add("ridge-is-slot"):this.el.classList.remove("ridge-is-slot")}setVisible(e){this.config.visible=e,this.updateEditStyle()}setLocked(e){this.config.locked=e,this.updateEditStyle()}updateStyleConfig(e){Object.assign(this.config.style,e),this.style=this.config.style,this.updateStyle()}setStyleConfig(e){this.config.style=e,this.style=this.config.style,this.updateStyle()}updateChildConfig(e){this.config.props.children=e.map((e=>e.getId())),this.properties.children=e,this.updateProps()}checkUpdateSlotElement(e){if(null==e||1!==Object.keys(e).length)return!1;const t=Object.keys(e)[0],[n,i]=t.split("."),o=e[t];if("props"!==n)return!1;const s={};return this.componentDefinition.props.forEach((e=>{if("slot"===e.type&&i===e.name&&(null!=this.config.props[e.name]&&this.config.props[e.name]!==o&&(s.removed=this.config.props[e.name]),o)){const e=this.composite.getNode(o);e&&(this.composite.removeChild(e),e.setSlot(!0),s.added=o)}})),s}updateConfig(e,t){const n=this.checkUpdateSlotElement(t);Object.assign(this.config,e);for(const e in t)void 0===t[e]&&jt()(this.config,e);return this.properties=Tt()(this.config.props),this.style=Tt()(this.config.style),this.updateStyle(),this.updateProps(),n.removed&&setTimeout((()=>{const e=this.composite.getNode(n.removed);e&&(this.composite.appendChild(e),e.setSlot(!1))}),100),n}childRemoved(e){this.invoke("removeChild",[e])}isResizable(){return!this.config.slot||!this.parent||this.parent.isSlotChildResizable(this.config.id)}getPropDefinations(){return this.componentDefinition&&this.componentDefinition.props&&Array.isArray(this.componentDefinition.props)?this.componentDefinition.props:[]}getPropDefination(e){return this.componentDefinition&&this.componentDefinition.props?this.componentDefinition.props.filter((t=>t.name===e))[0]:null}updateChildList(e){this.children=e.map((e=>this.composite.getNode(e))).filter((e=>e)),this.invoke("updateChildList",[this.children])}selected(){this.invoke("selected");let e=this,t=e.parent;for(;t;)t.invoke("childSelected",[e]),e=t,t=e.parent}clone(){const e=Tt()(this.config);e.id=(0,Ve.nanoid)(5);const t=new Lt({composite:this.composite,componentDefinition:this.componentDefinition,config:e});if(this.children){t.children=[];for(const e of this.children){const n=e.clone();n.parent=t,t.children.push(n),this.composite.nodes[n.getId()]=n}}return this.composite.nodes[t.getId()]=t,t}isSlotChildResizable(e){if(this.componentDefinition&&this.componentDefinition.props)for(const t of this.componentDefinition.props)if("slot"===t.type&&this.config.props[t.name]===e)return t.resizable;return!1}getSlotElements(){const e=[];return this.getPropDefinations().forEach((t=>{"slot"===t.type&&this.config.props[t.name]&&e.push(this.config.props[t.name])})),e}isDroppable(){const e=this.getPropDefinations().filter((e=>"slot"===e.type)).length+(this.getPropDefinations().filter((e=>"children"===e.type)).length?10001:0);return(this.children?this.children.length:0)<e}canDroppedOnElement(){return!0!==this.componentDefinition.portalled}exportJSON(){return this.componentDefinition&&(this.children&&(this.config.props.children=this.children.filter((e=>e.parent===this)).map((e=>e.getId())),this.config.props.children=Array.from(new Set(this.config.props.children))),this.config.slots=this.getSlotElements(),this.componentDefinition.portalled&&(this.config.style.portalled=!0)),JSON.parse(JSON.stringify(this.config))}exportJSONTree(){const e=Tt()(this.config);return this.children&&(e.props.children=this.children.filter((e=>e.parent===this)).map((e=>e.exportJSONTree()))),this.componentDefinition.props&&this.componentDefinition.props.forEach((t=>{"slot"===t.type&&this.config.props[t.name]&&(e.props[t.name]=this.composite.getNode(this.config.props[t.name]).exportJSONTree())})),e}}const Ft={},At=class extends ke{constructor(e){super(e),this.isEdit=!0,this.CLASS_LIST=["ridge-composite","viewport-container","is-edit"]}createElement(e){return e.path&&Ft[e.path.split("/")[0]]&&(e.path=Ft[e.path.split("/")[0]]+"/"+e.path.split("/")[1]),new Lt({composite:this,config:e})}getClassNames(){return this.classNames||[]}getBlobUrl(e){return this.context.getBlobUrl(e)}updatePageConfig(e){Object.assign(this.config,e),this.updateStyle(),this.refresh()}updatePromotedElement(){}async refresh(){await this.importJSFiles(),this.loadStore(),this.importFontFiles()}async loadStore(){this.storeModules=[];for(const e of this.jsModules){!e.jsContent&&e.filePath&&(e.jsContent=await this.context.loadFileContent(e.filePath));const t=Et(e);t.error?globalThis.msgerror&&globalThis.msgerror("模块引入异常 :"+e.filePath):this.storeModules.push(t)}}updateStyle(){if(super.updateStyle(),this.config.style){const{width:e,height:t}=this.config.style;this.el.style.width=e+"px",this.el.style.height=t+"px",this.el.style.overflowX="initial",this.el.style.overflowY="initial"}}getStoreModules(){return this.storeModules||[]}createNewElement(e,t){let{x:n,y:i,width:o,height:s}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=o||e.width||100,l=s||e.height||100,c=this.getNodes();let d=1,p=e.title;for(;c.find((e=>e.config.title===p));)p=e.title+"_"+d,d++;const h={title:p,path:e.componentPath,id:(0,Ve.nanoid)(10),style:{position:"absolute",visible:!0,x:n?n-a/2:0,y:i?i-l/2:0,width:a,height:l},styleEx:{},props:r,propEx:{},events:{},visible:!0,locked:!1,full:!1},m=new Lt({config:(0,bt.cloneDeep)(h),componentDefinition:e,composite:this});return m.parent=this,this.nodes[m.getId()]=m,m.initPropsOnCreate(),m}async importNewElement(e){const t=(0,bt.cloneDeep)(e);t.id=(0,Ve.nanoid)(10);const n=this.createElement(t),i=document.createElement("div");if(await n.mount(i),t.props.children&&t.props.children.length){const e=t.props.children;for(let t=0;t<e.length;t++){const i=e[t],o=await this.importNewElement(i);n.appendChild(o)}}return this.nodes[t.id]=n,n}async postMount(){for(const e of Object.values(this.nodes))await e.load()}async mounted(){this.el.ondblclick=e=>{const t=e.target.closest(".ridge-composite");!Rt.isPreviewMode()&&t&&!t.classList.contains("viewport-container")&&t.hasAttribute("composite-id")&&Rt.openFileByPath(t.getAttribute("composite-id"))}}unmount(){super.unmount(),this.el.style.width=0,this.el.style.height=0,this.el.classList.remove("is-edit")}appendChild(e){if(e.isSlot=!1,-1===this.children.indexOf(e))if(this.children.push(e),this.config.children=this.children.map((e=>e.getId())),e.parent=this,e.el)this.el.appendChild(e.el),e.forceUpdate();else{const t=document.createElement("div");this.el.appendChild(t),e.mount(t)}}removeChild(e,t){this.children=this.children.filter((t=>t!==e)),e.parent=null,this.config.children=this.children.map((e=>e.getId())),this.el.removeChild(e.el),e.isSlot?(e.isSlot=!1,t&&e.unmount()):this.resetStyle(e.el)}resetStyle(e){e.style.position="inherit",e.classList.remove("ridge-is-full"),e.style.transform="",e.style.removeProperty("width"),e.style.removeProperty("height")}deleteNode(e){if(e){const t=e.getParent();t&&t.removeChild(e);for(const t of e.children??[])this.deleteNode(t);e.unmount(),e.componentDefinition&&"store"===e.componentDefinition.type&&(this.storeModules=this.storeModules.filter((t=>t.name!==e.config.id))),delete this.nodes[e.getId()]}}updateChildList(e){for(const e of this.children)this.el.removeChild(e.el);this.children=[];for(let t=0;t<e.length;t++){const n=this.getNode(e[t]);n&&n.el&&this.appendChild(n)}}childAppended(e){e.updateStyle()}onEditorElementCreated(e){e.componentDefinition&&"store"===e.componentDefinition.type&&this.parseJsStoreModule(Object.assign(e.componentDefinition.component,{name:e.config.id,label:e.config.title}))}getCompositeElementTree(){return this.buildElementTree(this.children)}buildElementTree(e){const t=[];for(const n of e)n&&t.push(this.getElementTree(n));return t}getElementTree(e){const t={key:e.getId(),value:e.getId(),label:e.config.title,element:e};if(e.children&&e.children.length?(t.children=e.children.map((t=>({...this.getElementTree(t),parentKey:e.getId()}))),t.isLeaf=!1):t.isLeaf=!0,e.componentDefinition){e.componentDefinition.icon&&(e.componentDefinition.icon.$$typeof?t.icon=e.componentDefinition.icon:e.componentDefinition.icon.indexOf(".")>-1?t.icon=React.createElement("img",{className:"item-icon",src:this.context.baseUrl+"/"+e.componentDefinition.packageName+"/"+e.componentDefinition.icon}):t.icon=React.createElement("i",{className:e.componentDefinition.icon}));for(const n of e.componentDefinition.props||[])if("slot"===n.type&&e.config.props[n.name]){t.children||(t.children=[]);const i=this.getNode(e.config.props[n.name]);t.children.push({...this.getElementTree(i),parentKey:e.getId(),slotLabel:n.label}),t.isLeaf=!1}}return t}emit(e,t){}exportPageJSON(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(0,bt.cloneDeep)(this.config);t.elements=[];for(const n of this.getNodes())try{const e=n.exportJSON();t.elements.push(e)}catch(t){if(!e)throw t;console.error("node.exportJSON 失败：",n,t)}return t.children=this.children.map((e=>e.getId())),t}},zt=k()("ridge:editor"),Dt=new URLSearchParams(location.href).get("registry")||localStorage.getItem("registry")||window.baseUrl||"https://cdn.jsdelivr.net/npm",Mt=new class extends Oe{constructor(e){let{baseUrl:t,loadPropControl:n}=e;super({baseUrl:t,loadPropControl:n}),this.baseUrl="/npm",this.theme=localStorage.getItem("ridge-theme")||"@douyinfe/semi-ui/dist/css/semi.min.css",this.isLight=localStorage.getItem("ridge-is-light")||!0,this.services.appService=new lt(this.loader),this.services.npmService=new ct,window.ridge=this,this.pluginData=[],this.setLight(this.isLight),this.setTheme(this.theme),this.openedFileContentMap=new Map,this.pageTransformMap=new Map,this.checkInterval=setInterval(this.checkModification.bind(this),2e3)}setTheme(e){this.services.loader.removeCss(localStorage.getItem("ridge-theme")),localStorage.setItem("ridge-theme",e),this.services.loader.loadCss(this.baseUrl+"/"+e)}setLight(e){localStorage.setItem("ridge-is-light",e),!1===e||"false"===e?document.body.setAttribute("theme-mode","dark"):document.body.setAttribute("theme-mode","light")}setShowContainer(e){e?this.workspaceEl.classList.add("show-container"):this.workspaceEl.classList.remove("show-container")}reload(){location.reload(!0)}confirm(e){const{Editor:t}=this;return t.confirm(e)}async editorDidMount(e,t,n){this.Editor=e;const{appService:i,npmService:o}=this.services,s=new URLSearchParams(window.location.search),r=s.get("import");if(r)try{await e.confirm(`你将导入应用包：${r}。若工作区已包含内容会被覆盖，是否继续？（你可以先导出到本地磁盘或保存到云端进行备份）`),await i.importFromRidgeCloud(r);const t=new URL(window.location.href);t.search="",location.href=t.href}catch(e){}const a=s.get("package");if(a){const t=await o.getPackage(a);if(t["dist-tags"]&&t["dist-tags"].latest)try{0===i.getFileTree().length?(this.Editor.setEditorLoadingMessage("正在分析入应用包 "+t.description),await i.importFromNpmRegistry(a,t["dist-tags"].latest)):(await e.confirm(`你将导入应用包：${t.description}，版本：${t["dist-tags"].latest}。您工作区已包含内容,您可以先导出应用包到本地后保存后继续，否则当前工作会丢失。是否继续？`),await i.backupCurrentApp(),await i.importFromNpmRegistry(a,t["dist-tags"].latest)),e.message("应用包已经导入："+a);const n=new URL(window.location.href);n.search="",location.href=n.href}catch(e){}}this.viewPortContainerEl=n,this.workspaceEl=t,this.workspaceControl=new Pt,this.workspaceControl.init({workspaceEl:t,viewPortEl:n,context:this}),this.Editor.setEditorLoaded(),this.setShowContainer(!0)}getNode(e){if(e instanceof Ce)return e;if("string"==typeof e){if(this.editorComposite)return this.editorComposite.getNode(e);if(this.runtimeView)return this.runtimeView.getNode(e)}else if(e instanceof Node)return e.ridgeNode;return null}async loadAppPackages(){const{appService:e}=this.services,t=await e.getPackageJSONObject();if(null==t)return[];const n=Object.keys(t.dependencies),i=[];for(const e of n)i.push(await this.services.loader.getPackageJSON(e));await Promise.allSettled(i);const o=i.filter((e=>null!=e)).map((e=>(e.componentLoaded=!1,e)));return o.forEach((e=>{e.themes&&(t.themes&&t.themes[e.name]?this.services.loader.loadPackageTheme(e.name,t.themes[e.name]):e.themes.default&&this.services.loader.loadPackageTheme(e.name,e.themes.default))})),this.uiPackages=o.filter((e=>e.ridgeDist||e.components)),this.pluginPackages=o.filter((e=>e.plugin)),this.storePackages=o.filter((e=>e.ridgeStores)),this.appPackageObject=t,this.applyPackageObjectSetting(this.appPackageObject),{loadedPackages:this.uiPackages,appPackageObject:t}}async openFile(e){const{appService:t}=this.services,n=await t.getFile(e);n&&("page"===n.type?await this.openNewPage(n):n.mimeType.startsWith("text/")?this.Editor.openInCodeEditor(n):n.mimeType.startsWith("image/")&&this.Editor.openImage(n.content))}async getPageContentById(e){const{appService:t}=this.services,n=await t.getFile(e);if(n&&"page"===n.type)return n.content}async openNewPage(e){this.currentOpenPageId&&this.currentOpenPageId===e.id||(this.currentOpenPageId&&this.closeCurrentPage(!0),this.currentOpenPageId=e.id,this.openedFileContentMap.set(e.id,e.content),this.loadPageInWorkspace(e.id,e.name,e.content))}async openFileByPath(e){const t=await this.services.appService.getFileByPath(e);t&&await this.openFile(t.id)}async loadPageInWorkspace(e,t,n){this.currentOpenPageId=e;let i=null;n?(i=n,i.name=t):i=this.openedFileContentMap.get(e);const{Editor:o}=this;o.setPageOpened(!0);const{menuBar:s}=this.services;this.editorComposite&&this.editorComposite.unmount(),this.editorComposite=new At({id:e,config:(0,bt.cloneDeep)(i),context:this}),this.editorComposite.firstPaint(this.viewPortContainerEl),s.setOpenPage(e,i.name),await this.editorComposite.mount(),this.workspaceControl.enabled||this.workspaceControl.enable();const{configPanel:r,outlinePanel:a}=this.services;r.updatePageConfigFields(),this.workspaceControl.selectElements([]);const l=this.pageTransformMap.get(e);l?this.workspaceControl.setTransform(l):this.workspaceControl.setTransform({}),a.updateOutline(!0)}async loadPreview(){this.previewComposite=new ke({config:this.pageContent,context:this}),await this.previewComposite.initialize(),await this.previewComposite.mount(document.querySelector(".preview-view-port"))}async toggleMode(){this.editorComposite?(await this.saveCurrentPage(),this.editorComposite.unmount(),this.editorComposite=null,this.workspaceControl.disable(),this.Editor.setPreview(!0),this.loadPreview()):this.previewComposite&&(this.Editor.setPreview(!1),this.previewComposite.unmount(),await this.loadPageInWorkspace(this.currentOpenPageId))}onPageSelected(){const{configPanel:e,outlinePanel:t}=this.services;zt("onPageSelected"),this.selectedNode=null,this.sl=null,e.updatePageConfigFields(),t.setCurrentNode()}onElementSelected(e){const{configPanel:t,outlinePanel:n}=this.services;zt("onElementSelected",e),e?(e.selected(),t.componentSelected(e),n.setCurrentNode(e)):(t.updatePageConfigFields(),n.setCurrentNode(null)),this.selectedNode=e,this.sl=e}onElementRemoved(e){const t=this.getNode(e);t&&this.editorComposite&&this.editorComposite.deleteNode(t);const{outlinePanel:n}=this.services;n.updateOutline()}onElementMoveEnd(e){const{configPanel:t,outlinePanel:n}=this.services,i=this.getNode(e);i&&(t.componentSelected(i),n.updateOutline())}onFileRenamed(e,t){if(this.currentOpenPageId===e){this.editorComposite.config.name=t;const{configPanel:e}=this.services;e.updatePageConfigFields()}}createElement(e,t){const n=document.createElement("div"),i=this.editorComposite.createNewElement(e,t,t.props);return i.mount(n),this.editorComposite.appendChild(i),this.editorComposite.onEditorElementCreated(i),i}updateComponentConfig(e,t,n){const i=(0,bt.cloneDeep)(t),o=i.title!==e.config.title,s=e.updateConfig(i,n);if(o||s){const{outlinePanel:e}=this.services;e.updateOutline(),this.editorComposite.loadStore()}this.workspaceControl.updateMovable()}async onCodeEditComplete(e,t){const n=await this.services.appService.getFile(e);if(!n)return!1;if("package.json"===n.name)try{JSON.parse(t).name&&await this.services.appService.updateFileContent(e,t)}catch(e){return console.error("parse package.json error",e),!1}else await this.services.appService.updateFileContent(e,t);return this.editorComposite&&await this.editorComposite.refresh(),!0}async checkModification(){if(this.editorComposite)try{const e=this.editorComposite.exportPageJSON(),t=await this.getPageContentById(this.currentOpenPageId);this.isModified=!(0,bt.isEqual)(e,t),this.services.menuBar&&this.services.menuBar.setPageChanged(this.isModified)}catch(e){}this.isModified=!0}async saveCurrentPage(){if(this.editorComposite){const{appService:e}=this.services;let t=null;try{t=this.editorComposite.exportPageJSON()}catch(e){await this.confirm("页面保存出现错误，继续将丢失一些错误的组件， 是否继续"),t=this.editorComposite.exportPageJSON()}if(t){zt("Save Page ",t);try{this.pageContent=t,this.openedFileContentMap.set(this.currentOpenPageId,t),await e.savePageContent(this.currentOpenPageId,t),this.services.menuBar.setPageChanged(!1)}catch(e){console.error("save page error",e)}}}}closeCurrentPage(e){e?(this.openedFileContentMap.set(this.currentOpenPageId,this.editorComposite.exportPageJSON()),this.pageTransformMap.set(this.currentOpenPageId,this.workspaceControl.getTransform())):this.openedFileContentMap.delete(this.currentOpenPageId),this.editorComposite&&this.editorComposite.unmount(),this.currentOpenPageId=null,this.editorComposite=null,this.workspaceControl.disable(),0===this.openedFileContentMap.size&&this.Editor.setPageOpened(!1)}getOpenedFileMap(){return this.openedFileContentMap}getSelectedNode(){return this.selectedNode}getLocaleText(e){return e}isPreviewMode(){return null!=this.previewComposite}async loadComposite(e,t){if(null!=e)return super.loadComposite(e,t);if(null!=t){const e=await this.services.appService.getFileByPath(t);if(e){const t=await this.services.appService.getFile(e.id);if(t)return t.content}return null}}async loadAppPackageJSON(e){return null!=e?super.loadAppPackageJSON(e):await this.services.appService.getPackageJSONObject()}async loadModule(e,t){if(null==e&&t.startsWith("composite://")){const{appService:e}=this.services,n=t.replace("composite://",""),i=await this.loader.loadLocalJsModule(n,{load:async t=>e.getFileContentByPath(t)});return i?(i.jsContent=await e.getFileContentByPath(n),i):null}return await super.loadModule(e,t)}async loadFileContent(e){const t=e.replace("composite://",""),{appService:n}=this.services,i=n.getFileByPath(t);return i?(i.textContent||(i.textContent=await n.getFileContent(i)),i.textContent):super.loadFileContent(e)}getBlobUrl(e,t){if(e.startsWith("composite://")&&null==t){const n=e.substring(12),i=this.services.appService.getFileByPath((0,Ve.ensureLeading)(n));return i?this.services.appService.getDataUrl(i.id):super.getBlobUrl(e,t)}return super.getBlobUrl(e,t)}onCopyNodes(e){this.copied=(e=>{const t=[];for(const n of e){const e=n.exportJSONTree();t.push(e)}return t})(e)}async onPasteNodes(){if(this.copied&&this.copied.length){const e=[];for(const t of this.copied){const n=await this.editorComposite.importNewElement(t);this.selectedNode&&this.selectedNode.isContainer()?this.selectedNode.appendChild(n):(this.editorComposite.appendChild(n),n.updateStyleConfig({y:n.config.style.y+10,x:n.config.style.x+10})),e.push(n.el)}this.workspaceControl.selectElements(e)}}alignComponents(e){if(Array.isArray(this.workspaceControl.moveable.target)){const t=this.workspaceControl.moveable.target.map((e=>e.ridgeNode));if(t&&t.length>1)switch(e){case"top":for(let e=1;e<t.length;e++)t[e].updateStyleConfig({y:t[0].config.style.y});break;case"bottom":for(let e=1;e<t.length;e++)t[e].updateStyleConfig({y:t[0].config.style.y+t[0].config.style.height-t[e].config.style.height});break;case"left":for(let e=1;e<t.length;e++)t[e].updateStyleConfig({x:t[0].config.style.x});break;case"right":for(let e=1;e<t.length;e++)t[e].updateStyleConfig({x:t[0].config.style.x+t[0].config.style.width-t[e].config.style.width});break;case"hcenter":for(let e=1;e<t.length;e++)t[e].updateStyleConfig({y:t[0].config.style.y+t[0].config.style.height/2-t[e].config.style.height/2});break;case"vcenter":for(let e=1;e<t.length;e++)t[e].updateStyleConfig({x:t[0].config.style.x+t[0].config.style.width/2-t[e].config.style.width/2})}}}}({baseUrl:Dt,loadPropControl:!0}),Rt=Mt;function It(){return It=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},It.apply(null,arguments)}const{Title:Bt,Text:Ut}=y.Typography,_t=(0,y.withField)((e=>{let{value:t,onChange:n}=e;const[i,o]=(0,b.useState)([]),[s,r]=(0,b.useState)(),[a,l,c]=(t??"").split(".");return v().createElement(y.Popover,{content:()=>v().createElement("div",{className:"state-tree-wrapper"},v().createElement(y.Space,{style:{marginBottom:10,width:"100%"}},v().createElement(Ut,{style:{flex:1}},"连接动态数据值"),v().createElement(y.Button,{size:"small",theme:"solid",type:"secondary",onClick:()=>{n(null),r(!1)}},"取消连接")),v().createElement(y.Tabs,{type:"card"},v().createElement(y.TabPane,{tab:"页内数据值",itemKey:"1"},v().createElement(y.Tree,{searchRender:e=>{let{prefix:t,...n}=e;return v().createElement(y.Space,null,v().createElement(y.Input,It({showClear:!0,prefix:v().createElement("i",{className:"bi bi-search",style:{margin:"0 8px"}})},n)))},value:t,filterTreeNode:i.length,expandAll:!0,emptyContent:"无可连接动态数据",treeData:i,onSelect:e=>{t===e&&n(null)},onChange:e=>{n(e)}})),v().createElement(y.TabPane,{tab:"提升为外部属性",itemKey:"2"},v().createElement(y.Space,{style:{padding:"5px 10px"}},v().createElement(Ut,{style:{width:100}},"名称")," ",v().createElement(y.Input,{showClear:!0,value:"Promote"===a?c:"",onChange:e=>{n(""===e||null==e?null:"Promote.props."+e)}}))))),trigger:"click",showArrow:!0,visible:s,onVisibleChange:e=>{r(e),(()=>{const e=Rt.editorComposite?Rt.editorComposite.getStoreModules():[];o(e.map((e=>e.connects)))})()}},v().createElement("div",{style:{height:26,display:"flex",alignItems:"center"}},v().createElement(y.Tooltip,{content:"数据连接",arrowPointAtCenter:!1,position:"topLeft"},v().createElement(y.Button,{className:"btn-code",placeholder:"连接数据",type:t?"primary":"tertiary",size:"small",theme:"borderless",onClick:()=>{r(!s)},icon:v().createElement("i",{className:"bi bi-lightning-charge",style:{margin:"0 2px",flexShrink:0}})}))))})),{Text:Wt}=y.Typography,Vt=(0,y.withField)((e=>{let{value:t,options:n,onChange:i}=e;const[o,s]=(0,b.useState)(""),r=t||[],a=Rt.editorComposite?Rt.editorComposite.getStoreModules():[],l=()=>{const e=[...r,{store:"",method:"",payload:""}];i(e)},c=e=>{i(r.filter(((t,n)=>n!==e)))},d=e=>{i(r.map(((t,n)=>n===e.index?{store:e.store,method:e.method,payload:e.payload}:t)))},p="promoted"===t?[{label:n.label,key:"action-root",root:!0,disabled:!0,children:[]}]:[{label:n.label,key:"action-root",root:!0,disabled:!0,children:[...r.map(((e,t)=>{const n={};return n.key="node-"+t,n.index=t,n.store=e.store,n.method=e.method,n.payload=e.payload||"",n}))]}];return v().createElement("div",{className:"event-edit"},v().createElement(y.Tree,{className:"event-tree",expandAll:!0,disabled:!0,renderLabel:(e,n)=>v().createElement("div",{className:"tree-label"},n.root&&v().createElement(v().Fragment,null,v().createElement(Wt,{className:"label-content"},v().createElement(y.Tag,{color:"green"},e)),v().createElement(y.Space,{className:"action"},Rt.getSelectedNode()&&v().createElement(y.Button,{size:"small",icon:v().createElement("i",{class:"bi bi-broadcast"}),theme:"promoted"===t?"solid":"borderless",onClick:()=>{i("promoted"===t?[]:"promoted")}}),"promoted"!==t&&v().createElement(y.Button,{style:{marginRight:10},size:"small",theme:"borderless",type:"primary",onClick:l,icon:v().createElement("i",{class:"bi bi-plus"})}))),!n.root&&(e=>v().createElement(v().Fragment,null,v().createElement("div",{className:"label-content"},v().createElement(y.Select,{placeholder:"请选择",style:{width:120},noLabel:!0,value:e.store&&e.method?e.store+"."+e.method:"",size:"small",onChange:t=>{const[n,i]=t.split(".");e.store=n,e.method=i,d(e)}},a.map((e=>{const t=e.actions;return v().createElement(y.Select.OptGroup,{label:t.label,key:t.name},t.children.map((e=>{let{name:t,label:n}=e;return v().createElement(y.Select.Option,{key:t,value:t},n)})))}))),v().createElement(y.Popover,{trigger:"click",content:v().createElement("div",{style:{padding:10}},v().createElement(Wt,null,"请输入方法参数"),v().createElement(y.TextArea,{value:e.payload,onChange:t=>{d(Object.assign(e,{payload:t}))}}))},v().createElement(y.Button,{theme:"borderless",type:e.payload?"primary":"tertiary",onClick:()=>{s(e.payload)},size:"small",icon:v().createElement("i",{class:"bi bi-diagram-3"})}))),v().createElement(y.Space,{className:"action"},v().createElement(y.Button,{size:"small",theme:"borderless",type:"tertiary",icon:v().createElement("i",{class:"bi bi-trash"}),onClick:()=>{c(e.index)}}))))(n)),treeData:p}))})),Jt=Vt,$t=(0,y.withField)((e=>{let{value:t,type:i="json",onChange:o}=e;const[s,r]=(0,b.useState)(!1),[a,l]=(0,b.useState)(""),c=v().createRef();return v().createElement("div",null,v().createElement(y.Modal,{closeOnEsc:!1,lazyRender:!1,onCancel:()=>{r(!1),l("")},width:840,height:640,keepDOM:!0,title:"编辑数据",visible:s,onOk:()=>{try{const e=c.current.editorComposite.state.doc.toString();if(""!==e)if("json"===i){const t=JSON.parse(e);o(t)}else o(e);else o("");r(!1),l("")}catch(e){l(e.message)}}},v().createElement("div",null,"默认值/代码"),v().createElement("div",{style:{border:"1px solid var(--semi-color-border)",overflow:"auto",height:"480px",width:"100%"},className:"code-editor-container",ref:c}),v().createElement("div",{style:{color:"red"}},a)),v().createElement(y.Button,{size:"small",type:"tertiary",onClick:async()=>{r(!0);const e=c.current,{EditorView:o,basicSetup:s}=await Promise.all([n.e(587),n.e(213),n.e(927),n.e(85)]).then(n.bind(n,136)),{tooltips:a,keymap:l}=await Promise.all([n.e(587),n.e(213),n.e(927),n.e(85)]).then(n.bind(n,3173)),{json:d}=await Promise.all([n.e(587),n.e(213),n.e(643),n.e(0),n.e(295),n.e(472)]).then(n.bind(n,6367));e.editorComposite&&e.editorComposite.destroy();let p="";const h=[s];null!=t&&("json"===i?(p=JSON.stringify(t,null,2),h.push(d()),h.push(a({position:"absolute"}))):p=t),e.editorComposite=new o({doc:p,extensions:h,parent:e})}},"编辑"))})),qt=$t,Ht=(0,y.withField)((e=>{let{value:t,onChange:n,options:i}=e;const{appService:o}=Rt.services,s=o.getUITreeData((e=>e.type===i.type||e.mimeType&&e.mimeType.indexOf(i.type)>-1));return v().createElement(y.TreeSelect,{leafOnly:!0,size:"small",onChange:(e,t)=>{t&&t.isLeaf?n(e):n("")},showClear:!0,value:t,style:{width:180},dropdownStyle:{maxHeight:320,overflow:"auto"},renderLabel:(e,t)=>v().createElement("div",null,e),treeData:s,placeholder:"请选择"})})),Kt=(0,y.withField)((e=>{let{value:t,onChange:n}=e;return v().createElement(Te,{value:t,input:n,onChange:n,app:"ridge-editor-app",path:"field/image-select/ImageSelect"})})),Xt=(0,y.withField)((e=>{let{value:t,options:n,onChange:i}=e;return v().createElement(y.RadioGroup,{type:"button",buttonSize:"small",value:t,onChange:e=>{i(e.target.value)}},n&&n.map((e=>e.icon?v().createElement(y.Radio,{key:e.value,value:e.value},v().createElement("i",{className:e.icon,style:{fontSize:18}})):e.label?v().createElement(y.Radio,{key:e.value,value:e.value},v().createElement("div",{style:{fontSize:"14px",...e.style}},e.label)):v().createElement(y.Radio,{key:e.value,value:e.value}))))})),Zt=Xt,Yt=(0,y.withField)((e=>{let{value:t,onChange:n,options:i}=e;const[o,s]=(0,b.useState)(!1),[r,a]=(0,b.useState)(null),l=i.controlFunc.toString().startsWith("()"),c={preload:r,value:t,onChange:e=>{n&&n(e),i.inline||s(!1)}};let d=v().createElement(v().Fragment,null);return l&&(d=v().lazy(i.controlFunc)),(0,b.useEffect)((()=>{i.preload&&!r&&i.preload().then((e=>{console.log("preloaded",e),a(e.default)})).catch((()=>{}))}),[i.preload]),i.inline?l?v().createElement(b.Suspense,{fallback:v().createElement("div",null,"配置加载中")},v().createElement(d,c)):i.controlFunc(c):v().createElement(y.Popover,{position:"leftTop",trigger:"custom",style:{padding:"5px"},visible:o,onClickOutSide:()=>{s(!1)},content:l?v().createElement(b.Suspense,{fallback:v().createElement("div",null,"配置加载中")},v().createElement(d,c)):i.controlFunc(c)},v().createElement(y.Button,{size:"small",onClick:()=>{s(!0)}},i.controlBtnText||"配置"))})),Gt=(0,y.withField)((e=>{let{value:t,onChange:n,options:i}=e;const[o,s]=(0,b.useState)(!1),{appService:r}=Rt.services,a=r.getUITreeData((e=>e.type===i.fileType||e.mimeType&&e.mimeType.indexOf(i.fileType)>-1));return v().createElement(y.Popover,{trigger:"custom",visible:o,onClickOutSide:()=>s(!1),position:"leftTop",content:v().createElement(y.Tree,{leafOnly:!0,searchAutoFocus:!0,multiple:i.multiple,style:{width:320,height:400},value:i.multiple?Array.isArray(t)?t.filter((e=>e.startsWith("composite://"))).map((e=>e.substring(12))):[]:"string"==typeof t&&t.startsWith("composite://")?t.substring(12):"",onChange:e=>{i.multiple?n&&n([...e.map((e=>"composite://"+e)),...t.filter((e=>!e.startsWith("composite://")))]):n&&n("composite://"+e)},treeData:a})},v().createElement(y.TagInput,{onFocus:()=>s(!0),value:i.multiple?t:t?[t]:[],maxTagCount:i.multiple?300:1,renderTagItem:(e,t,n)=>v().createElement(y.Tag,{key:t,closable:!0,color:"white",onClick:()=>{e.startsWith("composite://")&&Rt.openFile(e.substring(12))},onClose:n},e&&e.startsWith("composite://")?e.substring(e.lastIndexOf("/")+1):e),onChange:e=>{i.multiple?n&&n(e):n&&n(e[0])}}))})),Qt=(0,y.withField)((e=>{let{value:t,onChange:n}=e;const i=Rt.editorComposite.getCompositeElementTree().filter((e=>e.key!==Rt.selectedNode?.getId()));return v().createElement(y.TreeSelect,{className:"slot-tree-select",showClear:!0,size:"small",onChange:(e,t)=>{n(e)},value:t,style:{width:180},dropdownStyle:{maxHeight:320,overflow:"auto"},treeData:i,placeholder:"请选择目标元素"})})),en=(0,y.withField)((e=>{let{value:t,onChange:n}=e;const[i,o]=(0,b.useState)([]);return(0,b.useEffect)((()=>{o(Rt.appService.filterFiles((e=>e.mimeType&&e.mimeType.indexOf("audio")>-1)).map((e=>(console.log("audio file=>",e),{value:e.path,label:e.label}))))}),[t]),v().createElement(y.Select,{size:"small",value:t,showClear:!0,onChange:n},i&&i.map((e=>v().createElement(y.Select.Option,{value:e.value,key:e.value},e.label))))})),tn=(0,y.withField)((e=>{let{value:t,onChange:n,...i}=e;return i.icon?v().createElement(y.Button,{icon:v().createElement("i",{style:{fontSize:16},className:i.icon}),size:"small",type:t?"primary":"tertiary",theme:t?"solid":"borderless",onClick:()=>{n(!t)}}):i.toggle?v().createElement(v().Fragment,null):v().createElement(y.Checkbox,{size:"small",checked:t,onChange:()=>n(!t)})})),nn=(0,y.withField)((e=>{let{value:t,onChange:n,options:i}=e;const[o,s]=(0,b.useState)([]);return(0,b.useEffect)((()=>{"function"==typeof i.treeData?i.treeData().then((e=>{s(e.default)})):s(i.treeData)}),[i]),v().createElement(y.TreeSelect,{style:{width:250},checkRelation:"unRelated",multiple:!0,leafOnly:!0,value:t,onChange:n,dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:o,placeholder:"请选择"})})),on=nn;function sn(){return sn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},sn.apply(null,arguments)}const{Title:rn}=y.Typography,an=e=>{let{value:t,input:n,path:i,width:o=1024,height:s=600,title:r="请选择",icon:a="bi bi-pencil-square",...l}=e;const[c,d]=(0,b.useState)(!1);return v().createElement(y.Popover,{content:v().createElement("div",{style:{width:o+"px",height:s+"px"}},v().createElement(rn,{heading:6,style:{padding:"14px"}},r),v().createElement(Te,sn({app:"ridge-editor-app",path:i,value:t,input:n},l))),trigger:"click"},v().createElement(y.Button,{theme:"borderless",type:"tertiary",icon:v().createElement("i",{className:a}),size:"small",onClick:()=>{d(!0)}}))},ln=(0,y.withField)((e=>{let{value:t,onChange:n,options:i}=e;return v().createElement(y.Space,null,v().createElement(y.Input,{size:"small",readonly:!0,value:t}),v().createElement(an,{width:1024,height:600,title:"请选择类样式",value:t,input:n,path:"field/style/DialogStyleSelect"}))})),cn=()=>v().createElement(y.Empty,{title:"应用未安装效果库",description:v().createElement("span",null,v().createElement(y.Typography.Text,null,"试试 "),v().createElement(y.Typography.Text,{link:!0},"去查找安装"))}),dn=(0,y.withField)((e=>{let{value:t,onChange:n}=e;const[i,o]=(0,b.useState)(!1),[s,r]=(0,b.useState)(!0),[a,l]=(0,b.useState)([]),[,c=""]=(t||"").split("/");return v().createElement(v().Fragment,null,v().createElement(y.TextArea,{value:t,rows:2,showClear:!0,onChange:e=>{n&&n(e)}}),v().createElement(y.Popover,{visible:i,content:s?v().createElement(y.Spin,null):v().createElement("div",{className:"effect-pop-content"},a&&0===a.length&&v().createElement(cn,null),v().createElement(y.Tabs,{style:{height:"100%"},size:"small",type:"button"},a&&a.map((e=>{const t=e.EditControl;return v().createElement(y.TabPane,{style:{height:"100%"},key:e.name,tab:v().createElement("span",null,e.description)},v().createElement(t,{value:c,onChange:t=>{n&&n(e.packageName+"/"+t)}}))})))),trigger:"custom",onClickOutSide:()=>{o(!1)}},v().createElement(y.Button,{theme:"borderless",type:"tertiary",icon:v().createElement("i",{className:"bi bi-pencil"}),size:"small",onClick:()=>{(async()=>{const e=Rt.pluginPackages||[],t=[];for(const n of e){const e=await Rt.loadPlugin(n);e.control&&(e.EditControl=(await e.control()).default,t.push(e))}l(t),r(!1),o(!0)})()}},"配置")))}));function pn(){return pn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},pn.apply(null,arguments)}const hn=(0,y.withField)((e=>{let{value:t,onChange:n,...i}=e;return v().createElement(y.Input,pn({},i,{value:t,onChange:e=>{n(e)}}))})),mn=(0,y.withField)((e=>{let{value:t,onChange:n,options:i}=e;const{Component:o}=i;return o({context:Rt,value:t,onChange:n})})),gn=(0,y.withField)((e=>{let{value:t,input:n,onChange:i}=e,o=null;if(t)try{o=y.ColorPicker.colorStringToValue(t)}catch(e){o=y.ColorPicker.colorStringToValue("#fff")}return v().createElement(y.ColorPicker,{alpha:!0,usePopover:!0,value:o,onChange:e=>{console.log(e),n&&n(e.hex),i&&i(e.hex)}})}));function un(){return un=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},un.apply(null,arguments)}const{InputNumber:fn,Select:bn,TagInput:vn,DatePicker:wn,Checkbox:yn}=y.Form,{Text:xn}=y.Typography;class Cn extends v().Component{constructor(e){super(e),this.ref=v().createRef(),this.controlGeneratorMap={divider:e=>v().createElement(y.Divider,{margin:"0",align:"center"},e.label),number:(e,t)=>v().createElement(fn,{size:"small",label:e.label,disabled:t,innerButtons:!0,field:e.field}),string:(e,t)=>v().createElement(hn,{size:"small",label:e.label,field:e.field,disabled:t}),textarea:(e,t)=>v().createElement(qt,{label:e.label,field:e.field,disabled:t,type:"string"}),checkbox:(e,t)=>v().createElement(yn,{size:"small",label:e.label,field:e.field,disabled:t}),boolean:(e,t)=>v().createElement(tn,un({noLabel:null==e.label,label:e.label??""},e)),select:(e,t)=>{const n=(e=>Array.isArray(e)?e.map((e=>"string"==typeof e?{label:e,value:e}:e)):e)(e.options||e.optionList);return v().createElement(bn,{size:"small",allowCreate:e.allowCreate,filter:e.filter,label:e.label,showClear:!1===e.required,field:e.field,placeholder:e.placeholder,multiple:e.multiple,optionList:n,disabled:t})},radiogroup:(e,t)=>v().createElement(Zt,{label:e.label,field:e.field,options:e.optionList||e.options,disabled:t}),event:(e,t,n)=>v().createElement(Jt,{className:"event-field",noLabel:!0,field:e.field,options:{label:e.label,...n}}),image:(e,t)=>v().createElement(Kt,{label:e.label,field:e.field,disabled:t,options:e}),page:(e,t)=>v().createElement(Ht,{label:e.label,field:e.field,disabled:t,options:e}),audio:(e,t)=>v().createElement(en,{label:e.label,field:e.field,disabled:t}),json:(e,t)=>v().createElement(qt,{label:e.label,field:e.field,disabled:t}),object:(e,t)=>v().createElement(qt,{label:e.label,field:e.field,disabled:t}),array:(e,t)=>v().createElement(qt,{label:e.label,field:e.field,disabled:t}),class:e=>v().createElement(ln,{label:e.label,field:e.field,options:e}),tree:e=>v().createElement(on,{label:e.label,field:e.field,options:e}),style:e=>v().createElement(ln,{label:e.label,field:e.field,options:e}),element:e=>v().createElement(Qt,{label:e.label,field:e.field,options:{tree:!0}}),file:e=>v().createElement(Gt,{label:e.label,field:e.field,options:e}),color:e=>v().createElement(gn,{label:e.label,field:e.field,options:e}),strings:e=>v().createElement(vn,{size:"small",label:e.label,field:e.field}),datetime:e=>v().createElement(wn,{size:"small",label:e.label,field:e.field,type:"dateTime"}),effect:e=>v().createElement(dn,{label:e.label,field:e.field})}}getRenderField(e,t,n){if(!e.field)return v().createElement(y.Form.Slot,{label:e.label},v().createElement(xn,{disabled:!0},"未定义属性名称"));if(!this.controlGeneratorMap[e.control])return"function"==typeof e.control?e.controlComponent?v().createElement(mn,{label:e.label??"",field:e.field,options:{Component:e.controlComponent}}):v().createElement(Yt,{label:e.label??"",field:e.field,options:{controlFunc:e.control,controlBtnText:e.btnText,inline:e.inline,preload:e.preload}}):v().createElement(y.Form.Slot,{label:e.label},v().createElement(xn,{disabled:!0},"未定义配置方式"));try{return this.controlGeneratorMap[e.control](e,t,n)}catch(e){return v().createElement("div",null,"---")}}renderField(e,t,n,i){if("children"===e.type||"slot"===e.type)return;if("function"==typeof e.hidden?e.hidden(n.values):e.hidden)return;const o="function"==typeof e.readonly?e.readonly(n.values):e.readonly;null==e.control&&(e.control=e.type),!e.label&&e.description&&(e.label=e.description),"number"!==e.type&&"color"!==e.type&&"boolean"!==e.type||e.width||(e.width="50%");const s=this.getRenderField(e,o,i),r=["field-block"];return e.width&&"100%"!==e.width||r.push("full"),"divider"===e.type?v().createElement(y.Divider,{key:t,margin:"0",align:"left"},e.label||""):e.fieldEx?(r.push("with-code-expr"),v().createElement("div",{key:t,className:r.join(" "),style:{width:e.width||"100%"}},v().createElement("div",{style:{flex:1}},s),v().createElement("div",{style:{width:"22px"}},v().createElement(_t,{className:"field-code-expr",noLabel:!0,field:e.fieldEx,options:i})))):v().createElement("div",{key:t,className:r.join(" "),style:{width:e.width||"100%"}},s)}render(){const e=this.renderField.bind(this),{fields:t,getFormApi:n,onValueChange:i,style:o,initValues:s,options:r,labelPosition:a="left"}=this.props;return v().createElement("div",{className:"object-form",style:o},v().createElement(y.Form,{size:"small",labelAlign:"right",labelPosition:a,layout:"horizontal",getFormApi:e=>{this.api=e,n&&n(e)},initValues:s,onValueChange:i,render:n=>{let{formState:i,formApi:o,values:s}=n;return v().createElement(v().Fragment,null,t&&t.map(((t,n)=>{try{return e(t,n,i,r)}catch(e){return null}})))}}))}}const En=Cn;n(5206),n(5136),n(1639),n(3080);var kn=n(2025),Sn={};Sn.styleTagTransform=g(),Sn.setAttributes=d(),Sn.insert=l().bind(null,"head"),Sn.domAPI=r(),Sn.insertStyleElement=h(),o()(kn.A,Sn),kn.A&&kn.A.locals&&kn.A.locals;const{Text:Pn}=y.Typography,Nn=v().createContext("light");v().Component;const Tn=k()("editor:config-panel"),On=[{label:"名称",control:"string",field:"title"}],jn=[{label:"距左",control:"number",width:"50%",readonly:e=>e&&(e.full||e.locked),field:"style.x",fieldEx:"styleEx.x"},{label:"距上",width:"50%",control:"number",readonly:e=>e&&(e.full||e.locked),field:"style.y",fieldEx:"styleEx.Y"},{label:"宽度",width:"50%",control:"number",readonly:e=>e&&(e.full||e.locked),field:"style.width",fieldEx:"styleEx.width"},{label:"高度",width:"50%",control:"number",field:"style.height",readonly:e=>e&&(e.full||e.locked),fieldEx:"styleEx.height"}],Ln={label:"显示",type:"boolean",control:"checkbox",width:"50%",field:"style.visible",fieldEx:"styleEx.visible",connect:!0},Fn={label:"填满",width:"50%",type:"boolean",field:"full"},An=[{label:"页面名称",control:"string",readonly:!0,field:"name"},{label:"宽度",control:"number",width:"128px",field:"style.width"},{width:"24px",type:"boolean",control:"boolean",prompt:"固定宽度",icon:"bi bi-bounding-box",field:"style.widthFix"},{label:"高度",width:"128px",control:"number",field:"style.height"},{width:"24px",type:"boolean",control:"boolean",prompt:"固定高度",icon:"bi bi-bounding-box",field:"style.heightFix"},{field:"jsFiles",label:"脚本库",type:"file",multiple:!0,fileType:"javascript",connect:!1},{label:"字体库",field:"fontFiles",type:"strings",connect:!1},{field:"classList",label:"样式",type:"style",connect:!0,value:[]}],zn=[{label:"页面单击",control:"event",field:"events.onClick"},{label:"鼠标按下",control:"event",field:"events.onMouseDown"},{label:"鼠标移动",control:"event",field:"events.onMouseMove"}];class Dn extends v().Component{constructor(e){super(e),this.ref=v().createRef(),this.componentPropFormApi=null,this.componentEventFormApi=null,this.pagePropFormApi=null,Rt.services.configPanel=this,this.state={configPage:!0,pagePropsFields:[],pageEventFields:[],nodePropFields:[],nodeEventFields:[]}}componentDidMount(){}componentSelected(e){let t=e;e instanceof Node&&(t=e.view),this.componentView=t,Tn("updatePanelConfig",t);const n=[];n.push(...On),t.getParent()!==Rt.editorComposite&&t.getParent().componentDefinition?t.getParent()&&(n.push({type:"divider",label:"来自父-"+t.getParent().componentDefinition.title}),n.push(...t.getParent().componentDefinition?.childProps||[]),n.push({type:"divider"})):(n.push(...jn),t.componentDefinition&&(!1!==t.componentDefinition.hideable&&n.push(Ln),!0===t.componentDefinition.fullScreenable&&t.getParent()===Rt.editorComposite&&n.push(Fn)));const i=[];if(t.componentDefinition){for(const e of t.componentDefinition.props??[]){if(!e.name)continue;const i={componentName:t.componentDefinition.name,packageName:t.componentDefinition.packageName};e.connect?Object.assign(i,e,{field:"props."+e.name,fieldEx:"propEx."+e.name}):Object.assign(i,e,{field:"props."+e.name}),n.push(i)}for(const e of t.componentDefinition.events??[]){const t={label:e.label,type:"function",control:"event",field:"events."+e.name};i.push(t)}"ridge-container/composite"===t.componentDefinition.componentPath&&t.el.composite&&t.el.composite.config&&(n.push(...wt(t.el.composite).map((e=>{const[,t]=e.field.split(".");return e.fieldEx="propEx."+t,e.field="props."+t,e}))),i.push(...yt(t.el.composite)))}this.componentPropFormApi.reset(),this.setState({configPage:!1,nodePropFields:n,nodeEventFields:i},(()=>{this.updateComponentConfig(t),this.componentEventFormApi.setValue("events",t.config.events,{notNotify:!0})}))}updateComponentConfig(e){if(e===this.componentView)for(const t of["title","props","propEx","style","styleEx","id","visible","full"])this.componentPropFormApi.setValue(t,e.config[t],{notNotify:!0})}updatePageConfigFields(){const{editorComposite:e}=Rt,{appService:t}=Rt.services;this.setState({configPage:!0,pagePropsFields:[...An,...wt(Rt.editorComposite)],pageEventFields:[...zn,...yt(Rt.editorComposite)]},(()=>{const{classList:t,style:n,jsFiles:i,fontFiles:o,name:s,properties:r,events:a}=e.config;this.pagePropFormApi.setValue("classList",t,{notNotify:!0}),this.pagePropFormApi.setValue("style",n,{notNotify:!0}),this.pagePropFormApi.setValue("properties",r,{notNotify:!0}),this.pagePropFormApi.setValue("fontFiles",o,{notNotify:!0}),this.pagePropFormApi.setValue("jsFiles",i,{notNotify:!0}),this.pagePropFormApi.setValue("name",s,{notNotify:!0}),this.pageEventFormApi.setValue("events",a,{notNotify:!0})}))}nodeRectChange(e){this.styleChange(e)}render(){const{nodePropFields:e,nodeEventFields:t,pagePropsFields:n,pageEventFields:i,configPage:o}=this.state;return v().createElement("div",{className:"config-panel"},v().createElement(y.Tabs,{className:"on-title",type:"card",style:{display:o?"none":"block"}},v().createElement(y.TabPane,{tab:"属性",itemKey:"props"},v().createElement(En,{fields:e,getFormApi:e=>{this.componentPropFormApi=e},onValueChange:(e,t)=>{e.id===this.componentView.config.id&&Rt.updateComponentConfig(this.componentView,e,t)}})),v().createElement(y.TabPane,{tab:"交互",itemKey:"interact"},v().createElement(En,{fields:t,getFormApi:e=>{this.componentEventFormApi=e},onValueChange:(e,t)=>{Rt.updateComponentConfig(this.componentView,e)}}))),v().createElement(y.Tabs,{type:"card",className:"on-title",style:{display:o?"block":"none"}},v().createElement(y.TabPane,{tab:"基础",itemKey:"style"},v().createElement(En,{fields:n,getFormApi:e=>{this.pagePropFormApi=e},onValueChange:(e,t)=>{Rt.editorComposite.updatePageConfig(e)}})),v().createElement(y.TabPane,{tab:"交互",itemKey:"interact"},v().createElement(En,{fields:i,getFormApi:e=>{this.pageEventFormApi=e},onValueChange:(e,t)=>{Rt.editorComposite.updatePageConfig(e)}}))))}}var Mn,Rn,In;Mn=Dn,In=Nn,(Rn=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(Rn="contextType"))in Mn?Object.defineProperty(Mn,Rn,{value:In,enumerable:!0,configurable:!0,writable:!0}):Mn[Rn]=In;class Bn extends b.Component{constructor(e){super(e),function(e,t,n){(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"loadSvg",(e=>{fetch(e.replace(/\/+/g,"/")).then((e=>e.text())).then((e=>{(new window.DOMParser).parseFromString(e,"image/svg+xml"),this.setState({svgContent:e})})).catch((e=>{console.error("Error fetching SVG:",e)}))})),this.state={svgContent:null}}componentDidMount(){this.loadSvg(this.props.src)}componentDidUpdate(e){e.src!==this.props.src&&this.loadSvg(this.props.src)}render(){const{svgContent:e}=this.state,{width:t=32,height:n=32}=this.props;return v().createElement("div",{className:"svg-container",style:{width:t+"px",height:n+"px"},dangerouslySetInnerHTML:{__html:e}})}}const Un=Bn;var _n=n(9097),Wn={};function Vn(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Wn.styleTagTransform=g(),Wn.setAttributes=d(),Wn.insert=l().bind(null,"head"),Wn.domAPI=r(),Wn.insertStyleElement=h(),o()(_n.A,Wn),_n.A&&_n.A.locals&&_n.A.locals;const Jn=n(124)("ridge:cl"),{Text:$n,Title:qn}=y.Typography;class Hn extends v().Component{constructor(){super(),Vn(this,"changePackageTheme",((e,t)=>{const{appPackageObject:n}=this.state;n.themes||(n.themes={}),n.themes[e]=t,Rt.services.appService.savePackageJSONObject(n),this.setState({appPackageObject:(0,bt.cloneDeep)(n)}),Rt.loader.loadPackageTheme(e,t)})),Vn(this,"renderComponentItem",((e,t)=>{const{dragStart:n,renderComponentIcon:i}=this,{loadedComponents:o}=this.state;let s=e;return"string"==typeof e&&(s=o.filter((n=>n.packageName===t.name&&n.componentName===e))[0]),s?v().createElement(y.List.Item,null,v().createElement("div",{style:{color:t.iconFill??""},draggable:!0,onDragStart:e=>n(e,Object.assign(s,{componentPath:(t.name+"/"+s.path).replace(/\/+/g,"/")})),className:"component-container"},s.icon&&v().createElement("div",{className:"image-icon"},i(Rt.baseUrl+"/"+t.name+"/",s.icon),s.title&&v().createElement($n,null,s.title," ")))):v().createElement(y.List.Item,null,v().createElement("div",{className:"component-container loading"}))})),this.ref=v().createRef(),this.state={appPackageObject:{},loadedPackages:[],loadedComponents:[],currentPackage:"",fullLoading:!0,popComponent:{},componentPopOver:!1},Rt.services.componentListPanel=this,this.loadedComponents=[]}async ensurePackageComponents(e,t){if(e)if(await Rt.loader.confirmPackageDependencies(e.name),e.ridgeDist){if(!e.distLoaded){await Rt.loader.loadScript(e.name+"/"+e.ridgeDist);const n=window[e.name],i=[];for(const t in n){const o=n[t];o.componentName=o.name,o.componentPath=t,i.push(o),await Rt.loader.prepareComponent(o,{packageName:e.name,path:t})}const o=(t||this.state.loadedPackages).map((t=>(t.name===e.name&&(t.components=i,t.distLoaded=!0),t)));this.setState({loadedComponents:[...this.state.loadedComponents,...i],loadedPackages:o})}}else if(e.components)for(const t of e.components){const n=e.name+"/"+t;0===this.loadedComponents.filter((e=>e.componentPath===n)).length&&Rt.loadComponent(n).then((i=>{i&&(i.packageName=e.name,i.componentName=t,i.componentPath=n,this.loadedComponents.push(i),this.setState({loadedComponents:[...this.loadedComponents]}))}))}}tabChange(e){this.setState({currentPackage:e});const t=this.state.loadedPackages.filter((t=>t.name===e))[0];this.ensurePackageComponents(t)}async loadPackages(){this.setState({fullLoading:!0});const{loadedPackages:e,appPackageObject:t}=await Rt.loadAppPackages();e.length?(this.setState({fullLoading:!1,appPackageObject:t,loadedPackages:e}),this.state.currentPackage||this.setState({currentPackage:e[0].name})):this.setState({fullLoading:!1}),await this.ensurePackageComponents(e[0],e)}componentDidMount(){this.loadPackages()}dragStart(e,t){Rt.draggingComponent=t,window.dragComponent=t,e.dataTransfer.setData("text/plain",JSON.stringify(t));const n=new window.Image;n.src=t.iconUrl,n.style.width="50px",n.style.height="50px";const i=document.createElement("canvas");i.width=i.height=50,i.getContext("2d").drawImage(n,0,0,50,50),Jn("drag start",t,n),e.dataTransfer.setDragImage(i,25,25)}getFilteredComponents(e){const{loadedComponents:t}=this.state;return this.context?t.filter((e=>(e.title||e.label).indexOf(this.context)>-1)):t.filter((t=>t.packageName===e))}renderComponentIcon(e,t){if(t.$$typeof)return t;const n=(0,Ve.extname)(t);return"svg"===n?v().createElement(Un,{src:e+t}):["jpg","jpeg","png","gif","webp","bmp","tiff","ico"].indexOf(n)>-1?v().createElement("img",{src:e+t}):v().createElement("i",{className:t+" font-icon"})}renderDescription(e){return v().createElement("div",{style:{width:400,margin:"0 auto",display:"flex",flexDirection:"column",padding:20}},e.splash&&v().createElement("img",{src:Rt.baseUrl+"/"+e.packageName+"/"+e.splash}),v().createElement(qn,{heading:4,style:{margin:"8px 0"}},e.title),v().createElement($n,null,e.description))}render(){const{fullLoading:e,loadedPackages:t,currentPackage:n,appPackageObject:i}=this.state,{dragStart:o,renderDescription:s,changePackageTheme:r,renderComponentItem:a}=this,l=this.tabChange.bind(this);return v().createElement("div",{className:"component-panel"},e&&v().createElement(y.Spin,{size:"large",tip:"等待应用载入"}),!e&&t.length&&v().createElement(y.Tabs,{type:"button",size:"small",tabPosition:"top",tabBarExtraContent:v().createElement(Te,{app:"ridge-editor-app",path:"DialogRepoApp"}),activeKey:n,onChange:e=>l(e)},t.length&&t.map((e=>{let t=v().createElement("div",{className:"package-icon "+e.icon});t=e.logo?v().createElement("div",{preview:!1,className:"package-icon"},v().createElement(y.Image,{preview:!1,src:Rt.baseUrl+"/"+e.name+"/"+e.logo})):e.icon?e.icon.indexOf(".")>-1?v().createElement("div",{className:"package-icon"},v().createElement(Un,{width:24,height:24,src:Rt.baseUrl+"/"+e.name+"/"+e.icon})):v().createElement("div",{className:"package-icon"},v().createElement("i",{className:e.icon})):v().createElement("div",{className:"package-icon"},e.name.charAt(0));const n=e.components||e.promotions||[];return v().createElement(y.TabPane,{style:{padding:"4px"},className:"tab-title",collapsible:!0,tab:t,key:e.name,itemKey:e.name},e.themes&&v().createElement(y.Space,null,v().createElement($n,null,"主题"),v().createElement(y.Select,{style:{width:120},onChange:t=>{r(e.name,t)},value:i.themes?i.themes[e.name]:"",size:"small",optionList:Object.keys(e.themes).map((t=>({label:t,value:e.themes[t]})))})),v().createElement(y.List,{loading:0===n.length,grid:{gutter:6,span:8},dataSource:(e.components||e.promotions||[]).filter((e=>!0!==e.private)),renderItem:t=>a(t,e)}))}))))}}const Kn=Hn,Xn=e=>{let{show:t,value:n,siblingNames:i,change:o,confirm:s,cancel:r}=e;const[a,l]=(0,b.useState)(!0);return v().createElement(y.Modal,{title:"重命名",visible:t,onOk:()=>{a&&s()},onCancel:()=>{r()}},v().createElement(y.Input,{value:n,validateStatus:a?"":"error",label:"名称",onChange:e=>{o(e),(e=>{const t=A()(e);l(!0),(""===t||i&&i.indexOf(t)>-1)&&l(!1)})(e)}}))},Zn=e=>{let{show:t,title:n,parentPaths:i,siblingNames:o,confirm:s,cancel:r}=e;const[a,l]=(0,b.useState)(!0),[c,d]=(0,b.useState)("");return v().createElement(y.Modal,{title:n||"新增..",visible:t,onOk:()=>{a&&(s(c),d(""))},onCancel:()=>{r(),d("")}},v().createElement(y.Form,{labelPosition:"left",labelAlign:"right",labelWidth:80},v().createElement(y.Form.Input,{disabled:!0,label:"所在目录",initValue:i}),v().createElement(y.Form.Input,{value:c,validateStatus:a?"":"error",label:"名称",onChange:e=>{d(e),(e=>{const t=A()(e);l(!0),(""===t||o&&o.indexOf(t)>-1)&&l(!1)})(e)}})))},Yn=()=>v().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},v().createElement("path",{fill:"currentColor",d:"M3 1h12.414L21 6.586V23H3V1Zm2 2v18h14V9h-6V3H5Zm10 .414V7h3.586L15 3.414Zm-3.793 8.793L9.414 14l1.793 1.793l-1.414 1.414L6.586 14l3.207-3.207l1.414 1.414Zm3-1.414L17.414 14l-3.207 3.207l-1.414-1.414L14.586 14l-1.793-1.793l1.414-1.414Z"})),Gn=()=>v().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.2em",height:"1.2em",viewBox:"0 0 24 24"},v().createElement("path",{fill:"currentColor",d:"M1 2.5h8.48l2 2.5H23v7h-2V7H10.52l-2-2.5H3V19h11v2H1V2.5ZM21 14v3h3v2h-3v3h-2v-3h-3v-2h3v-3h2Z"})),Qn=()=>v().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.2em",height:"1.2em",viewBox:"0 0 24 24"},v().createElement("path",{fill:"currentColor",d:"M3 1h12.414L21 6.586V12h-2V9h-6V3H5v18h7v2H3V1Zm12 2.414V7h3.586L15 3.414ZM20 14v4h4v2h-4v4h-2v-4h-4v-2h4v-4h2Z"})),ei=()=>v().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},v().createElement("path",{fill:"currentColor",d:"M12 2.586L17.914 8.5L16.5 9.914l-3.5-3.5V16h-2V6.414l-3.5 3.5L6.086 8.5L12 2.586ZM4.5 14v5h15v-5h2v7h-19v-7h2Z"})),ti=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 14 14"},React.createElement("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("path",{d:"M12.5 12.5a1 1 0 0 1-1 1h-9a1 1 0 0 1-1-1v-11a1 1 0 0 1 1-1h6l4 4z"}),React.createElement("path",{d:"M3.5 10.5V6.743c0-.134.109-.243.243-.243v0c.096 0 .182.056.221.143l.754 1.675A.31.31 0 0 0 5 8.5v0a.31.31 0 0 0 .282-.182l.754-1.675a.24.24 0 0 1 .221-.143v0c.134 0 .243.109.243.243V10.5m3-4v4m-1-1l1 1l1-1"}))),ni=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 16 16"},React.createElement("path",{fill:"currentColor",d:"M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v7a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 12.5zM2.5 3a.5.5 0 0 0-.5.5V6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3zM14 7H2v5.5a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5z"})),ii=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},React.createElement("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"},React.createElement("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),React.createElement("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),React.createElement("circle",{cx:"10",cy:"12",r:"2"}),React.createElement("path",{d:"m20 17l-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"}))),oi=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},React.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M6.816 3H7a1 1 0 0 1 0 2h-.18c-.825.005-1.12.101-1.23.182h-.001c-.022.016-.18.124-.18.828v3.893c0 .88-.45 1.526-.972 1.96c.523.428.971 1.07.971 1.955v4.172c0 .71.16.816.18.83c.11.08.404.175 1.231.18H7a1 1 0 1 1 0 2h-.189c-.797-.004-1.707-.062-2.394-.559c-.786-.568-1.009-1.476-1.009-2.451v-4.172c0-.142-.065-.312-.376-.507c-.321-.201-.763-.326-1.123-.359A1 1 0 0 1 1 11.956v-.166a1 1 0 0 1 .91-.996c.35-.031.79-.162 1.113-.371c.318-.205.385-.383.385-.52V6.01c0-.972.224-1.878 1.007-2.447c.687-.498 1.596-.559 2.396-.563zM16 4a1 1 0 0 1 1-1h.189c.8.004 1.71.065 2.396.563c.784.569 1.007 1.475 1.007 2.447v3.893c0 .137.067.315.385.52c.323.209.763.34 1.113.371a1 1 0 0 1 .91.996v.166a1 1 0 0 1-.91.996c-.359.033-.801.158-1.122.36c-.31.194-.376.364-.376.506v4.172c0 .975-.223 1.883-1.009 2.451c-.687.497-1.597.555-2.394.559H17a1 1 0 1 1 0-2h.18c.828-.005 1.121-.1 1.232-.18c.02-.014.18-.12.18-.83v-4.172c0-.884.448-1.527.971-1.956c-.521-.433-.971-1.08-.971-1.96V6.01c0-.704-.159-.812-.18-.827l-.002-.001c-.11-.08-.405-.177-1.23-.182H17a1 1 0 0 1-1-1M9 14a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1m3 0a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1m3 0a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1",clipRule:"evenodd"})),si=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},React.createElement("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"},React.createElement("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),React.createElement("path",{d:"M14 2v4a2 2 0 0 0 2 2h4m-10 4a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1a1 1 0 0 1 1 1v1a1 1 0 0 0 1 1m4 0a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1a1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1"}))),ri=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 256 256"},React.createElement("g",{fill:"currentColor"},React.createElement("path",{d:"M128 129.09V232a8 8 0 0 1-3.84-1l-88-48.18a8 8 0 0 1-4.16-7V80.18a8 8 0 0 1 .7-3.25Z",opacity:".2"}),React.createElement("path",{d:"m223.68 66.15l-88-48.15a15.88 15.88 0 0 0-15.36 0l-88 48.17a16 16 0 0 0-8.32 14v95.64a16 16 0 0 0 8.32 14l88 48.17a15.88 15.88 0 0 0 15.36 0l88-48.17a16 16 0 0 0 8.32-14V80.18a16 16 0 0 0-8.32-14.03M128 32l80.34 44l-29.77 16.3l-80.35-44Zm0 88L47.66 76l33.9-18.56l80.34 44ZM40 90l80 43.78v85.79l-80-43.75Zm176 85.78l-80 43.79v-85.75l32-17.51V152a8 8 0 0 0 16 0v-44.45L216 90v85.77Z"})));var ai=n(2824),li={};function ci(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}li.styleTagTransform=g(),li.setAttributes=d(),li.insert=l().bind(null,"head"),li.domAPI=r(),li.insertStyleElement=h(),o()(ai.A,li),ai.A&&ai.A.locals&&ai.A.locals;const{Text:di}=y.Typography;class pi extends v().Component{constructor(){super(),ci(this,"openSearchPackageDialog",(()=>{this.setState({packageSearchDialogVisible:!0})})),ci(this,"showCreateDialog",(e=>{this.setState({dialgeCreateFileType:e,dialogCreateShow:!0,dialogCreateTitle:{js:"创建程序文件",page:"创建页面",text:"创建文本文件",folder:"创建目录"}[e]})})),ci(this,"onCreateConfirm",(async e=>{const{dialgeCreateFileType:t}=this.state,{appService:n}=Rt.services;try{"page"===t?await n.createComposite(this.getCurrentParentId(),e):"folder"===t?await n.createDirectory(this.getCurrentParentId(),e):"js"===t?await n.createFile(this.getCurrentParentId(),e,Ue("\nexport default {\n  name: 'Hello',\n  state: {\n    name: 'World' //姓名\n  }\n}\n","text/javascript")):"text"===t&&await n.createFile(this.getCurrentParentId(),e,Ue("","text/plain")),this.setState({dialogCreateShow:!1}),y.Toast.success("已经成功创建 "+e),await this.loadAndUpdateFileTree()}catch(e){y.Toast.success("创建文件失败 "+e)}})),ci(this,"onFileUpload",(async e=>{const{appService:t}=Rt.services,n=[];for(const i of e)try{i.name.endsWith(".zip")?await t.backUpService.importFolderArchive(i,this.getCurrentPath()):await t.createFile(this.getCurrentParentId(),i.name,i)}catch(e){n.push(i)}await this.loadAndUpdateFileTree(),n.length?y.Toast.warning({content:"文件添加错误：存在相同名称文件",duration:3}):y.Toast.success("文件上传完成")})),ci(this,"onRenameConfirm",(async()=>{const{appService:e}=Rt.services,{selectedNodeKey:t,valueRename:n}=this.state,i=await e.rename(t,n);Rt.onFileRenamed(t,n),i&&(await this.loadAndUpdateFileTree(),this.setState({dialogRenameShow:!1}))})),ci(this,"onRemoveClicked",(async e=>{Rt.getOpenedFileMap().has(e.id)?y.Toast.warning("此页面在工作区已经打开，请先关闭再删除页面"):y.Modal.confirm({zIndex:10001,title:"确认删除",content:"删除后文件无法找回，推荐您可先通过导出进行备份",onOk:async()=>{const{appService:t}=Rt.services;await t.deleteFile(e.key),this.setState({selectedNodeKey:null}),this.loadAndUpdateFileTree(),y.Toast.success("已经成功删除 "+e.label)}})})),ci(this,"onCopyClicked",(async e=>{const{appService:t}=Rt.services;await t.copy(e.key),this.loadAndUpdateFileTree(),y.Toast.success("文件复制完成")})),ci(this,"onOpenClicked",(e=>{"directory"!==e.type&&Rt.openFile(e.key)})),ci(this,"onRenameClicked",(e=>{this.setState({selectedNodeKey:e.key,dialogRenameShow:!0,valueRename:e.label})})),ci(this,"move",(async(e,t,n)=>{let i=-1;i=!1===n&&"directory"===e.type?e.key:e.parent;const{appService:o}=Rt.services;await o.move(t.key,i)?await this.loadAndUpdateFileTree():y.Toast.warning({content:"目录移动错误：存在同名的文件",duration:3})})),ci(this,"onFileExportClick",(e=>{const{appService:t}=Rt.services;t.exportFileArchive(e.key)})),ci(this,"renderFullLabel",((e,t)=>{const{currentOpenId:n}=this.state,i=[];return i.push(v().createElement(y.Dropdown.Item,{key:"open",icon:v().createElement("i",{class:"bi bi-pencil-square"}),onClick:()=>{this.onOpenClicked(t)}},"打开")),i.push(v().createElement(y.Dropdown.Item,{key:"copy",icon:v().createElement("i",{class:"bi bi-copy"}),onClick:()=>{this.onCopyClicked(t)}},"复制")),i.push(v().createElement(y.Dropdown.Item,{key:"export",icon:v().createElement("i",{style:{fontSize:"16px"},class:"bi bi-file-zip"}),onClick:()=>{this.onFileExportClick(t)}},"导出")),i.push(v().createElement(y.Dropdown.Item,{key:"rename",icon:v().createElement("i",{class:"bi bi-pencil"}),onClick:()=>{this.onRenameClicked(t)}},"重命名")),i.push(v().createElement(y.Dropdown.Divider,{key:"div"})),i.push(v().createElement(y.Dropdown.Item,{key:"delete",type:"danger",icon:v().createElement("i",{class:"bi bi-trash3"}),onClick:()=>{this.onRemoveClicked(t)}},"删除")),v().createElement("div",{className:"tree-label"+(n===t.key?" opened":"")},v().createElement(di,{ellipsis:{showTooltip:!0},style:{width:"calc(100% - 48px)"},className:"label-content"},e),v().createElement(y.Dropdown,{className:"app-files-dropdown",trigger:"click",clickToHide:!0,render:v().createElement(y.Dropdown.Menu,null,i)},v().createElement(y.Button,{className:"more-button",size:"small",theme:"borderless",type:"tertiary",icon:v().createElement("i",{class:"bi bi-three-dots-vertical"})})))})),ci(this,"RenderAppDropDown",(()=>v().createElement("div",{className:"action-btn-appConfig"},v().createElement(Te,{app:"ridge-editor-app",path:"user/History"}),v().createElement(Te,{app:"ridge-editor-app",path:"AppConf"})))),ci(this,"RenderCreateDropDown",(()=>{const{showCreateDialog:e}=this;return v().createElement(y.Dropdown,{trigger:"click",closeOnEsc:!0,clickToHide:!0,keepDOM:!0,position:"bottomLeft",render:v().createElement(y.Dropdown.Menu,{className:"app-files-dropdown"},v().createElement(y.Dropdown.Item,{icon:v().createElement(Qn,null),onClick:()=>e("page")},"创建页面"),v().createElement(y.Dropdown.Item,{icon:v().createElement(Gn,null),onClick:()=>e("folder")},"创建目录"),v().createElement(y.Dropdown.Item,{icon:v().createElement(Yn,null),onClick:()=>e("js")},"创建脚本库"),v().createElement(y.Dropdown.Item,{icon:v().createElement(ei,null)},v().createElement(y.Upload,{action:"none",multiple:!0,showUploadList:!1,uploadTrigger:"custom",onFileChange:e=>{this.onFileUpload(e)},accept:".svg,.png,.jpg,.json,.css,.js,.md,.webp,.zip,.gif"},"上传文件")))},v().createElement(y.Button,{size:"small",theme:"borderless",type:"tertiary",icon:v().createElement("i",{class:"bi bi-plus-lg",style:{color:"var(--semi-color-text-0)"}})}))})),this.ref=v().createRef(),this.state={treeData:[],selectedNodeKey:null,dialgeCreateFileType:"",dialogCreateShow:!1,dialogCreateTitle:"",dialogRenameShow:!1,valueRename:"",appJSONObject:null,packageEditDialogVisible:!1,packageSearchDialogVisible:!1,publishing:!1},Rt.services.appFileListPanel=this}componentDidMount(){this.loadAndUpdateFileTree()}async loadAndUpdateFileTree(){const{appService:e}=Rt.services;await e.init(),await e.updateAppFileTree();const t=await e.getAppFileTree(),n=await e.getPackageJSONObject();this.rebuildTreeIcons(t),this.setState({appJSONObject:n,treeData:t})}rebuildTreeIcons(e){this.nodeMap={},qe(e,(e=>{this.nodeMap[e.id]=e,e.mimeType&&("application/font-woff"===e.mimeType?e.icon=v().createElement("i",{class:"bi bi-fonts"}):e.mimeType.indexOf("audio")>-1?e.icon=v().createElement("i",{class:"bi bi-file-earmark-music"}):e.mimeType.indexOf("image")>-1?e.icon=ii:e.icon=v().createElement("i",{class:"bi bi-file-earmark"})),e.label.endsWith(".svg")&&(e.icon=ii),e.label.endsWith(".md")&&(e.icon=ti),e.label.endsWith(".js")&&(e.icon=oi),e.label.endsWith(".json")&&(e.icon=si),"page"===e.type&&(e.icon=ri),"directory"===e.type&&(e.icon=ni)}))}getCurrentSiblingNames(){const{selectedNodeKey:e,treeData:t}=this.state;let n=[];if(e){const i=this.nodeMap[e];n=-1===i.parent?t:i.parentNode.children}else n=t;return n.map((e=>e.label))}getCurrentPath(){const{selectedNodeKey:e}=this.state;if(e){const t=this.nodeMap[e];return"directory"===t.type?t.path:t.parentNode?t.parentNode.path:"/"}return"/"}getCurrentParentId(){const{selectedNodeKey:e}=this.state;if(e){const t=this.nodeMap[e];return"directory"===t.type?t.key:t.parent}return-1}async exportApp(){if(this.state.exportToastId)return;const e=y.Toast.info({content:"正在导出应用，请稍侯...",duration:0,onClose:()=>{this.setState({exportToastId:null})}});this.setState({exportToastId:e});const{appService:t}=Rt.services;await t.exportAppArchive(),y.Toast.close(e),this.setState({exportToastId:null})}render(){const{renderFullLabel:e,state:t,RenderCreateDropDown:n,RenderAppDropDown:i}=this,{treeData:o,dialogCreateShow:s,dialogCreateTitle:r,dialogRenameShow:a,valueRename:l}=t;return v().createElement(v().Fragment,null,v().createElement("div",{className:"file-actions panel-actions"},v().createElement(n,null),v().createElement(i,null)),v().createElement(Zn,{show:s,title:r,parentPaths:this.getCurrentPath(),siblingNames:this.getCurrentSiblingNames(),confirm:e=>{this.onCreateConfirm(e)},cancel:()=>{this.setState({dialogCreateShow:!1})}}),v().createElement(Xn,{show:a,value:l,siblingNames:this.getCurrentSiblingNames(),change:e=>{this.setState({valueRename:e})},confirm:()=>{this.onRenameConfirm()},cancel:()=>{this.setState({dialogRenameShow:!1})}}),o&&v().createElement(y.Tree,{className:"file-tree",showFilteredOnly:!0,filterTreeNode:!0,draggable:!0,renderLabel:e,treeData:o,onDragStart:e=>{e.node&&"page"===e.node.type?Rt.draggingComposite=e.node:Rt.draggingComposite=null},onDrop:e=>{let{node:t,dragNode:n,dropPosition:i,dropToGap:o}=e;this.move(t,n,o)},onDoubleClick:(e,t)=>{this.onOpenClicked(t)},onChange:e=>{this.setState({selectedNodeKey:e})}}),!o&&v().createElement("div",{className:"tree-loading"},v().createElement(y.Spin,{size:"middle"})))}}const hi=pi;var mi=n(7262),gi={};function ui(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}gi.styleTagTransform=g(),gi.setAttributes=d(),gi.insert=l().bind(null,"head"),gi.domAPI=r(),gi.insertStyleElement=h(),o()(mi.A,gi),mi.A&&mi.A.locals&&mi.A.locals;const{Text:fi}=y.Typography,bi=k()("ridge:outline");class vi extends v().Component{constructor(){super(),ui(this,"toggleLock",(e=>{const t=Rt.getNode(e.element);t.setLocked(!t.config.locked),Rt.workspaceControl.selectElements([t.el])})),ui(this,"toggleVisible",(e=>{const t=Rt.getNode(e.element);t.setVisible(!t.config.visible),this.updateOutline()})),ui(this,"renderFullLabel",((e,t)=>{const{toggleLock:n,toggleVisible:i}=this;let{visible:o,locked:s}=t.element.config;const{slotLabel:r}=t;return!1!==o&&(o=!0),!0!==s&&(s=!1),v().createElement("div",{className:"tree-label "+(o?"is-visible":"is-hidden")+" "+(s?"is-locked":"")},v().createElement(y.Space,{className:"label-content"},v().createElement(fi,{className:"label-text"},e??t.key),t.tags&&t.tags.map((e=>v().createElement(y.Tag,{size:"small",color:"amber",key:e}," ",e," ")))),!r&&v().createElement(y.Space,{spacing:2},v().createElement(y.Button,{className:s?"":"hover-show",size:"small",theme:"borderless",type:"tertiary",onClick:()=>{n(t)},icon:s?v().createElement("i",{class:"bi bi-lock-fill"}):v().createElement("i",{class:"bi bi-unlock-fill"})}),v().createElement(y.Button,{className:o?"hover-show":"",size:"small",theme:"borderless",type:"tertiary",onClick:()=>{i(t)},icon:o?v().createElement("i",{class:"bi bi-eye-fill"}):v().createElement("i",{class:"bi bi-eye-slash-fill"})})),r&&v().createElement(y.Tag,null,r))})),ui(this,"onNodeDblClick",(e=>{if(console.log("onNodeDblClick",e),"ridge-container/composite"===e.element?.config?.path){const t=e.element?.config?.props?.pagePath;if(t){const e=Rt.services.appService.getFileByPath(t);e&&e.id&&Rt.openFile(e.id)}}})),this.state={componentTreeData:[],expandedKeys:[],selected:null},Rt.services.outlinePanel=this}updateOutline(e){if(e&&this.setState({expandedKeys:[],selected:null}),Rt.editorComposite){const e=Rt.editorComposite.getCompositeElementTree();bi("updateOutline",e),this.setState({componentTreeData:e})}}setCurrentNode(e){if(e){let t=this.findNode(this.state.componentTreeData,e.getId());const n=[];for(;t;)n.push(t.key),t=t.parentKey?this.findNode(this.state.componentTreeData,t.parentKey):null;this.setState({selected:e.getId(),expandedKeys:Array.from(new Set([...n,...this.state.expandedKeys]))})}else this.setState({selected:null})}findNode(e,t){for(const n of e){if(n.key===t)return n;if(n.children){const e=this.findNode(n.children,t);if(e)return e}}}onNodeSelected(e,t){const n=Rt.getNode(e);n&&(n.el&&n.config.visible&&!n.config.locked?(n.selected(),Rt.workspaceControl.selectElements([n.el],!0)):(Rt.workspaceControl.selectElements([]),Rt.onElementSelected(n))),this.setState({selected:e})}ordering(e,t,n,i){const o=[];for(let s=0;s<e.length;s++)e[s].key===n.key?-1===i?(o.push(t.key),o.push(n.key)):1===i&&(o.push(n.key),o.push(t.key)):e[s].key!==t.key&&o.push(e[s].key);return o}onTreeDrop(e){let{event:t,node:n,dragNode:i,dragNodesKeys:o,dropPosition:s,dropToGap:r}=e;n.parentKey&&(n.parent=this.findNode(this.state.componentTreeData,n.parentKey)),i.parentKey&&(i.parent=this.findNode(this.state.componentTreeData,i.parentKey));const a=n.pos.split("-"),l=s-Number(a[a.length-1]),c=n.parent?n.parent.element:Rt.editorComposite,d=i.parent?i.parent.element:Rt.editorComposite;if(!0===r){const e=n.parent?n.parent.children:this.state.componentTreeData,t=this.ordering(e,i,n,l);c!==d&&d.removeChild(i.element),t.length!==e.length&&c.appendChild(i.element),c.updateChildList(t)}else{if(null==n.element.children)return void y.Toast.warning({content:"目标节点无法再放入子节点",duration:3});d.removeChild(i.element),n.element.appendChild(i.element)}this.updateOutline(),Rt.workspaceControl.selectElements([i.element.el],!0)}render(){const{selected:e,componentTreeData:t,expandedKeys:n}=this.state,{renderFullLabel:i,onTreeDrop:o,onNodeDblClick:s}=this;return v().createElement(y.Tree,{className:"outline-tree",autoExpandWhenDragEnter:!0,showFilteredOnly:!0,filterTreeNode:!0,draggable:!0,renderLabel:i,onDrop:o.bind(this),onChange:(e,t)=>{this.onNodeSelected(e,t)},onDoubleClick:(e,t)=>{s(t)},onExpand:e=>{this.setState({expandedKeys:e})},expandedKeys:n,value:e,treeData:t})}}ui(vi,"contextType",Nn);const wi=vi,yi={languageOptions:{globals:{},parserOptions:{ecmaVersion:2022,sourceType:"module"}},rules:{semi:["error","never"]}},xi=(0,b.forwardRef)(((e,t)=>{const i=(0,b.useRef)(null),[o,s]=(0,b.useState)([]),[r,a]=(0,b.useState)(""),[l,c]=(0,b.useState)(!0),[d,p]=(0,b.useState)(!1),[h,m]=(0,b.useState)({}),[g,u]=(0,b.useState)({}),f=async e=>{const t=i.current;if(!t)return;t.editorComposite&&t.editorComposite.destroy();const o=e.mimeType,s=h[e.id]||e.textContent,{EditorView:r,basicSetup:a}=await Promise.all([n.e(587),n.e(213),n.e(927),n.e(85)]).then(n.bind(n,136)),{tooltips:l,keymap:c}=await Promise.all([n.e(587),n.e(213),n.e(927),n.e(85)]).then(n.bind(n,3173)),{indentWithTab:d}=await Promise.all([n.e(587),n.e(213),n.e(927),n.e(85)]).then(n.bind(n,7143)),p=[a,c.of([{key:"Mod-s",run:()=>w(e),preventDefault:!0},d]),l({position:"absolute"})];if("css"===o){const{css:e}=await Promise.all([n.e(587),n.e(643),n.e(295)]).then(n.bind(n,4448));p.push(e())}if("text/javascript"===o){const{Linter:e}=await n.e(308).then(n.bind(n,4603)),{javascript:t,esLint:i}=await Promise.all([n.e(587),n.e(213),n.e(643),n.e(0),n.e(927)]).then(n.bind(n,2e3)),{linter:o,lintGutter:s}=await Promise.all([n.e(587),n.e(213),n.e(643),n.e(0),n.e(927)]).then(n.bind(n,5982));p.push(t()),p.push(s()),p.push(o(i(new e,yi)))}if("text/json"===o){const{json:e}=await Promise.all([n.e(587),n.e(213),n.e(643),n.e(0),n.e(295),n.e(472)]).then(n.bind(n,6367));p.push(e())}if("text/markdown"===o){const{markdown:e}=await Promise.all([n.e(587),n.e(213),n.e(643),n.e(0),n.e(295),n.e(472)]).then(n.bind(n,3034));p.push(e())}p.push(r.updateListener.of((t=>{t.docChanged&&u(Object.assign({},g,{[e.id]:!0}))}))),t.editorComposite=new r({doc:s,extensions:p,parent:t}),t.fileid=e.id},w=async e=>{const t=e.id,n=i.current.editorComposite.state.doc.toString();await Rt.onCodeEditComplete(t,n)?(m(Object.assign({},h,{[t]:null})),u(Object.assign({},g,{[t]:null})),y.Toast.success("保存成功")):y.Toast.error("保存失败，请检查保存内容格式是否正确、文件是否已经被删除")},x=async e=>{o.find((t=>t.id===e.id))||s([...o,{id:e.id,name:e.name,file:e}]),C(),d?(await f(e),c(!1)):p(!0),a(e.id)},C=()=>{if(r&&i.current&&i.current.editorComposite){const e=i.current.editorComposite.state.doc.toString();e&&m(Object.assign({},h,{[r]:e}))}};(0,b.useImperativeHandle)(t,(()=>({openFile:x})));const E=e=>{const t=o.filter((t=>t.id!==e));if(s(t),m(Object.assign({},h,{[e]:null})),u(Object.assign({},g,{[e]:null})),e===r)if(0===t.length)i.current.editorComposite.destroy();else{const e=t[t.length-1];a(e.id),f(e.file)}},k=e=>{C(),a(e),f(o.find((t=>t.id===e)).file)},S=e=>g[e.id]?e.name+"!":e.name,P=o.length>0;return v().createElement(y.SideSheet,{className:"code-edit-sheet",keepDOM:!0,width:1200,closeOnEsc:!1,size:"large",mask:!1,maskClosable:!1,title:"页面脚本编辑器",visible:d,footer:v().createElement("div",null),bodyStyle:{zIndex:1001,overflow:"hidden"},afterVisibleChange:async()=>{if(d){const e=o.find((e=>e.id===r));e&&(await f(e.file),c(!1))}},onOk:()=>{const e=i.current.editorComposite.state.doc.toString();k(e)},onCancel:()=>{p(!1)}},P&&v().createElement(y.Spin,{tip:"正在下载代码编辑模块, 请稍候..",spinning:l,style:{height:"100%",width:"100%"}},v().createElement(y.Tabs,{type:"card",collapsible:!0,activeKey:r,onTabClose:e=>{g[e]?y.Modal.confirm({title:"Are you sure ?",content:"bla bla bla...",onOk:()=>{E(e)}}):E(e)},onChange:k},o.map((e=>v().createElement(y.TabPane,{closable:!0,tab:S(e),itemKey:e.id,key:e.id})))),v().createElement("div",{className:"code-editor-container",ref:i})),!P&&v().createElement("div",{className:"no-open-script-file"},"暂无打开的脚本文件"))}));var Ci;function Ei(){return Ei=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ei.apply(null,arguments)}const ki=e=>b.createElement("svg",Ei({xmlns:"http://www.w3.org/2000/svg",width:128,height:128,viewBox:"0 0 24 24"},e),Ci||(Ci=b.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v8.5M15 7l-3-3-3 3m-4 5v5a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-5"})));var Si=n(8368),Pi={};function Ni(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Pi.styleTagTransform=g(),Pi.setAttributes=d(),Pi.insert=l().bind(null,"head"),Pi.domAPI=r(),Pi.insertStyleElement=h(),o()(Si.A,Pi),Si.A&&Si.A.locals&&Si.A.locals;const Ti=[{label:"默认",value:"@douyinfe/semi-ui/dist/css/semi.min.css"},{label:"抖音",value:"@semi-bot/semi-theme-doucreator/semi.min.css"},{label:"飞书",value:"@semi-bot/semi-theme-universedesign/semi.min.css"},{label:"Strapi",value:"@semi-bot/semi-theme-strapi/semi.min.css"},{label:"深蓝",value:"@semi-bot/semi-theme-ultim-dark-blue/semi.min.css"},{label:"剪映",value:"@semi-bot/semi-theme-jianying/semi.min.css"}];class Oi extends v().Component{constructor(){super(),Ni(this,"zoomChange",(e=>{Rt.workspaceControl.setZoom(e/100),this.setState({zoom:e})})),Ni(this,"toggleContainerMask",(()=>{const e=!this.state.treeLocked;Rt.workspaceControl.setDragActive(!e),this.setState({treeLocked:e})})),Ni(this,"toggoleRunMode",(()=>{Rt.toggleMode()})),Ni(this,"switchToPage",(e=>{this.state.currentPageId!==e&&Rt.checkModification().then((()=>{Rt.closeCurrentPage(!0),Rt.loadPageInWorkspace(e)}))})),Ni(this,"savePage",(()=>{Rt.saveCurrentPage()})),Ni(this,"closeCurrentPage",(()=>{Rt.closeCurrentPage();const e=this.state.openedPageList.filter((e=>e.value!==this.state.currentPageId));e.length>0?Rt.loadPageInWorkspace(e[e.length-1].value):this.setState({currentPageId:null,currentPageName:""}),this.setState({openedPageList:e})})),Ni(this,"renderPageList",(()=>{const{closeCurrentPage:e,switchToPage:t}=this,{openedPageList:n,currentPageName:i}=this.state;return v().createElement(y.ButtonGroup,{type:"tertiary",theme:"borderless"},v().createElement(y.Dropdown,{render:v().createElement(y.Dropdown.Menu,null,n.map((e=>v().createElement(y.Dropdown.Item,{onClick:()=>{t(e.value)},key:e.value},e.label))))},v().createElement(y.Button,{type:"tertiary",theme:"borderless"},i)),v().createElement(y.Button,{icon:v().createElement("i",{className:"bi bi-x-lg"}),onClick:()=>{this.state.pageChanged?y.Modal.confirm({zIndex:10001,title:"注意",content:"页面未保存，是否继续关闭",onOk:async()=>{e()}}):e()}}))})),Ni(this,"onTabClose",(e=>{const{closeCurrentPage:t}=this;this.state.openedPageList.find((t=>t.value===e)).modified?y.Modal.confirm({zIndex:10001,title:"注意",content:"页面未保存，是否继续关闭",onOk:async()=>{t()}}):t()})),Rt.services.menuBar=this,this.state={pageChanged:!1,theme:Rt.theme,currentPageName:"",showContainer:!0,currentPageId:null,openedPageList:[],isLight:Rt.isLight,zoom:100,treeLocked:!1,containerMask:!0}}setOpenPage(e,t){this.setState({currentPageName:t,currentPageId:e}),0===this.state.openedPageList.filter((t=>t.value===e)).length&&this.setState({openedPageList:[...this.state.openedPageList,{modified:!1,value:e,label:t}]})}setPageChanged(e){const{openedPageList:t}=this.state;this.setState({openedPageList:t.map((t=>(t.value===this.state.currentPageId&&(t.modified=e),t)))})}setZoom(e){this.setState({zoom:Math.floor(100*e)})}render(){const{zoomChange:e,savePage:t,state:n,props:i,switchToPage:o,onTabClose:s}=this,{zoom:r,pageChanged:a,isLight:l,currentPageName:c,currentPageId:d,showContainer:p,openedPageList:h}=n;return v().createElement("div",{className:"menu-bar"},v().createElement(y.Tabs,{className:"page-tabs",type:"card",activeKey:d,onTabClose:s,onTabClick:o},h.map((e=>v().createElement(y.TabPane,{icon:e.modified?v().createElement("i",{class:"bi bi-circle-fill"}):null,closable:!0,tab:e.label,itemKey:e.value,key:e.value})))),v().createElement(y.Space,{className:"bar-content"},v().createElement(y.Badge,{dot:a,type:"danger"},v().createElement(y.Button,{disabled:!c,type:"tertiary",icon:v().createElement("i",{className:"bi bi-floppy"}),theme:"borderless",onClick:t})),v().createElement(y.Tooltip,{content:"预览页面"},v().createElement(y.Button,{disabled:!c,type:"tertiary",theme:"borderless",icon:v().createElement("i",{className:"bi bi-play-fill"}),onClick:()=>{Rt.toggleMode()}},"预览")),v().createElement(y.InputNumber,{disabled:!c,style:{width:"96px",background:"transparent"},value:r,suffix:"%",onChange:t=>{e(t)}}),v().createElement(y.Divider,{layout:"vertical"}),v().createElement(y.Tooltip,{content:"夜间/日间模式"},v().createElement(y.Button,{type:"tertiary",theme:"borderless",icon:l?v().createElement("i",{className:"bi bi-moon-stars-fill"}):v().createElement("i",{className:"bi bi-sun"}),onClick:()=>{this.setState({isLight:!l}),Rt.setLight(!l)}})),v().createElement(y.Tooltip,{content:"切换显示容器轮廓"},v().createElement(y.Button,{type:p?"primary":"tertiary",theme:p?"solid":"borderless",icon:v().createElement("i",{className:"bi bi-intersect"}),onClick:()=>{this.setState({showContainer:!p}),Rt.setShowContainer(!p)}})),v().createElement(y.Dropdown,{trigger:"click",position:"top",render:v().createElement(y.Dropdown.Menu,null,Ti.map((e=>v().createElement(y.Dropdown.Item,{key:e.value,onClick:()=>{Rt.setTheme(e.value)}},e.label))))},v().createElement(y.Button,{icon:v().createElement("i",{className:"bi bi-palette2"}),theme:"borderless",size:"small",type:"tertiary"})),v().createElement(y.Divider,{layout:"vertical"}),v().createElement(Te,{app:"ridge-editor-app",path:"/user/UserPanel"}),v().createElement(y.Popover,{trigger:"click",position:"topRight",showArrow:!0,content:v().createElement(Te,{app:"ridge-editor-app",path:"/AppShare"})},v().createElement(y.Button,{icon:v().createElement(ki,null)},"导出"))))}}const ji=Oi;var Li;function Fi(){return Fi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Fi.apply(null,arguments)}const Ai=e=>b.createElement("svg",Fi({xmlns:"http://www.w3.org/2000/svg",width:128,height:128,viewBox:"0 0 14 14"},e),Li||(Li=b.createElement("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},b.createElement("path",{d:"M9 2.5H3a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1M4 5h4M4 7.5h4M4 10h2"}),b.createElement("path",{d:"M4.5.5H11a1 1 0 0 1 1 1V11"}))));var zi;function Di(){return Di=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Di.apply(null,arguments)}const Mi=e=>b.createElement("svg",Di({xmlns:"http://www.w3.org/2000/svg",width:128,height:128,viewBox:"0 0 28 28"},e),zi||(zi=b.createElement("path",{fill:"currentColor",d:"M21 2a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0V8h-3a1 1 0 1 1 0-2h3V3a1 1 0 0 1 1-1M6 3a3 3 0 0 0-3 3v16a3 3 0 0 0 3 3h16a3 3 0 0 0 3-3v-6a3 3 0 0 0-3-3h-7V6a3 3 0 0 0-3-3zm7 10H5V6a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm2 10v-8h7a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1zm-2 0H6a1 1 0 0 1-1-1v-7h8z"})));var Ri;function Ii(){return Ii=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ii.apply(null,arguments)}const Bi=e=>b.createElement("svg",Ii({xmlns:"http://www.w3.org/2000/svg",width:128,height:128,viewBox:"0 0 512 512"},e),Ri||(Ri=b.createElement("path",{fill:"currentColor",d:"M208 80h264v32H208zM40 96a64 64 0 1 0 64-64 64.07 64.07 0 0 0-64 64m64-32a32 32 0 1 1-32 32 32.036 32.036 0 0 1 32-32m104 176h264v32H208zm-104 80a64 64 0 1 0-64-64 64.07 64.07 0 0 0 64 64m0-96a32 32 0 1 1-32 32 32.036 32.036 0 0 1 32-32m104 176h264v32H208zm-104 80a64 64 0 1 0-64-64 64.07 64.07 0 0 0 64 64m0-96a32 32 0 1 1-32 32 32.036 32.036 0 0 1 32-32"})));var Ui;function _i(){return _i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_i.apply(null,arguments)}const Wi=e=>b.createElement("svg",_i({xmlns:"http://www.w3.org/2000/svg",width:128,height:128,viewBox:"0 0 32 32"},e),Ui||(Ui=b.createElement("path",{fill:"currentColor",d:"M28 4H4c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2M10 26H4V6h6zm18-11H17.8l3.6-3.6L20 10l-6 6 6 6 1.4-1.4-3.6-3.6H28v9H12V6h16z"})));var Vi=n(5988),Ji={};function $i(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ji.styleTagTransform=g(),Ji.setAttributes=d(),Ji.insert=l().bind(null,"head"),Ji.domAPI=r(),Ji.insertStyleElement=h(),o()(Vi.A,Ji),Vi.A&&Vi.A.locals&&Vi.A.locals;class qi extends v().Component{constructor(){super(),$i(this,"toggoleRunMode",(()=>{Rt.toggleMode()})),$i(this,"changeViewPort",((e,t)=>{this.setState({width:e,height:t}),Rt.updatePreviewSize(e,t)})),Rt.services.previewBar=this,this.state={width:0,height:0}}render(){const{toggoleRunMode:e}=this;return v().createElement("div",{className:"menu-bar"},v().createElement(y.Button,{type:"primary",onClick:e},"返回"))}}const Hi=qi;globalThis.msgerror=e=>{y.Toast.error(e)},globalThis.success=y.Toast.success;class Ki extends v().Component{constructor(e){super(e),this.workspaceRef=v().createRef(),this.viewPortContainerRef=v().createRef(),this.codeEditorRef=v().createRef(),this.state={pageOpened:!1,collapseLeft:!1,leftResizing:!1,isPreview:!1,leftReisizeWidth:300,editPreview:!1,imagePreviewSrc:null,imagePreviewVisible:!1,codeEditTitle:"",codeEditText:"",codeEditVisible:!1,codeEditType:""}}componentDidMount(){Rt.editorDidMount(this,this.workspaceRef.current,this.viewPortContainerRef.current)}handleLeftResize(){document.addEventListener("mousemove",(e=>{this.state.leftResizing&&e.clientX>250&&this.setState({leftReisizeWidth:e.clientX})})),document.addEventListener("mouseup",(e=>{this.setState({leftResizing:!1})}))}setPageOpened(e){this.setState({pageOpened:e})}toggleLeftCollapse(){this.setState({collapseLeft:!this.state.collapseLeft})}setPreview(e){this.setState({isPreview:e})}async confirm(e){return new Promise(((t,n)=>{y.Modal.confirm({zIndex:10001,title:"确认",content:e,onOk:async()=>{t()},onCancel:()=>{n(new Error)}})}))}async message(e){y.Modal.message(e)}setEditorLoaded(){this.setState({editorLoading:!1},(()=>{this.handleLeftResize()}))}openInCodeEditor(e){this.currentEditFile=e,this.codeEditorRef.current?.openFile(e)}completeCodeEdit(e){Rt.onCodeEditComplete(this.currentEditFile.id,e)}openImage(e){this.setState({imagePreviewSrc:e,imagePreviewVisible:!0})}render(){const{state:e,workspaceRef:t,codeEditorRef:n,viewPortContainerRef:i}=this,{isPreview:o,collapseLeft:s,pageOpened:r,imagePreviewVisible:a,leftReisizeWidth:l,imagePreviewSrc:c,codeEditTitle:d}=e;return v().createElement(v().Fragment,null,v().createElement("div",{className:"editor-root",style:{display:o?"none":""}},v().createElement(y.Tabs,{className:"root-nav",style:{width:s?"58px":l+"px"},onTabClick:(e,t)=>{this.setState({collapseLeft:!1})},tabPosition:"left",type:"button",tabBarExtraContent:v().createElement(v().Fragment,null,v().createElement(y.Button,{icon:v().createElement(Wi,null),onClick:()=>{this.setState({collapseLeft:!s})}}))},v().createElement(y.TabPane,{tab:v().createElement(y.Icon,{size:"default",svg:v().createElement(Ai,null)}),itemKey:"components"},v().createElement(hi,null)),v().createElement(y.TabPane,{tab:v().createElement(y.Icon,{svg:v().createElement(Mi,null)}),itemKey:"app"},v().createElement(Kn,null)),v().createElement(y.TabPane,{tab:v().createElement(y.Icon,{svg:v().createElement(Bi,null)}),itemKey:"outline"},v().createElement(wi,null))),!s&&v().createElement("div",{className:"left-resizer",onMouseDown:e=>{e.preventDefault(),this.setState({leftResizing:!0})}}),v().createElement("div",{className:"editor-content"},v().createElement(ji,null),v().createElement("div",{className:"workspace-panel"},v().createElement("div",{ref:t,className:"workspace"},v().createElement("div",{className:"view-port",ref:i}),!r&&v().createElement("div",{className:"no-open-file"},v().createElement(Te,{app:"ridge-editor-app",path:"Welcome"}))),r&&v().createElement(Dn,null))),v().createElement("div",null)),v().createElement("div",{className:"preview-root",style:{display:o?"":"none"}},v().createElement(Hi,null),v().createElement("div",{className:"preview-container"},v().createElement("div",{className:"preview-view-port"}))),v().createElement(y.ImagePreview,{src:c,visible:a,onVisibleChange:()=>{this.setState({imagePreviewVisible:!1})}}),v().createElement(xi,{ref:n,title:d,onClose:()=>{this.setState({codeEditVisible:!1})}}))}}const Xi=Ki,Zi=document.getElementById("root");Zi&&(0,w.H)(Zi).render(v().createElement(Xi,null))},8368:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,".menu-bar {\n  height: 44px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 8px;\n  border-bottom: 1px solid var(--semi-color-border);\n}\n.menu-bar .page-tabs {\n  flex: 1;\n}\n.menu-bar .page-tabs > .semi-tabs-bar {\n  padding: 5px 0 0 5px;\n}\n.menu-bar .page-tabs > .semi-tabs-content {\n  padding: 0;\n}\n.menu-bar .page-tabs .semi-tabs-bar-icon {\n  font-size: 10px;\n  margin-right: 5px;\n  color: var(--semi-color-danger);\n}\n.menu-bar .page-tabs > .semi-tabs-bar-card.semi-tabs-bar-top::before {\n  border-bottom: none;\n}\n.menu-bar .page-tabs .semi-tabs-tab-single.semi-tabs-tab .semi-icon:not(.semi-icon-checkbox_tick,.semi-icon-radio,.semi-icon-checkbox_indeterminate) {\n  top: 0;\n}\n.menu-bar .semi-button svg {\n  width: 18px;\n  height: 18px;\n}\n.menu-bar .bar-content {\n  background: var(--semi-color-bg-0);\n  padding: 3px;\n  z-index: 101;\n}\n.menu-bar .bar-content .bi {\n  font-size: 16px;\n}\n.menu-bar .semi-slider-handle {\n  width: 16px;\n  height: 16px;\n  margin-top: 8px;\n}\n.preview-menu-bar {\n  position: absolute;\n  right: 5px;\n  top: 5px;\n}\n",""]);const a=r},9097:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(1601),o=n.n(i),s=n(6314),r=n.n(s)()(o());r.push([e.id,".component-panel {\n  height: 100%;\n}\n.component-panel .semi-tabs-tab-active .package-icon {\n  color: var(--semi-color-secondary);\n}\n.component-panel .semi-tabs {\n  height: 100%;\n}\n.component-panel .semi-tabs > .semi-tabs-bar {\n  border-bottom: 1px solid var(--semi-color-border);\n  padding: 4px;\n}\n.component-panel .semi-tabs > .semi-tabs-bar .semi-tabs-tab {\n  padding: 4px;\n  margin-right: 4px!important;\n}\n.component-panel .semi-tabs > .semi-tabs-content {\n  overflow-y: auto;\n  height: calc(100% - 50px);\n}\n.component-panel .semi-spin-block.semi-spin {\n  min-height: 320px;\n}\n.component-panel .semi-tabs-bar-extra {\n  padding: 0;\n}\n.component-panel .package-icon {\n  width: 26px;\n  height: 26px;\n  font-size: 26px;\n  text-align: center;\n}\n.component-panel .package-icon img {\n  object-fit: contain;\n  width: 26px;\n  height: 26px;\n}\n.component-panel .package-icon svg {\n  width: 100%;\n  height: 100%;\n}\n.component-panel .package-icon i.bi {\n  font-size: 20px;\n}\n.component-panel .semi-tabs-content-left {\n  overflow: hidden auto;\n}\n.component-panel .semi-tabs-bar-left .semi-tabs-tab {\n  padding: 2px;\n}\n.component-panel .component-container {\n  margin: 5px 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  width: 100%;\n  border-radius: 8px;\n  height: 70px;\n  background-color: var(--semi-color-tertiary-light-default);\n  cursor: pointer;\n}\n.component-panel .component-container:hover {\n  background-color: var(--semi-color-primary-light-default);\n}\n.component-panel .component-container i.font-icon {\n  font-size: 2em;\n  margin-bottom: 5px;\n}\n.component-panel .component-container .image-icon {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  flex: 1;\n  color: var(--semi-color-secondary);\n}\n.component-panel .component-container .image-icon img.img-only {\n  width: 44px;\n  height: auto;\n  margin-bottom: 0;\n}\n.component-panel .component-container .image-icon svg {\n  width: 100%;\n  height: 100%;\n}\n.component-panel .component-container .image-icon img {\n  max-width: 60px;\n  max-height: 32px;\n  margin-bottom: 5px;\n}\n.component-panel .component-container .component-icon {\n  width: 36px;\n  height: 36px;\n  -webkit-mask-size: 36px auto;\n  background: linear-gradient(145deg, #8cb8ff, #1c85ff);\n  background-size: cover;\n  background-repeat: no-repeat;\n}\n.component-panel .component-container .font-icon {\n  font-size: 28px;\n  padding-top: 6px;\n  height: 40px;\n  text-align: center;\n  color: var(--semi-color-secondary);\n}\n.component-add-panel .package-tab {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  box-sizing: border-box;\n  padding: 0 2px;\n}\n.component-add-panel .semi-tabs-bar-button .semi-tabs-tab {\n  padding: 8px 3px;\n}\n.component-add-panel .package-tab img {\n  width: 24px;\n  height: 24px;\n}\n",""]);const a=r}}]);