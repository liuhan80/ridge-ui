(()=>{"use strict";const t=({pixels:t=64e3,distance:e=.22,colorValidator:s=((t,e,s,n)=>(n??255)>250),hueDistance:n=.08333333333333333,saturationDistance:i=.2,lightnessDistance:r=.2,crossOrigin:o="",requestMode:h="cors"}={})=>[Math.max(t,1),Math.min(Math.max(e,0),1),s,Math.min(Math.max(n,0),1),Math.min(Math.max(i,0),1),Math.min(Math.max(r,0),1),o,h];class e{constructor(t,e,s,n=t<<16|e<<8|s){this._count=1,this.__saturation=-1,this.__hue=-1,this.__lightness=-1,this.__intensity=-1,this._red=t,this._green=e,this._blue=s,this._hex=n}static distance(t,e){return(Math.abs(e._red-t._red)+Math.abs(e._green-t._green)+Math.abs(e._blue-t._blue))/765}clone(){const t=new e(this._red,this._green,this._blue,this._hex);return t._count=this._count,t}updateHSL(){const t=this._red/255,e=this._green/255,s=this._blue/255,n=Math.max(t,e,s),i=Math.min(t,e,s);if(this.__lightness=(n+i)/2,n===i)this.__hue=0,this.__saturation=0,this.__intensity=0;else{const r=n-i;switch(this.__saturation=this.__lightness>.5?r/(2-n-i):r/(n+i),this.__intensity=this.__saturation*(2*(.5-Math.abs(.5-this.__lightness))),n){case t:this.__hue=((e-s)/r+(e<s?6:0))/6;break;case e:this.__hue=((s-t)/r+2)/6;break;case s:this.__hue=((t-e)/r+4)/6}}}get _hue(){return-1===this.__hue&&this.updateHSL(),this.__hue}get _saturation(){return-1===this.__saturation&&this.updateHSL(),this.__saturation}get _lightness(){return-1===this.__lightness&&this.updateHSL(),this.__lightness}get _intensity(){return-1===this.__intensity&&this.updateHSL(),this.__intensity}}class s{constructor(){this._count=0,this._children={}}addColor(t,s,n,i){return this._count++,this._children[t]?this._children[t]._count++:this._children[t]=new e(s,n,i,t),this._children[t]}getList(){return Object.keys(this._children).map((t=>this._children[t]))}createMainColor(){const t=this.getList().reduce(((t,e)=>t._count>=e._count?t:e)).clone();return t._count=this._count,t}}class n{constructor(){this._count=0,this._children={}}getList(){return Object.keys(this._children).map((t=>this._children[t]))}addColor(t,e,s){const n=t<<16|e<<8|s,i=(t>>4&15)<<8|(e>>4&15)<<4|s>>4&15;return this._count++,this.getLeafGroup(i).addColor(n,t,e,s)}getLeafGroup(t){return this._children[t]||(this._children[t]=new s),this._children[t]}getColors(t){const s=this.getList().map((t=>t.createMainColor()));s.sort(((t,e)=>e._count-t._count));const n=[];for(;s.length;){const i=s.shift();s.filter((s=>e.distance(i,s)<t)).forEach((t=>{i._count+=t._count;const e=s.findIndex((e=>e===t));s.splice(e,1)})),n.push(i)}return n}}const i=({data:t,width:e,height:s},i,r,o)=>{const h=new n,a=e&&s&&Math.floor(e*s/i)||1;let c=0;for(let e=0;e<t.length;e+=4*a){const s=t[e],n=t[e+1],i=t[e+2];o(s,n,i,t[e+3])?h.addColor(s,n,i):c++}return{colors:h.getColors(r),count:h._count+c}},r=(t,e)=>Math.abs(t-e);class o{constructor(){this.colors=[],this._average=null}addColor(t){this.colors.push(t),this._average=null}isSamePalette(t,e,s,n){for(const h of this.colors)if(i=h._hue,o=t._hue,!(Math.min(r(i,o),r((i+.5)%1,(o+.5)%1))<e&&r(h._saturation,t._saturation)<s&&r(h._lightness,t._lightness)<n))return!1;var i,o;return!0}get average(){if(!this._average){const{r:t,g:s,b:n}=this.colors.reduce(((t,e)=>(t.r+=e._red,t.g+=e._green,t.b+=e._blue,t)),{r:0,g:0,b:0}),i=this.colors.reduce(((t,e)=>t+e._count),0);this._average=new e(Math.round(t/this.colors.length),Math.round(s/this.colors.length),Math.round(n/this.colors.length)),this._average._count=i}return this._average}}class h{constructor(t,e,s){this._groups=[],this._hue=t,this._saturation=e,this._lightness=s}addColor(t){const e=this._groups.find((e=>e.isSamePalette(t,this._hue,this._saturation,this._lightness)));if(e)e.addColor(t);else{const e=new o;e.addColor(t),this._groups.push(e)}}getGroups(){return this._groups.map((t=>t.average))}}const a=()=>"object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,c=()=>"undefined"==typeof window&&"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,u=(t,e,s,n,i)=>{const r=((t,e,s,n,i)=>{const r=new h(s,n,i);t.forEach((t=>r.addColor(t)));const o=r.getGroups();return o.sort(((t,s)=>(s._intensity+.1)*(.9-s._count/e)-(t._intensity+.1)*(.9-t._count/e))),o})(t,e,s,n,i);return r.map((t=>((t,e)=>({hex:`#${"0".repeat(6-t._hex.toString(16).length)}${t._hex.toString(16)}`,red:t._red,green:t._green,blue:t._blue,area:t._count/e,hue:t._hue,saturation:t._saturation,lightness:t._lightness,intensity:t._intensity}))(t,e)))},_=(t,e)=>{const s=t.width*t.height,n=s<e?t.width:Math.round(t.width*Math.sqrt(e/s)),i=s<e?t.height:Math.round(t.height*Math.sqrt(e/s)),r=((t,e)=>{if(a())return new OffscreenCanvas(t,e);const s=document.createElement("canvas");return s.width=t,s.height=e,s})(n,i).getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,n,i),r.getImageData(0,0,n,i)},l=(e,s={})=>{const[n,r,o,h,a,c]=t(s),{colors:_,count:l}=i(e,n,r,o);return u(_,l,h,a,c)},d=async(e,s={})=>{if(c())return[];const[n,r,o,h,a,l,d]=t(s);return e.crossOrigin=d,new Promise((t=>{const s=e=>{const s=_(e,n),{colors:c,count:d}=i(s,n,r,o);t(u(c,d,h,a,l))};if(e.complete)s(e);else{const t=()=>{e.removeEventListener("load",t),s(e)};e.addEventListener("load",t)}}))},g=async(e,s={})=>{if(c())return[];if(a()){const n=t(s),r=await fetch(e,{mode:n[7]}),o=await r.blob(),h=await createImageBitmap(o),a=await(async(e,s={})=>{if(c())return[];const[n,r,o,h,a,l]=t(s),d=_(e,n),{colors:g,count:f}=i(d,n,r,o);return u(g,f,h,a,l)})(h,s);return h.close(),a}const n=new Image;return n.src=e,d(n,s)};window.extractColors=(t,e)=>{if("undefined"!=typeof window&&void 0!==window.document){if(t instanceof Image)return d(t,e);if(t instanceof ImageData||t instanceof Object&&t.data)return new Promise((s=>{s(l(t,e))}));if("string"==typeof t)return g(t,e)}if(a()){if(t instanceof ImageData||t instanceof Object&&t.data)return new Promise((s=>{s(l(t,e))}));if("string"==typeof t)return g(t,e);if(t.src)return g(t.src,e)}if(c())return new Promise((s=>{s(l(t,e))}));throw new Error("Can not analyse picture")}})();